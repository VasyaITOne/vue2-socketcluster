!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.Vue2Socketcluster=factory()}(this,function(){"use strict";var commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function createCommonjsModule(fn,module){return fn(module={exports:{}},module.exports),module.exports}var componentEmitter=createCommonjsModule(function(module){function Emitter(obj){if(obj)return function(obj){for(var key in Emitter.prototype)obj[key]=Emitter.prototype[key];return obj}(obj)}(module.exports=Emitter).prototype.on=Emitter.prototype.addEventListener=function(event,fn){return this._callbacks=this._callbacks||{},(this._callbacks["$"+event]=this._callbacks["$"+event]||[]).push(fn),this},Emitter.prototype.once=function(event,fn){function on(){this.off(event,on),fn.apply(this,arguments)}return on.fn=fn,this.on(event,on),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var cb,callbacks=this._callbacks["$"+event];if(!callbacks)return this;if(1==arguments.length)return delete this._callbacks["$"+event],this;for(var i=0;i<callbacks.length;i++)if((cb=callbacks[i])===fn||cb.fn===fn){callbacks.splice(i,1);break}return this},Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks["$"+event];if(callbacks)for(var i=0,len=(callbacks=callbacks.slice(0)).length;i<len;++i)callbacks[i].apply(this,args);return this},Emitter.prototype.listeners=function(event){return this._callbacks=this._callbacks||{},this._callbacks["$"+event]||[]},Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}}),SCChannel=function(name,client,options){componentEmitter.call(this),this.PENDING="pending",this.SUBSCRIBED="subscribed",this.UNSUBSCRIBED="unsubscribed",this.name=name,this.state=this.UNSUBSCRIBED,this.client=client,this.options=options||{},this.setOptions(this.options)};(SCChannel.prototype=Object.create(componentEmitter.prototype)).setOptions=function(options){options||(options={}),this.waitForAuth=options.waitForAuth||!1,this.batch=options.batch||!1,void 0!==options.data&&(this.data=options.data)},SCChannel.prototype.getState=function(){return this.state},SCChannel.prototype.subscribe=function(options){this.client.subscribe(this.name,options)},SCChannel.prototype.unsubscribe=function(){this.client.unsubscribe(this.name)},SCChannel.prototype.isSubscribed=function(includePending){return this.client.isSubscribed(this.name,includePending)},SCChannel.prototype.publish=function(data,callback){this.client.publish(this.name,data,callback)},SCChannel.prototype.watch=function(handler){this.client.watch(this.name,handler)},SCChannel.prototype.unwatch=function(handler){this.client.unwatch(this.name,handler)},SCChannel.prototype.watchers=function(){return this.client.watchers(this.name)},SCChannel.prototype.destroy=function(){this.client.destroyChannel(this.name)};var scChannel={SCChannel:SCChannel},decycle=function(object){var objects=[],paths=[];return function derez(value,path){var i,name,nu;if(!("object"!=typeof value||null===value||value instanceof Boolean||value instanceof Date||value instanceof Number||value instanceof RegExp||value instanceof String)){for(i=0;i<objects.length;i+=1)if(objects[i]===value)return{$ref:paths[i]};if(objects.push(value),paths.push(path),"[object Array]"===Object.prototype.toString.apply(value))for(nu=[],i=0;i<value.length;i+=1)nu[i]=derez(value[i],path+"["+i+"]");else for(name in nu={},value)Object.prototype.hasOwnProperty.call(value,name)&&(nu[name]=derez(value[name],path+"["+JSON.stringify(name)+"]"));return nu}return value}(object,"$")},isStrict=function(){return!this}();function AuthTokenExpiredError(message,expiry){this.name="AuthTokenExpiredError",this.message=message,this.expiry=expiry,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function AuthTokenInvalidError(message){this.name="AuthTokenInvalidError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function AuthTokenNotBeforeError(message,date){this.name="AuthTokenNotBeforeError",this.message=message,this.date=date,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function AuthTokenError(message){this.name="AuthTokenError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function SilentMiddlewareBlockedError(message,type){this.name="SilentMiddlewareBlockedError",this.message=message,this.type=type,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function InvalidActionError(message){this.name="InvalidActionError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function InvalidArgumentsError(message){this.name="InvalidArgumentsError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function InvalidOptionsError(message){this.name="InvalidOptionsError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function InvalidMessageError(message){this.name="InvalidMessageError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function SocketProtocolError(message,code){this.name="SocketProtocolError",this.message=message,this.code=code,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function ServerProtocolError(message){this.name="ServerProtocolError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function HTTPServerError(message){this.name="HTTPServerError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function ResourceLimitError(message){this.name="ResourceLimitError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function TimeoutError(message){this.name="TimeoutError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function BadConnectionError(message,type){this.name="BadConnectionError",this.message=message,this.type=type,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function BrokerError(message){this.name="BrokerError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function ProcessExitError(message,code){this.name="ProcessExitError",this.message=message,this.code=code,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function UnknownError(message){this.name="UnknownError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}AuthTokenExpiredError.prototype=Object.create(Error.prototype),AuthTokenInvalidError.prototype=Object.create(Error.prototype),AuthTokenNotBeforeError.prototype=Object.create(Error.prototype),AuthTokenError.prototype=Object.create(Error.prototype),SilentMiddlewareBlockedError.prototype=Object.create(Error.prototype),InvalidActionError.prototype=Object.create(Error.prototype),InvalidArgumentsError.prototype=Object.create(Error.prototype),InvalidOptionsError.prototype=Object.create(Error.prototype),InvalidMessageError.prototype=Object.create(Error.prototype),SocketProtocolError.prototype=Object.create(Error.prototype),ServerProtocolError.prototype=Object.create(Error.prototype),HTTPServerError.prototype=Object.create(Error.prototype),ResourceLimitError.prototype=Object.create(Error.prototype),TimeoutError.prototype=Object.create(Error.prototype),BadConnectionError.prototype=Object.create(Error.prototype),BrokerError.prototype=Object.create(Error.prototype),ProcessExitError.prototype=Object.create(Error.prototype),UnknownError.prototype=Object.create(Error.prototype);var scErrors={AuthTokenExpiredError:AuthTokenExpiredError,AuthTokenInvalidError:AuthTokenInvalidError,AuthTokenNotBeforeError:AuthTokenNotBeforeError,AuthTokenError:AuthTokenError,SilentMiddlewareBlockedError:SilentMiddlewareBlockedError,InvalidActionError:InvalidActionError,InvalidArgumentsError:InvalidArgumentsError,InvalidOptionsError:InvalidOptionsError,InvalidMessageError:InvalidMessageError,SocketProtocolError:SocketProtocolError,ServerProtocolError:ServerProtocolError,HTTPServerError:HTTPServerError,ResourceLimitError:ResourceLimitError,TimeoutError:TimeoutError,BadConnectionError:BadConnectionError,BrokerError:BrokerError,ProcessExitError:ProcessExitError,UnknownError:UnknownError},unserializableErrorProperties={domain:1,domainEmitter:1,domainThrown:1},decycle_1=decycle;scErrors.socketProtocolErrorStatuses={1001:"Socket was disconnected",1002:"A WebSocket protocol error was encountered",1003:"Server terminated socket because it received invalid data",1005:"Socket closed without status code",1006:"Socket hung up",1007:"Message format was incorrect",1008:"Encountered a policy violation",1009:"Message was too big to process",1010:"Client ended the connection because the server did not comply with extension requirements",1011:"Server encountered an unexpected fatal condition",4000:"Server ping timed out",4001:"Client pong timed out",4002:"Server failed to sign auth token",4003:"Failed to complete handshake",4004:"Client failed to save auth token",4005:"Did not receive #handshake from client before timeout",4006:"Failed to bind socket to message broker",4007:"Client connection establishment timed out",4008:"Server rejected handshake from client"},scErrors.socketProtocolIgnoreStatuses={1000:"Socket closed normally",1001:"Socket hung up"},scErrors.dehydrateError=function(error,includeStackTrace){var dehydratedError;if(error&&"object"==typeof error)for(var i in dehydratedError={message:error.message},includeStackTrace&&(dehydratedError.stack=error.stack),error)unserializableErrorProperties[i]||(dehydratedError[i]=error[i]);else dehydratedError="function"==typeof error?"[function "+(error.name||"anonymous")+"]":error;return decycle(dehydratedError)},scErrors.hydrateError=function(error){var hydratedError=null;if(null!=error)if("object"==typeof error)for(var i in hydratedError=new Error(error.message),error)error.hasOwnProperty(i)&&(hydratedError[i]=error[i]);else hydratedError=error;return hydratedError},scErrors.decycle=decycle_1;var InvalidActionError$1=scErrors.InvalidActionError,Response=function(socket,id){this.socket=socket,this.id=id,this.sent=!1};Response.prototype._respond=function(responseData){if(this.sent)throw new InvalidActionError$1("Response "+this.id+" has already been sent");this.sent=!0,this.socket.send(this.socket.encode(responseData))},Response.prototype.end=function(data){if(this.id){var responseData={rid:this.id};void 0!==data&&(responseData.data=data),this._respond(responseData)}},Response.prototype.error=function(error,data){if(this.id){var err=scErrors.dehydrateError(error),responseData={rid:this.id,error:err};void 0!==data&&(responseData.data=data),this._respond(responseData)}},Response.prototype.callback=function(error,data){error?this.error(error,data):this.end(data)};var response={Response:Response},AuthEngine=function(){this._internalStorage={},this.isLocalStorageEnabled=this._checkLocalStorageEnabled()};AuthEngine.prototype._checkLocalStorageEnabled=function(){var err;try{commonjsGlobal.localStorage,commonjsGlobal.localStorage.setItem("__scLocalStorageTest",1),commonjsGlobal.localStorage.removeItem("__scLocalStorageTest")}catch(e){err=e}return!err},AuthEngine.prototype.saveToken=function(name,token,options,callback){this.isLocalStorageEnabled&&commonjsGlobal.localStorage?commonjsGlobal.localStorage.setItem(name,token):this._internalStorage[name]=token,callback&&callback(null,token)},AuthEngine.prototype.removeToken=function(name,callback){var token;this.loadToken(name,function(err,authToken){token=authToken}),this.isLocalStorageEnabled&&commonjsGlobal.localStorage?commonjsGlobal.localStorage.removeItem(name):delete this._internalStorage[name],callback&&callback(null,token)},AuthEngine.prototype.loadToken=function(name,callback){callback(null,this.isLocalStorageEnabled&&commonjsGlobal.localStorage?commonjsGlobal.localStorage.getItem(name):this._internalStorage[name]||null)};var auth={AuthEngine:AuthEngine},base64Chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",validJSONStartRegex=/^[ \n\r\t]*[{\[]/,binaryToBase64Replacer=function(key,value){if(commonjsGlobal.ArrayBuffer&&value instanceof commonjsGlobal.ArrayBuffer)return{base64:!0,data:function(arraybuffer){for(var bytes=new Uint8Array(arraybuffer),len=bytes.length,base64="",i=0;i<len;i+=3)base64+=base64Chars[bytes[i]>>2],base64+=base64Chars[(3&bytes[i])<<4|bytes[i+1]>>4],base64+=base64Chars[(15&bytes[i+1])<<2|bytes[i+2]>>6],base64+=base64Chars[63&bytes[i+2]];return len%3==2?base64=base64.substring(0,base64.length-1)+"=":len%3==1&&(base64=base64.substring(0,base64.length-2)+"=="),base64}(value)};if(commonjsGlobal.Buffer){if(value instanceof commonjsGlobal.Buffer)return{base64:!0,data:value.toString("base64")};if(value&&"Buffer"===value.type&&Array.isArray(value.data))return{base64:!0,data:(commonjsGlobal.Buffer.from?commonjsGlobal.Buffer.from(value.data):new commonjsGlobal.Buffer(value.data)).toString("base64")}}return value},scFormatter={decode:function(input){if(null==input)return null;if("#1"===input||"#2"===input)return input;var message=input.toString();if(!validJSONStartRegex.test(message))return message;try{return JSON.parse(message)}catch(err){}return message},encode:function(object){return"#1"===object||"#2"===object?object:JSON.stringify(object,binaryToBase64Replacer)}};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)};function stringifyPrimitive(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}}function stringify(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",null===obj&&(obj=void 0),"object"==typeof obj?map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return isArray(obj[k])?map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))}).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""}function map(xs,f){if(xs.map)return xs.map(f);for(var res=[],i=0;i<xs.length;i++)res.push(f(xs[i],i));return res}var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&res.push(key);return res};function parse(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if("string"!=typeof qs||0===qs.length)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&"number"==typeof options.maxKeys&&(maxKeys=options.maxKeys);var len=qs.length;0<maxKeys&&maxKeys<len&&(len=maxKeys);for(var i=0;i<len;++i){var kstr,vstr,k,v,x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq);0<=idx?(kstr=x.substr(0,idx),vstr=x.substr(idx+1)):(kstr=x,vstr=""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty(obj,k)?isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj}var qs={encode:stringify,stringify:stringify,decode:parse,parse:parse},qs$1=Object.freeze({stringify:stringify,parse:parse,default:qs,encode:stringify,decode:parse});function EventHandlers(){}function EventEmitter(){EventEmitter.init.call(this)}function $getMaxListeners(that){return void 0===that._maxListeners?EventEmitter.defaultMaxListeners:that._maxListeners}function _addListener(target,type,listener,prepend){var m,events,existing,e;if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');if((events=target._events)?(events.newListener&&(target.emit("newListener",type,listener.listener?listener.listener:listener),events=target._events),existing=events[type]):(events=target._events=new EventHandlers,target._eventsCount=0),existing){if("function"==typeof existing?existing=events[type]=prepend?[listener,existing]:[existing,listener]:prepend?existing.unshift(listener):existing.push(listener),!existing.warned&&(m=$getMaxListeners(target))&&0<m&&existing.length>m){existing.warned=!0;var w=new Error("Possible EventEmitter memory leak detected. "+existing.length+" "+type+" listeners added. Use emitter.setMaxListeners() to increase limit");w.name="MaxListenersExceededWarning",w.emitter=target,w.type=type,w.count=existing.length,e=w,"function"==typeof console.warn?console.warn(e):console.log(e)}}else existing=events[type]=listener,++target._eventsCount;return target}function _onceWrap(target,type,listener){var fired=!1;function g(){target.removeListener(type,g),fired||(fired=!0,listener.apply(target,arguments))}return g.listener=listener,g}function listenerCount(type){var events=this._events;if(events){var evlistener=events[type];if("function"==typeof evlistener)return 1;if(evlistener)return evlistener.length}return 0}function arrayClone(arr,i){for(var copy=new Array(i);i--;)copy[i]=arr[i];return copy}EventHandlers.prototype=Object.create(null),(EventEmitter.EventEmitter=EventEmitter).usingDomains=!1,EventEmitter.prototype.domain=void 0,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.init=function(){this.domain=null,EventEmitter.usingDomains&&(!(void 0).active||this instanceof(void 0).Domain||(this.domain=(void 0).active)),this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new EventHandlers,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function(n){if("number"!=typeof n||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=n,this},EventEmitter.prototype.getMaxListeners=function(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,events,domain,arguments$1=arguments,doError="error"===type;if(events=this._events)doError=doError&&null==events.error;else if(!doError)return!1;if(domain=this.domain,doError){if(er=arguments[1],!domain){if(er instanceof Error)throw er;var err=new Error('Uncaught, unspecified "error" event. ('+er+")");throw err.context=er,err}return er||(er=new Error('Uncaught, unspecified "error" event')),er.domainEmitter=this,er.domain=domain,er.domainThrown=!1,domain.emit("error",er),!1}if(!(handler=events[type]))return!1;var isFn="function"==typeof handler;switch(len=arguments.length){case 1:!function(handler,isFn,self){if(isFn)handler.call(self);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self)}(handler,isFn,this);break;case 2:!function(handler,isFn,self,arg1){if(isFn)handler.call(self,arg1);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1)}(handler,isFn,this,arguments[1]);break;case 3:!function(handler,isFn,self,arg1,arg2){if(isFn)handler.call(self,arg1,arg2);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1,arg2)}(handler,isFn,this,arguments[1],arguments[2]);break;case 4:!function(handler,isFn,self,arg1,arg2,arg3){if(isFn)handler.call(self,arg1,arg2,arg3);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1,arg2,arg3)}(handler,isFn,this,arguments[1],arguments[2],arguments[3]);break;default:for(args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments$1[i];!function(handler,isFn,self,args){if(isFn)handler.apply(self,args);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].apply(self,args)}(handler,isFn,this,args)}return!0},EventEmitter.prototype.on=EventEmitter.prototype.addListener=function(type,listener){return _addListener(this,type,listener,!1)},EventEmitter.prototype.prependListener=function(type,listener){return _addListener(this,type,listener,!0)},EventEmitter.prototype.once=function(type,listener){if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');return this.on(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.prependOnceListener=function(type,listener){if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');return this.prependListener(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.removeListener=function(type,listener){var list,events,position,i,originalListener;if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');if(!(events=this._events))return this;if(!(list=events[type]))return this;if(list===listener||list.listener&&list.listener===listener)0==--this._eventsCount?this._events=new EventHandlers:(delete events[type],events.removeListener&&this.emit("removeListener",type,list.listener||listener));else if("function"!=typeof list){for(position=-1,i=list.length;0<i--;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){originalListener=list[i].listener,position=i;break}if(position<0)return this;if(1===list.length){if(list[0]=void 0,0==--this._eventsCount)return this._events=new EventHandlers,this;delete events[type]}else!function(list,index){for(var i=index,k=i+1,n=list.length;k<n;i+=1,k+=1)list[i]=list[k];list.pop()}(list,position);events.removeListener&&this.emit("removeListener",type,originalListener||listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var listeners,events;if(!(events=this._events))return this;if(!events.removeListener)return 0===arguments.length?(this._events=new EventHandlers,this._eventsCount=0):events[type]&&(0==--this._eventsCount?this._events=new EventHandlers:delete events[type]),this;if(0===arguments.length){for(var key,keys=Object.keys(events),i=0;i<keys.length;++i)"removeListener"!==(key=keys[i])&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events=new EventHandlers,this._eventsCount=0,this}if("function"==typeof(listeners=events[type]))this.removeListener(type,listeners);else if(listeners)for(;this.removeListener(type,listeners[listeners.length-1]),listeners[0];);return this},EventEmitter.prototype.listeners=function(type){var evlistener,events=this._events;return events&&(evlistener=events[type])?"function"==typeof evlistener?[evlistener.listener||evlistener]:function(arr){for(var ret=new Array(arr.length),i=0;i<ret.length;++i)ret[i]=arr[i].listener||arr[i];return ret}(evlistener):[]},EventEmitter.listenerCount=function(emitter,type){return"function"==typeof emitter.listenerCount?emitter.listenerCount(type):listenerCount.call(emitter,type)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]};var events=Object.freeze({default:EventEmitter,EventEmitter:EventEmitter}),empty={},empty$1=Object.freeze({default:empty}),has=Object.prototype.hasOwnProperty,id=0;function Ultron(ee){if(!(this instanceof Ultron))return new Ultron(ee);this.id=id++,this.ee=ee}Ultron.prototype.on=function(event,fn,context){return fn.__ultron=this.id,this.ee.on(event,fn,context),this},Ultron.prototype.once=function(event,fn,context){return fn.__ultron=this.id,this.ee.once(event,fn,context),this},Ultron.prototype.remove=function(){var event,args=arguments,ee=this.ee;if(1===args.length&&"string"==typeof args[0])args=args[0].split(/[, ]+/);else if(!args.length)if(ee.eventNames)args=ee.eventNames();else if(ee._events){for(event in args=[],ee._events)has.call(ee._events,event)&&args.push(event);Object.getOwnPropertySymbols&&(args=args.concat(Object.getOwnPropertySymbols(ee._events)))}for(var i=0;i<args.length;i++)for(var listeners=ee.listeners(args[i]),j=0;j<listeners.length;j++){if((event=listeners[j]).listener){if(event.listener.__ultron!==this.id)continue}else if(event.__ultron!==this.id)continue;ee.removeListener(args[i],event)}return this},Ultron.prototype.destroy=function(){return!!this.ee&&(this.remove(),!(this.ee=null))};var _blobConstructor,xhr,ultron=Ultron,hasFetch=isFunction(global.fetch)&&isFunction(global.ReadableStream);function checkTypeSupport(type){xhr||(xhr=new global.XMLHttpRequest).open("GET",global.location.host?"/":"https://example.com");try{return xhr.responseType=type,xhr.responseType===type}catch(e){return!1}}var haveArrayBuffer=void 0!==global.ArrayBuffer,haveSlice=haveArrayBuffer&&isFunction(global.ArrayBuffer.prototype.slice),arraybuffer=haveArrayBuffer&&checkTypeSupport("arraybuffer"),msstream=!hasFetch&&haveSlice&&checkTypeSupport("ms-stream"),mozchunkedarraybuffer=!hasFetch&&haveArrayBuffer&&checkTypeSupport("moz-chunked-arraybuffer"),overrideMimeType=isFunction(xhr.overrideMimeType),vbArray=isFunction(global.VBArray);function isFunction(value){return"function"==typeof value}function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}xhr=null;var cachedSetTimeout=defaultSetTimout,cachedClearTimeout=defaultClearTimeout;function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}"function"==typeof global.setTimeout&&(cachedSetTimeout=setTimeout),"function"==typeof global.clearTimeout&&(cachedClearTimeout=clearTimeout);var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,function(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}function nextTick(fun){var arguments$1=arguments,args=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)args[i-1]=arguments$1[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)}function Item(fun,array){this.fun=fun,this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};function noop(){}var on=noop,addListener=noop,once=noop,off=noop,removeListener=noop,removeAllListeners=noop,emit=noop;var performance=global.performance||{},performanceNow=performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return(new Date).getTime()};var startTime=new Date;var process$1={nextTick:nextTick,title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:on,addListener:addListener,once:once,off:off,removeListener:removeListener,removeAllListeners:removeAllListeners,emit:emit,binding:function(name){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(dir){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(previousTimestamp){var clocktime=.001*performanceNow.call(performance),seconds=Math.floor(clocktime),nanoseconds=Math.floor(clocktime%1*1e9);return previousTimestamp&&(seconds-=previousTimestamp[0],(nanoseconds-=previousTimestamp[1])<0&&(seconds--,nanoseconds+=1e9)),[seconds,nanoseconds]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-startTime)/1e3}},inherits$1="function"==typeof Object.create?function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor},formatRegExp=/%[sdj%]/g;var debugEnviron,debugs={};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};return 3<=arguments.length&&(ctx.depth=arguments[2]),4<=arguments.length&&(ctx.colors=arguments[3]),isBoolean(opts)?ctx.showHidden=opts:opts&&function(origin,add){if(!add||!isObject(add))return;var keys=Object.keys(add),i=keys.length;for(;i--;)origin[keys[i]]=add[keys[i]]}(ctx,opts),isUndefined(ctx.showHidden)&&(ctx.showHidden=!1),isUndefined(ctx.depth)&&(ctx.depth=2),isUndefined(ctx.colors)&&(ctx.colors=!1),isUndefined(ctx.customInspect)&&(ctx.customInspect=!0),ctx.colors&&(ctx.stylize=stylizeWithColor),formatValue(ctx,obj,ctx.depth)}function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];return style?"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m":str}function stylizeNoColor(str,styleType){return str}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction$1(value.inspect)&&value.inspect!==inspect&&(!value.constructor||value.constructor.prototype!==value)){var ret=value.inspect(recurseTimes,ctx);return isString(ret)||(ret=formatValue(ctx,ret,recurseTimes)),ret}var primitive=function(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(arg=value,"number"==typeof arg)return ctx.stylize(""+value,"number");var arg;if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}(ctx,value);if(primitive)return primitive;var keys=Object.keys(value),visibleKeys=function(array){var hash={};return array.forEach(function(val,idx){hash[val]=!0}),hash}(keys);if(ctx.showHidden&&(keys=Object.getOwnPropertyNames(value)),isError(value)&&(0<=keys.indexOf("message")||0<=keys.indexOf("description")))return formatError(value);if(0===keys.length){if(isFunction$1(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value))return ctx.stylize(RegExp.prototype.toString.call(value),"regexp");if(isDate(value))return ctx.stylize(Date.prototype.toString.call(value),"date");if(isError(value))return formatError(value)}var ar,output,base="",array=!1,braces=["{","}"];(ar=value,Array.isArray(ar)&&(array=!0,braces=["[","]"]),isFunction$1(value))&&(base=" [Function"+(value.name?": "+value.name:"")+"]");return isRegExp(value)&&(base=" "+RegExp.prototype.toString.call(value)),isDate(value)&&(base=" "+Date.prototype.toUTCString.call(value)),isError(value)&&(base=" "+formatError(value)),0!==keys.length||array&&0!=value.length?recurseTimes<0?isRegExp(value)?ctx.stylize(RegExp.prototype.toString.call(value),"regexp"):ctx.stylize("[Object]","special"):(ctx.seen.push(value),output=array?function(ctx,value,recurseTimes,visibleKeys,keys){for(var output=[],i=0,l=value.length;i<l;++i)hasOwnProperty$1(value,String(i))?output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),!0)):output.push("");return keys.forEach(function(key){key.match(/^\d+$/)||output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,!0))}),output}(ctx,value,recurseTimes,visibleKeys,keys):keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)}),ctx.seen.pop(),function(output,base,braces){if(60<output.reduce(function(prev,cur){return cur.indexOf("\n"),prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0))return braces[0]+(""===base?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1];return braces[0]+base+" "+output.join(", ")+" "+braces[1]}(output,base,braces)):braces[0]+base+braces[1]}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;if((desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]}).get?str=desc.set?ctx.stylize("[Getter/Setter]","special"):ctx.stylize("[Getter]","special"):desc.set&&(str=ctx.stylize("[Setter]","special")),hasOwnProperty$1(visibleKeys,key)||(name="["+key+"]"),str||(ctx.seen.indexOf(desc.value)<0?-1<(str=isNull(recurseTimes)?formatValue(ctx,desc.value,null):formatValue(ctx,desc.value,recurseTimes-1)).indexOf("\n")&&(str=array?str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2):"\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")):str=ctx.stylize("[Circular]","special")),isUndefined(name)){if(array&&key.match(/^\d+$/))return str;(name=JSON.stringify(""+key)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(name=name.substr(1,name.length-2),name=ctx.stylize(name,"name")):(name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),name=ctx.stylize(name,"string"))}return name+": "+str}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isString(arg){return"string"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction$1(arg){return"function"==typeof arg}function objectToString(o){return Object.prototype.toString.call(o)}function hasOwnProperty$1(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,inited=!1;function init(){inited=!0;for(var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63}function encodeChunk(uint8,start,end){for(var tmp,num,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output.push(lookup[(num=tmp)>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]);return output.join("")}function fromByteArray(uint8){var tmp;inited||init();for(var len=uint8.length,extraBytes=len%3,output="",parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(encodeChunk(uint8,i,len2<i+16383?len2:i+16383));return 1===extraBytes?(tmp=uint8[len-1],output+=lookup[tmp>>2],output+=lookup[tmp<<4&63],output+="=="):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],output+=lookup[tmp>>10],output+=lookup[tmp>>4&63],output+=lookup[tmp<<2&63],output+="="),parts.push(output),parts.join("")}function read(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;0<nBits;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;0<nBits;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)}function write(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),2<=(value+=1<=e+eBias?rt/c:rt*Math.pow(2,1-eBias))*c&&(e++,c/=2),eMax<=e+eBias?(m=0,e=eMax):1<=e+eBias?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));8<=mLen;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;0<eLen;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}var toString={}.toString,isArray$2=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)};Buffer$1.TYPED_ARRAY_SUPPORT=void 0===global.TYPED_ARRAY_SUPPORT||global.TYPED_ARRAY_SUPPORT;var _kMaxLength=kMaxLength();function kMaxLength(){return Buffer$1.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length)throw new RangeError("Invalid typed array length");return Buffer$1.TYPED_ARRAY_SUPPORT?(that=new Uint8Array(length)).__proto__=Buffer$1.prototype:(null===that&&(that=new Buffer$1(length)),that.length=length),that}function Buffer$1(arg,encodingOrOffset,length){if(!(Buffer$1.TYPED_ARRAY_SUPPORT||this instanceof Buffer$1))return new Buffer$1(arg,encodingOrOffset,length);if("number"==typeof arg){if("string"==typeof encodingOrOffset)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}function from(that,value,encodingOrOffset,length){if("number"==typeof value)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&value instanceof ArrayBuffer?function(that,array,byteOffset,length){if(array.byteLength,byteOffset<0||array.byteLength<byteOffset)throw new RangeError("'offset' is out of bounds");if(array.byteLength<byteOffset+(length||0))throw new RangeError("'length' is out of bounds");array=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length);Buffer$1.TYPED_ARRAY_SUPPORT?(that=array).__proto__=Buffer$1.prototype:that=fromArrayLike(that,array);return that}(that,value,encodingOrOffset,length):"string"==typeof value?function(that,string,encoding){"string"==typeof encoding&&""!==encoding||(encoding="utf8");if(!Buffer$1.isEncoding(encoding))throw new TypeError('"encoding" must be a valid string encoding');var length=0|byteLength(string,encoding),actual=(that=createBuffer(that,length)).write(string,encoding);actual!==length&&(that=that.slice(0,actual));return that}(that,value,encodingOrOffset):function(that,obj){if(internalIsBuffer(obj)){var len=0|checked(obj.length);return 0===(that=createBuffer(that,len)).length||obj.copy(that,0,0,len),that}if(obj){if("undefined"!=typeof ArrayBuffer&&obj.buffer instanceof ArrayBuffer||"length"in obj)return"number"!=typeof obj.length||(val=obj.length)!=val?createBuffer(that,0):fromArrayLike(that,obj);if("Buffer"===obj.type&&isArray$2(obj.data))return fromArrayLike(that,obj.data)}var val;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(that,value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be a number');if(size<0)throw new RangeError('"size" argument must not be negative')}function allocUnsafe(that,size){if(assertSize(size),that=createBuffer(that,size<0?0:0|checked(size)),!Buffer$1.TYPED_ARRAY_SUPPORT)for(var i=0;i<size;++i)that[i]=0;return that}function fromArrayLike(that,array){var length=array.length<0?0:0|checked(array.length);that=createBuffer(that,length);for(var i=0;i<length;i+=1)that[i]=255&array[i];return that}function checked(length){if(length>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|length}function internalIsBuffer(b){return!(null==b||!b._isBuffer)}function byteLength(string,encoding){if(internalIsBuffer(string))return string.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer))return string.byteLength;"string"!=typeof string&&(string=""+string);var len=string.length;if(0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case void 0:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):2147483647<byteOffset?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),byteOffset=+byteOffset,isNaN(byteOffset)&&(byteOffset=dir?0:buffer.length-1),byteOffset<0&&(byteOffset=buffer.length+byteOffset),byteOffset>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer$1.from(val,encoding)),internalIsBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,Buffer$1.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?dir?Uint8Array.prototype.indexOf.call(buffer,val,byteOffset):Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var i,indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;arrLength/=indexSize=2,valLength/=2,byteOffset/=2}function read$$1(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++)if(read$$1(arr,i)===read$$1(val,-1===foundIndex?0:i-foundIndex)){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1}else for(arrLength<byteOffset+valLength&&(byteOffset=arrLength-valLength),i=byteOffset;0<=i;i--){for(var found=!0,j=0;j<valLength;j++)if(read$$1(arr,i+j)!==read$$1(val,j)){found=!1;break}if(found)return i}return-1}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?remaining<(length=Number(length))&&(length=remaining):length=remaining;var strLen=string.length;if(strLen%2!=0)throw new TypeError("Invalid hex string");strLen/2<length&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(function(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(function(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?fromByteArray(buf):fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var secondByte,thirdByte,fourthByte,tempCodePoint,firstByte=buf[i],codePoint=null,bytesPerSequence=239<firstByte?4:223<firstByte?3:191<firstByte?2:1;if(i+bytesPerSequence<=end)switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:128==(192&(secondByte=buf[i+1]))&&127<(tempCodePoint=(31&firstByte)<<6|63&secondByte)&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&2047<(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)&&(tempCodePoint<55296||57343<tempCodePoint)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&65535<(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}null===codePoint?(codePoint=65533,bytesPerSequence=1):65535<codePoint&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return function(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);var res="",i=0;for(;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}(res)}Buffer$1.poolSize=8192,Buffer$1._augment=function(arr){return arr.__proto__=Buffer$1.prototype,arr},Buffer$1.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)},Buffer$1.TYPED_ARRAY_SUPPORT&&(Buffer$1.prototype.__proto__=Uint8Array.prototype,Buffer$1.__proto__=Uint8Array),Buffer$1.alloc=function(size,fill,encoding){return function(that,size,fill,encoding){return assertSize(size),size<=0?createBuffer(that,size):void 0!==fill?"string"==typeof encoding?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill):createBuffer(that,size)}(null,size,fill,encoding)},Buffer$1.allocUnsafe=function(size){return allocUnsafe(null,size)},Buffer$1.allocUnsafeSlow=function(size){return allocUnsafe(null,size)},Buffer$1.isBuffer=isBuffer$1,Buffer$1.compare=function(a,b){if(!internalIsBuffer(a)||!internalIsBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer$1.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer$1.concat=function(list,length){if(!isArray$2(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer$1.alloc(0);var i;if(void 0===length)for(i=length=0;i<list.length;++i)length+=list[i].length;var buffer=Buffer$1.allocUnsafe(length),pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!internalIsBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer$1.byteLength=byteLength,Buffer$1.prototype._isBuffer=!0,Buffer$1.prototype.swap16=function(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer$1.prototype.swap32=function(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer$1.prototype.swap64=function(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer$1.prototype.toString=function(){var length=0|this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):function(encoding,start,end){var loweredCase=!1;if((void 0===start||start<0)&&(start=0),start>this.length)return"";if((void 0===end||end>this.length)&&(end=this.length),end<=0)return"";if((end>>>=0)<=(start>>>=0))return"";for(encoding||(encoding="utf8");;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}.apply(this,arguments)},Buffer$1.prototype.equals=function(b){if(!internalIsBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer$1.compare(this,b)},Buffer$1.prototype.inspect=function(){var str="";return 0<this.length&&(str=this.toString("hex",0,50).match(/.{2}/g).join(" "),50<this.length&&(str+=" ... ")),"<Buffer "+str+">"},Buffer$1.prototype.compare=function(target,start,end,thisStart,thisEnd){if(!internalIsBuffer(target))throw new TypeError("Argument must be a Buffer");if(void 0===start&&(start=0),void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),start<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisEnd<=thisStart&&end<=start)return 0;if(thisEnd<=thisStart)return-1;if(end<=start)return 1;if(this===target)return 0;for(var x=(thisEnd>>>=0)-(thisStart>>>=0),y=(end>>>=0)-(start>>>=0),len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer$1.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer$1.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer$1.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer$1.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset|=0,isFinite(length)?(length|=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||remaining<length)&&(length=remaining),0<string.length&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer$1.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0),(!end||end<0||len<end)&&(end=len);for(var out="",i=start;i<end;++i)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(length<offset+ext)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!internalIsBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(max<value||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function objectWriteUInt16(buf,value,offset,littleEndian){value<0&&(value=65535+value+1);for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}function objectWriteUInt32(buf,value,offset,littleEndian){value<0&&(value=4294967295+value+1);for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255}function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,0,offset,4),write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,0,offset,8),write(buf,value,offset,littleEndian,52,8),offset+8}Buffer$1.prototype.slice=function(start,end){var newBuf,len=this.length;if((start=~~start)<0?(start+=len)<0&&(start=0):len<start&&(start=len),(end=void 0===end?len:~~end)<0?(end+=len)<0&&(end=0):len<end&&(end=len),end<start&&(end=start),Buffer$1.TYPED_ARRAY_SUPPORT)(newBuf=this.subarray(start,end)).__proto__=Buffer$1.prototype;else{var sliceLen=end-start;newBuf=new Buffer$1(sliceLen,void 0);for(var i=0;i<sliceLen;++i)newBuf[i]=this[i+start]}return newBuf},Buffer$1.prototype.readUIntLE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer$1.prototype.readUIntBE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;0<byteLength&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer$1.prototype.readUInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer$1.prototype.readUInt16LE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer$1.prototype.readUInt16BE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer$1.prototype.readUInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer$1.prototype.readUInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer$1.prototype.readIntLE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return(mul*=128)<=val&&(val-=Math.pow(2,8*byteLength)),val},Buffer$1.prototype.readIntBE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];0<i&&(mul*=256);)val+=this[offset+--i]*mul;return(mul*=128)<=val&&(val-=Math.pow(2,8*byteLength)),val},Buffer$1.prototype.readInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer$1.prototype.readInt16LE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer$1.prototype.readInt16BE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer$1.prototype.readInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer$1.prototype.readInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer$1.prototype.readFloatLE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),read(this,offset,!0,23,4)},Buffer$1.prototype.readFloatBE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),read(this,offset,!1,23,4)},Buffer$1.prototype.readDoubleLE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),read(this,offset,!0,52,8)},Buffer$1.prototype.readDoubleBE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),read(this,offset,!1,52,8)},Buffer$1.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){(value=+value,offset|=0,byteLength|=0,noAssert)||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer$1.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){(value=+value,offset|=0,byteLength|=0,noAssert)||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;0<=--i&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer$1.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,1,255,0),Buffer$1.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),this[offset]=255&value,offset+1},Buffer$1.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer$1.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer$1.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer$1.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer$1.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer$1.TYPED_ARRAY_SUPPORT?(this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer$1.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer$1.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer$1.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset|=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer$1.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset|=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;0<=--i&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer$1.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,1,127,-128),Buffer$1.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),value<0&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer$1.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer$1.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer$1.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer$1.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer$1.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),Buffer$1.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer$1.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),Buffer$1.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer$1.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer$1.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer$1.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer$1.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer$1.prototype.copy=function(target,targetStart,start,end){if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),0<end&&end<start&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(targetStart<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var i,len=end-start;if(this===target&&start<targetStart&&targetStart<end)for(i=len-1;0<=i;--i)target[i+targetStart]=this[i+start];else if(len<1e3||!Buffer$1.TYPED_ARRAY_SUPPORT)for(i=0;i<len;++i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart);return len},Buffer$1.prototype.fill=function(val,start,end,encoding){var i;if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),1===val.length){var code=val.charCodeAt(0);code<256&&(val=code)}if(void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer$1.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding)}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;if(start>>>=0,end=void 0===end?this.length:end>>>0,val||(val=0),"number"==typeof val)for(i=start;i<end;++i)this[i]=val;else{var bytes=internalIsBuffer(val)?val:utf8ToBytes(new Buffer$1(val,encoding).toString()),len=bytes.length;for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function toHex(n){return n<16?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){var codePoint;units=units||1/0;for(var length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if(55295<(codePoint=string.charCodeAt(i))&&codePoint<57344){if(!leadSurrogate){if(56319<codePoint){-1<(units-=3)&&bytes.push(239,191,189);continue}if(i+1===length){-1<(units-=3)&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){-1<(units-=3)&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&-1<(units-=3)&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function base64ToBytes(str){return function(b64){var i,j,l,tmp,placeHolders,arr;inited||init();var len=b64.length;if(0<len%4)throw new Error("Invalid string. Length must be a multiple of 4");placeHolders="="===b64[len-2]?2:"="===b64[len-1]?1:0,arr=new Arr(3*len/4-placeHolders),l=0<placeHolders?len-4:len;var L=0;for(j=i=0;i<l;i+=4,j+=3)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[L++]=tmp>>16&255,arr[L++]=tmp>>8&255,arr[L++]=255&tmp;return 2===placeHolders?(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[L++]=255&tmp):1===placeHolders&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[L++]=tmp>>8&255,arr[L++]=255&tmp),arr}(function(str){if((str=function(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}(str).replace(INVALID_BASE64_RE,"")).length<2)return"";for(;str.length%4!=0;)str+="=";return str}(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isBuffer$1(obj){return null!=obj&&(!!obj._isBuffer||isFastBuffer(obj)||function(obj){return"function"==typeof obj.readFloatLE&&"function"==typeof obj.slice&&isFastBuffer(obj.slice(0,0))}(obj))}function isFastBuffer(obj){return!!obj.constructor&&"function"==typeof obj.constructor.isBuffer&&obj.constructor.isBuffer(obj)}var bufferEs6=Object.freeze({INSPECT_MAX_BYTES:50,kMaxLength:_kMaxLength,Buffer:Buffer$1,SlowBuffer:function(length){return+length!=length&&(length=0),Buffer$1.alloc(+length)},isBuffer:isBuffer$1});function BufferList(){this.head=null,this.tail=null,this.length=0}BufferList.prototype.push=function(v){var entry={data:v,next:null};0<this.length?this.tail.next=entry:this.head=entry,this.tail=entry,++this.length},BufferList.prototype.unshift=function(v){var entry={data:v,next:this.head};0===this.length&&(this.tail=entry),this.head=entry,++this.length},BufferList.prototype.shift=function(){if(0!==this.length){var ret=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,ret}},BufferList.prototype.clear=function(){this.head=this.tail=null,this.length=0},BufferList.prototype.join=function(s){if(0===this.length)return"";for(var p=this.head,ret=""+p.data;p=p.next;)ret+=s+p.data;return ret},BufferList.prototype.concat=function(n){if(0===this.length)return Buffer$1.alloc(0);if(1===this.length)return this.head.data;for(var ret=Buffer$1.allocUnsafe(n>>>0),p=this.head,i=0;p;)p.data.copy(ret,i),i+=p.data.length,p=p.next;return ret};var isBufferEncoding=Buffer$1.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function StringDecoder(encoding){switch(this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,""),function(encoding){if(encoding&&!isBufferEncoding(encoding))throw new Error("Unknown encoding: "+encoding)}(encoding),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=base64DetectIncompleteChar;break;default:return void(this.write=passThroughWrite)}this.charBuffer=new Buffer$1(6),this.charReceived=0,this.charLength=0}function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2,this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3,this.charLength=this.charReceived?3:0}StringDecoder.prototype.write=function(buffer){for(var charStr="";this.charLength;){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;if(buffer.copy(this.charBuffer,this.charReceived,0,available),this.charReceived+=available,this.charReceived<this.charLength)return"";if(buffer=buffer.slice(available,buffer.length),!(55296<=(charCode=(charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(charStr.length-1))&&charCode<=56319)){if(this.charReceived=this.charLength=0,0===buffer.length)return charStr;break}this.charLength+=this.surrogateSize,charStr=""}this.detectIncompleteChar(buffer);var end=buffer.length;this.charLength&&(buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end),end-=this.charReceived);var charCode;end=(charStr+=buffer.toString(this.encoding,0,end)).length-1;if(55296<=(charCode=charStr.charCodeAt(end))&&charCode<=56319){var size=this.surrogateSize;return this.charLength+=size,this.charReceived+=size,this.charBuffer.copy(this.charBuffer,size,0,size),buffer.copy(this.charBuffer,0,0,size),charStr.substring(0,end)}return charStr},StringDecoder.prototype.detectIncompleteChar=function(buffer){for(var i=3<=buffer.length?3:buffer.length;0<i;i--){var c=buffer[buffer.length-i];if(1==i&&c>>5==6){this.charLength=2;break}if(i<=2&&c>>4==14){this.charLength=3;break}if(i<=3&&c>>3==30){this.charLength=4;break}}this.charReceived=i},StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length&&(res=this.write(buffer)),this.charReceived){var cr=this.charReceived,buf=this.charBuffer,enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res},Readable.ReadableState=ReadableState;var debug=function(set){isUndefined(debugEnviron)&&(debugEnviron=process$1.env.NODE_DEBUG||""),set=set.toUpperCase(),debugs[set]||(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)?debugs[set]=function(){var msg=function(f){var arguments$1=arguments;if(!isString(f)){for(var objects=[],i=0;i<arguments.length;i++)objects.push(inspect(arguments$1[i]));return objects.join(" ")}i=1;for(var args=arguments,len=args.length,str=String(f).replace(formatRegExp,function(x){if("%%"===x)return"%";if(len<=i)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}}),x=args[i];i<len;x=args[++i])isNull(x)||!isObject(x)?str+=" "+x:str+=" "+inspect(x);return str}.apply(null,arguments);console.error("%s %d: %s",set,0,msg)}:debugs[set]=function(){});return debugs[set]}("stream");function ReadableState(options,stream){options=options||{},this.objectMode=!!options.objectMode,stream instanceof Duplex&&(this.objectMode=this.objectMode||!!options.readableObjectMode);var hwm=options.highWaterMark,defaultHwm=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:defaultHwm,this.highWaterMark=~~this.highWaterMark,this.buffer=new BufferList,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=options.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,options.encoding&&(this.decoder=new StringDecoder(options.encoding),this.encoding=options.encoding)}function Readable(options){if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this),this.readable=!0,options&&"function"==typeof options.read&&(this._read=options.read),EventEmitter.call(this)}function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=function(state,chunk){var er=null;Buffer.isBuffer(chunk)||"string"==typeof chunk||null==chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk"));return er}(state,chunk);if(er)stream.emit("error",er);else if(null===chunk)state.reading=!1,function(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();chunk&&chunk.length&&(state.buffer.push(chunk),state.length+=state.objectMode?1:chunk.length)}state.ended=!0,emitReadable(stream)}(stream,state);else if(state.objectMode||chunk&&0<chunk.length)if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var _e=new Error("stream.unshift() after end event");stream.emit("error",_e)}else{var skipAdd;!state.decoder||addToFront||encoding||(chunk=state.decoder.write(chunk),skipAdd=!state.objectMode&&0===chunk.length),addToFront||(state.reading=!1),skipAdd||(state.flowing&&0===state.length&&!state.sync?(stream.emit("data",chunk),stream.read(0)):(state.length+=state.objectMode?1:chunk.length,addToFront?state.buffer.unshift(chunk):state.buffer.push(chunk),state.needReadable&&emitReadable(stream))),function(stream,state){state.readingMore||(state.readingMore=!0,nextTick(maybeReadMore_,stream,state))}(stream,state)}else addToFront||(state.reading=!1);return function(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||0===state.length)}(state)}inherits$1(Readable,EventEmitter),Readable.prototype.push=function(chunk,encoding){var state=this._readableState;return state.objectMode||"string"!=typeof chunk||(encoding=encoding||state.defaultEncoding)!==state.encoding&&(chunk=Buffer.from(chunk,encoding),encoding=""),readableAddChunk(this,state,chunk,encoding,!1)},Readable.prototype.unshift=function(chunk){return readableAddChunk(this,this._readableState,chunk,"",!0)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(enc){return this._readableState.decoder=new StringDecoder(enc),this._readableState.encoding=enc,this};var MAX_HWM=8388608;function howMuchToRead(n,state){return n<=0||0===state.length&&state.ended?0:state.objectMode?1:n!=n?state.flowing&&state.length?state.buffer.head.data.length:state.length:(n>state.highWaterMark&&(state.highWaterMark=function(n){return MAX_HWM<=n?n=MAX_HWM:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n}(n)),n<=state.length?n:state.ended?state.length:(state.needReadable=!0,0))}function emitReadable(stream){var state=stream._readableState;state.needReadable=!1,state.emittedReadable||(debug("emitReadable",state.flowing),state.emittedReadable=!0,state.sync?nextTick(emitReadable_,stream):emitReadable_(stream))}function emitReadable_(stream){debug("emit readable"),stream.emit("readable"),flow(stream)}function maybeReadMore_(stream,state){for(var len=state.length;!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark&&(debug("maybeReadMore read 0"),stream.read(0),len!==state.length);)len=state.length;state.readingMore=!1}function nReadingNextTick(self){debug("readable nexttick read 0"),self.read(0)}function resume_(stream,state){state.reading||(debug("resume read 0"),stream.read(0)),state.resumeScheduled=!1,state.awaitDrain=0,stream.emit("resume"),flow(stream),state.flowing&&!state.reading&&stream.read(0)}function flow(stream){var state=stream._readableState;for(debug("flow",state.flowing);state.flowing&&null!==stream.read(););}function fromList(n,state){return 0===state.length?null:(state.objectMode?ret=state.buffer.shift():!n||n>=state.length?(ret=state.decoder?state.buffer.join(""):1===state.buffer.length?state.buffer.head.data:state.buffer.concat(state.length),state.buffer.clear()):ret=function(n,list,hasStrings){var ret;n<list.head.data.length?(ret=list.head.data.slice(0,n),list.head.data=list.head.data.slice(n)):ret=n===list.head.data.length?list.shift():hasStrings?function(n,list){var p=list.head,c=1,ret=p.data;n-=ret.length;for(;p=p.next;){var str=p.data,nb=n>str.length?str.length:n;if(nb===str.length?ret+=str:ret+=str.slice(0,n),0===(n-=nb)){nb===str.length?(++c,p.next?list.head=p.next:list.head=list.tail=null):(list.head=p).data=str.slice(nb);break}++c}return list.length-=c,ret}(n,list):function(n,list){var ret=Buffer.allocUnsafe(n),p=list.head,c=1;p.data.copy(ret),n-=p.data.length;for(;p=p.next;){var buf=p.data,nb=n>buf.length?buf.length:n;if(buf.copy(ret,ret.length-n,0,nb),0===(n-=nb)){nb===buf.length?(++c,p.next?list.head=p.next:list.head=list.tail=null):(list.head=p).data=buf.slice(nb);break}++c}return list.length-=c,ret}(n,list);return ret}(n,state.buffer,state.decoder),ret);var ret}function endReadable(stream){var state=stream._readableState;if(0<state.length)throw new Error('"endReadable()" called on non-empty stream');state.endEmitted||(state.ended=!0,nextTick(endReadableNT,state,stream))}function endReadableNT(state,stream){state.endEmitted||0!==state.length||(state.endEmitted=!0,stream.readable=!1,stream.emit("end"))}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++)if(xs[i]===x)return i;return-1}function nop(){}function WriteReq(chunk,encoding,cb){this.chunk=chunk,this.encoding=encoding,this.callback=cb,this.next=null}function WritableState(options,stream){Object.defineProperty(this,"buffer",{get:function deprecate(fn,msg){if(isUndefined(global.process))return function(){return deprecate(fn,msg).apply(this,arguments)};if(!0===process$1.noDeprecation)return fn;var warned=!1;return function(){if(!warned){if(process$1.throwDeprecation)throw new Error(msg);process$1.traceDeprecation?console.trace(msg):console.error(msg),warned=!0}return fn.apply(this,arguments)}}(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),options=options||{},this.objectMode=!!options.objectMode,stream instanceof Duplex&&(this.objectMode=this.objectMode||!!options.writableObjectMode);var hwm=options.highWaterMark,defaultHwm=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:defaultHwm,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1;var noDecode=(this.finished=!1)===options.decodeStrings;this.decodeStrings=!noDecode,this.defaultEncoding=options.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(er){!function(stream,er){var state=stream._writableState,sync=state.sync,cb=state.writecb;if(function(state){state.writing=!1,state.writecb=null,state.length-=state.writelen,state.writelen=0}(state),er)!function(stream,state,sync,er,cb){--state.pendingcb,sync?nextTick(cb,er):cb(er);stream._writableState.errorEmitted=!0,stream.emit("error",er)}(stream,state,sync,er,cb);else{var finished=needFinish(state);finished||state.corked||state.bufferProcessing||!state.bufferedRequest||clearBuffer(stream,state),sync?nextTick(afterWrite,stream,state,finished,cb):afterWrite(stream,state,finished,cb)}}(stream,er)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}function Writable(options){if(!(this instanceof Writable||this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this),this.writable=!0,options&&("function"==typeof options.write&&(this._write=options.write),"function"==typeof options.writev&&(this._writev=options.writev)),EventEmitter.call(this)}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len,state.writecb=cb,state.writing=!0,state.sync=!0,writev?stream._writev(chunk,state.onwrite):stream._write(chunk,encoding,state.onwrite),state.sync=!1}function afterWrite(stream,state,finished,cb){finished||function(stream,state){0===state.length&&state.needDrain&&(state.needDrain=!1,stream.emit("drain"))}(stream,state),state.pendingcb--,cb(),finishMaybe(stream,state)}function clearBuffer(stream,state){state.bufferProcessing=!0;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount,buffer=new Array(l),holder=state.corkedRequestsFree;holder.entry=entry;for(var count=0;entry;)entry=(buffer[count]=entry).next,count+=1;doWrite(stream,state,!0,state.length,buffer,"",holder.finish),state.pendingcb++,state.lastBufferedRequest=null,holder.next?(state.corkedRequestsFree=holder.next,holder.next=null):state.corkedRequestsFree=new CorkedRequest(state)}else{for(;entry;){var chunk=entry.chunk,encoding=entry.encoding,cb=entry.callback;if(doWrite(stream,state,!1,state.objectMode?1:chunk.length,chunk,encoding,cb),entry=entry.next,state.writing)break}null===entry&&(state.lastBufferedRequest=null)}state.bufferedRequestCount=0,state.bufferedRequest=entry,state.bufferProcessing=!1}function needFinish(state){return state.ending&&0===state.length&&null===state.bufferedRequest&&!state.finished&&!state.writing}function prefinish(stream,state){state.prefinished||(state.prefinished=!0,stream.emit("prefinish"))}function finishMaybe(stream,state){var need=needFinish(state);return need&&(0===state.pendingcb?(prefinish(stream,state),state.finished=!0,stream.emit("finish")):prefinish(stream,state)),need}function CorkedRequest(state){var _this=this;this.next=null,this.entry=null,this.finish=function(err){var entry=_this.entry;for(_this.entry=null;entry;){var cb=entry.callback;state.pendingcb--,cb(err),entry=entry.next}state.corkedRequestsFree?state.corkedRequestsFree.next=_this:state.corkedRequestsFree=_this}}Readable.prototype.read=function(n){debug("read",n),n=parseInt(n,10);var state=this._readableState,nOrig=n;if(0!==n&&(state.emittedReadable=!1),0===n&&state.needReadable&&(state.length>=state.highWaterMark||state.ended))return debug("read: emitReadable",state.length,state.ended),0===state.length&&state.ended?endReadable(this):emitReadable(this),null;if(0===(n=howMuchToRead(n,state))&&state.ended)return 0===state.length&&endReadable(this),null;var ret,doRead=state.needReadable;return debug("need readable",doRead),(0===state.length||state.length-n<state.highWaterMark)&&debug("length less than watermark",doRead=!0),state.ended||state.reading?debug("reading or ended",doRead=!1):doRead&&(debug("do read"),state.reading=!0,state.sync=!0,0===state.length&&(state.needReadable=!0),this._read(state.highWaterMark),state.sync=!1,state.reading||(n=howMuchToRead(nOrig,state))),null===(ret=0<n?fromList(n,state):null)?(state.needReadable=!0,n=0):state.length-=n,0===state.length&&(state.ended||(state.needReadable=!0),nOrig!==n&&state.ended&&endReadable(this)),null!==ret&&this.emit("data",ret),ret},Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))},Readable.prototype.pipe=function(dest,pipeOpts){var src=this,state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest)}state.pipesCount+=1,debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var endFn=!pipeOpts||!1!==pipeOpts.end?onend:cleanup;function onunpipe(readable){debug("onunpipe"),readable===src&&cleanup()}function onend(){debug("onend"),dest.end()}state.endEmitted?nextTick(endFn):src.once("end",endFn),dest.on("unpipe",onunpipe);var ondrain=function(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain),state.awaitDrain&&state.awaitDrain--,0===state.awaitDrain&&src.listeners("data").length&&(state.flowing=!0,flow(src))}}(src);dest.on("drain",ondrain);var cleanedUp=!1;function cleanup(){debug("cleanup"),dest.removeListener("close",onclose),dest.removeListener("finish",onfinish),dest.removeListener("drain",ondrain),dest.removeListener("error",onerror),dest.removeListener("unpipe",onunpipe),src.removeListener("end",onend),src.removeListener("end",cleanup),src.removeListener("data",ondata),cleanedUp=!0,!state.awaitDrain||dest._writableState&&!dest._writableState.needDrain||ondrain()}var increasedAwaitDrain=!1;function ondata(chunk){debug("ondata"),(increasedAwaitDrain=!1)!==dest.write(chunk)||increasedAwaitDrain||((1===state.pipesCount&&state.pipes===dest||1<state.pipesCount&&-1!==indexOf(state.pipes,dest))&&!cleanedUp&&(debug("false write response, pause",src._readableState.awaitDrain),src._readableState.awaitDrain++,increasedAwaitDrain=!0),src.pause())}function onerror(er){var type;debug("onerror",er),unpipe(),dest.removeListener("error",onerror),0===(type="error",dest.listeners(type).length)&&dest.emit("error",er)}function onclose(){dest.removeListener("finish",onfinish),unpipe()}function onfinish(){debug("onfinish"),dest.removeListener("close",onclose),unpipe()}function unpipe(){debug("unpipe"),src.unpipe(dest)}return src.on("data",ondata),function(emitter,event,fn){if("function"==typeof emitter.prependListener)return emitter.prependListener(event,fn);emitter._events&&emitter._events[event]?Array.isArray(emitter._events[event])?emitter._events[event].unshift(fn):emitter._events[event]=[fn,emitter._events[event]]:emitter.on(event,fn)}(dest,"error",onerror),dest.once("close",onclose),dest.once("finish",onfinish),dest.emit("pipe",src),state.flowing||(debug("pipe resume"),src.resume()),dest},Readable.prototype.unpipe=function(dest){var state=this._readableState;if(0===state.pipesCount)return this;if(1===state.pipesCount)return dest&&dest!==state.pipes||(dest||(dest=state.pipes),state.pipes=null,state.pipesCount=0,state.flowing=!1,dest&&dest.emit("unpipe",this)),this;if(!dest){var dests=state.pipes,len=state.pipesCount;state.pipes=null,state.pipesCount=0,state.flowing=!1;for(var _i=0;_i<len;_i++)dests[_i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);return-1===i||(state.pipes.splice(i,1),state.pipesCount-=1,1===state.pipesCount&&(state.pipes=state.pipes[0]),dest.emit("unpipe",this)),this},Readable.prototype.addListener=Readable.prototype.on=function(ev,fn){var res=EventEmitter.prototype.on.call(this,ev,fn);if("data"===ev)!1!==this._readableState.flowing&&this.resume();else if("readable"===ev){var state=this._readableState;state.endEmitted||state.readableListening||(state.readableListening=state.needReadable=!0,state.emittedReadable=!1,state.reading?state.length&&emitReadable(this):nextTick(nReadingNextTick,this))}return res},Readable.prototype.resume=function(){var state=this._readableState;return state.flowing||(debug("resume"),state.flowing=!0,function(stream,state){state.resumeScheduled||(state.resumeScheduled=!0,nextTick(resume_,stream,state))}(this,state)),this},Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(stream){var state=this._readableState,paused=!1,self=this;for(var i in stream.on("end",function(){if(debug("wrapped end"),state.decoder&&!state.ended){var chunk=state.decoder.end();chunk&&chunk.length&&self.push(chunk)}self.push(null)}),stream.on("data",function(chunk){(debug("wrapped data"),state.decoder&&(chunk=state.decoder.write(chunk)),state.objectMode&&null==chunk)||(state.objectMode||chunk&&chunk.length)&&(self.push(chunk)||(paused=!0,stream.pause()))}),stream)void 0===this[i]&&"function"==typeof stream[i]&&(this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i));return function(xs,f){for(var i=0,l=xs.length;i<l;i++)f(xs[i],i)}(["error","close","destroy","pause","resume"],function(ev){stream.on(ev,self.emit.bind(self,ev))}),self._read=function(n){debug("wrapped _read",n),paused&&(paused=!1,stream.resume())},self},Readable._fromList=fromList,Writable.WritableState=WritableState,inherits$1(Writable,EventEmitter),WritableState.prototype.getBuffer=function(){for(var current=this.bufferedRequest,out=[];current;)out.push(current),current=current.next;return out},Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState,ret=!1;return"function"==typeof encoding&&(cb=encoding,encoding=null),Buffer$1.isBuffer(chunk)?encoding="buffer":encoding||(encoding=state.defaultEncoding),"function"!=typeof cb&&(cb=nop),state.ended?function(stream,cb){var er=new Error("write after end");stream.emit("error",er),nextTick(cb,er)}(this,cb):function(stream,state,chunk,cb){var valid=!0,er=!1;return null===chunk?er=new TypeError("May not write null values to stream"):Buffer$1.isBuffer(chunk)||"string"==typeof chunk||void 0===chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk")),er&&(stream.emit("error",er),nextTick(cb,er),valid=!1),valid}(this,state,chunk,cb)&&(state.pendingcb++,ret=function(stream,state,chunk,encoding,cb){chunk=function(state,chunk,encoding){return state.objectMode||!1===state.decodeStrings||"string"!=typeof chunk||(chunk=Buffer$1.from(chunk,encoding)),chunk}(state,chunk,encoding),Buffer$1.isBuffer(chunk)&&(encoding="buffer");var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;ret||(state.needDrain=!0);if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest=new WriteReq(chunk,encoding,cb),last?last.next=state.lastBufferedRequest:state.bufferedRequest=state.lastBufferedRequest,state.bufferedRequestCount+=1}else doWrite(stream,state,!1,len,chunk,encoding,cb);return ret}(this,state,chunk,encoding,cb)),ret},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var state=this._writableState;state.corked&&(state.corked--,state.writing||state.corked||state.finished||state.bufferProcessing||!state.bufferedRequest||clearBuffer(this,state))},Writable.prototype.setDefaultEncoding=function(encoding){if("string"==typeof encoding&&(encoding=encoding.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())))throw new TypeError("Unknown encoding: "+encoding);return this._writableState.defaultEncoding=encoding,this},Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;"function"==typeof chunk?(cb=chunk,encoding=chunk=null):"function"==typeof encoding&&(cb=encoding,encoding=null),null!=chunk&&this.write(chunk,encoding),state.corked&&(state.corked=1,this.uncork()),state.ending||state.finished||function(stream,state,cb){state.ending=!0,finishMaybe(stream,state),cb&&(state.finished?nextTick(cb):stream.once("finish",cb));state.ended=!0,stream.writable=!1}(this,state,cb)},inherits$1(Duplex,Readable);for(var keys=Object.keys(Writable.prototype),v=0;v<keys.length;v++){var method=keys[v];Duplex.prototype[method]||(Duplex.prototype[method]=Writable.prototype[method])}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options),Writable.call(this,options),options&&!1===options.readable&&(this.readable=!1),options&&!1===options.writable&&(this.writable=!1),this.allowHalfOpen=!0,options&&!1===options.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",onend)}function onend(){this.allowHalfOpen||this._writableState.ended||nextTick(onEndNT,this)}function onEndNT(self){self.end()}function TransformState(stream){this.afterTransform=function(er,data){return function(stream,er,data){var ts=stream._transformState;ts.transforming=!1;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null,(ts.writecb=null)!=data&&stream.push(data);cb(er);var rs=stream._readableState;rs.reading=!1,(rs.needReadable||rs.length<rs.highWaterMark)&&stream._read(rs.highWaterMark)}(stream,er,data)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options),this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=!0,this._readableState.sync=!1,options&&("function"==typeof options.transform&&(this._transform=options.transform),"function"==typeof options.flush&&(this._flush=options.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(er){done(stream,er)}):done(stream)})}function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState,ts=stream._transformState;if(ws.length)throw new Error("Calling transform done when ws.length != 0");if(ts.transforming)throw new Error("Calling transform done when still transforming");return stream.push(null)}function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}function Stream(){EventEmitter.call(this)}inherits$1(Transform,Duplex),Transform.prototype.push=function(chunk,encoding){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,chunk,encoding)},Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("Not implemented")},Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;if(ts.writecb=cb,ts.writechunk=chunk,ts.writeencoding=encoding,!ts.transforming){var rs=this._readableState;(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)&&this._read(rs.highWaterMark)}},Transform.prototype._read=function(n){var ts=this._transformState;null!==ts.writechunk&&ts.writecb&&!ts.transforming?(ts.transforming=!0,this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)):ts.needTransform=!0},inherits$1(PassThrough,Transform),PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)},inherits$1(Stream,EventEmitter),Stream.Readable=Readable,Stream.Writable=Writable,Stream.Duplex=Duplex,Stream.Transform=Transform,Stream.PassThrough=PassThrough,(Stream.Stream=Stream).prototype.pipe=function(dest,options){var source=this;function ondata(chunk){dest.writable&&!1===dest.write(chunk)&&source.pause&&source.pause()}function ondrain(){source.readable&&source.resume&&source.resume()}source.on("data",ondata),dest.on("drain",ondrain),dest._isStdio||options&&!1===options.end||(source.on("end",onend),source.on("close",onclose));var didOnEnd=!1;function onend(){didOnEnd||(didOnEnd=!0,dest.end())}function onclose(){didOnEnd||(didOnEnd=!0,"function"==typeof dest.destroy&&dest.destroy())}function onerror(er){if(cleanup(),0===EventEmitter.listenerCount(this,"error"))throw er}function cleanup(){source.removeListener("data",ondata),dest.removeListener("drain",ondrain),source.removeListener("end",onend),source.removeListener("close",onclose),source.removeListener("error",onerror),dest.removeListener("error",onerror),source.removeListener("end",cleanup),source.removeListener("close",cleanup),dest.removeListener("close",cleanup)}return source.on("error",onerror),dest.on("error",onerror),source.on("end",cleanup),source.on("close",cleanup),dest.on("close",cleanup),dest.emit("pipe",source),dest};var rStates_LOADING=3,rStates_DONE=4;function IncomingMessage(xhr,response,mode){var read,self=this;if(Readable.call(self),self._mode=mode,self.headers={},self.rawHeaders=[],self.trailers={},self.rawTrailers=[],self.on("end",function(){process.nextTick(function(){self.emit("close")})}),"fetch"===mode){self._fetchResponse=response,self.url=response.url,self.statusCode=response.status,self.statusMessage=response.statusText;for(var header,_i,_it=response.headers[Symbol.iterator]();header=(_i=_it.next()).value,!_i.done;)self.headers[header[0].toLowerCase()]=header[1],self.rawHeaders.push(header[0],header[1]);var reader=response.body.getReader();(read=function(){reader.read().then(function(result){self._destroyed||(result.done?self.push(null):(self.push(new Buffer(result.value)),read()))})})()}else{if(self._xhr=xhr,self._pos=0,self.url=xhr.responseURL,self.statusCode=xhr.status,self.statusMessage=xhr.statusText,xhr.getAllResponseHeaders().split(/\r?\n/).forEach(function(header){var matches=header.match(/^([^:]+):\s*(.*)/);if(matches){var key=matches[1].toLowerCase();"set-cookie"===key?(void 0===self.headers[key]&&(self.headers[key]=[]),self.headers[key].push(matches[2])):void 0!==self.headers[key]?self.headers[key]+=", "+matches[2]:self.headers[key]=matches[2],self.rawHeaders.push(matches[1],matches[2])}}),self._charset="x-user-defined",!overrideMimeType){var mimeType=self.rawHeaders["mime-type"];if(mimeType){var charsetMatch=mimeType.match(/;\s*charset=([^;])(;|$)/);charsetMatch&&(self._charset=charsetMatch[1].toLowerCase())}self._charset||(self._charset="utf-8")}}}function ClientRequest(opts){var preferBinary,self=this;Writable.call(self),self._opts=opts,self._body=[],self._headers={},opts.auth&&self.setHeader("Authorization","Basic "+new Buffer(opts.auth).toString("base64")),Object.keys(opts.headers).forEach(function(name){self.setHeader(name,opts.headers[name])});var useFetch=!0;if("disable-fetch"===opts.mode)preferBinary=!(useFetch=!1);else if("prefer-streaming"===opts.mode)preferBinary=!1;else if("allow-wrong-content-type"===opts.mode)preferBinary=!overrideMimeType;else{if(opts.mode&&"default"!==opts.mode&&"prefer-fast"!==opts.mode)throw new Error("Invalid value for opts.mode");preferBinary=!0}self._mode=function(preferBinary,useFetch){return hasFetch&&useFetch?"fetch":mozchunkedarraybuffer?"moz-chunked-arraybuffer":msstream?"ms-stream":arraybuffer&&preferBinary?"arraybuffer":vbArray&&preferBinary?"text:vbarray":"text"}(preferBinary,useFetch),self.on("finish",function(){self._onFinish()})}inherits$1(IncomingMessage,Readable),IncomingMessage.prototype._read=function(){},IncomingMessage.prototype._onXHRProgress=function(){var self=this,xhr=self._xhr,response=null;switch(self._mode){case"text:vbarray":if(xhr.readyState!==rStates_DONE)break;try{response=new global.VBArray(xhr.responseBody).toArray()}catch(e){}if(null!==response){self.push(new Buffer(response));break}case"text":try{response=xhr.responseText}catch(e){self._mode="text:vbarray";break}if(response.length>self._pos){var newData=response.substr(self._pos);if("x-user-defined"===self._charset){for(var buffer=new Buffer(newData.length),i=0;i<newData.length;i++)buffer[i]=255&newData.charCodeAt(i);self.push(buffer)}else self.push(newData,self._charset);self._pos=response.length}break;case"arraybuffer":if(xhr.readyState!==rStates_DONE||!xhr.response)break;response=xhr.response,self.push(new Buffer(new Uint8Array(response)));break;case"moz-chunked-arraybuffer":if(response=xhr.response,xhr.readyState!==rStates_LOADING||!response)break;self.push(new Buffer(new Uint8Array(response)));break;case"ms-stream":if(response=xhr.response,xhr.readyState!==rStates_LOADING)break;var reader=new global.MSStreamReader;reader.onprogress=function(){reader.result.byteLength>self._pos&&(self.push(new Buffer(new Uint8Array(reader.result.slice(self._pos)))),self._pos=reader.result.byteLength)},reader.onload=function(){self.push(null)},reader.readAsArrayBuffer(response)}self._xhr.readyState===rStates_DONE&&"ms-stream"!==self._mode&&self.push(null)},inherits$1(ClientRequest,Writable);var unsafeHeaders=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];ClientRequest.prototype.setHeader=function(name,value){var lowerName=name.toLowerCase();-1===unsafeHeaders.indexOf(lowerName)&&(this._headers[lowerName]={name:name,value:value})},ClientRequest.prototype.getHeader=function(name){return this._headers[name.toLowerCase()].value},ClientRequest.prototype.removeHeader=function(name){delete this._headers[name.toLowerCase()]},ClientRequest.prototype._onFinish=function(){var self=this;if(!self._destroyed){var body,opts=self._opts,headersObj=self._headers;if("POST"!==opts.method&&"PUT"!==opts.method&&"PATCH"!==opts.method||(body=function(){if(void 0!==_blobConstructor)return _blobConstructor;try{new global.Blob([new ArrayBuffer(1)]),_blobConstructor=!0}catch(e){_blobConstructor=!1}return _blobConstructor}()?new global.Blob(self._body.map(function(buffer){return function(buf){if(buf instanceof Uint8Array){if(0===buf.byteOffset&&buf.byteLength===buf.buffer.byteLength)return buf.buffer;if("function"==typeof buf.buffer.slice)return buf.buffer.slice(buf.byteOffset,buf.byteOffset+buf.byteLength)}if(isBuffer$1(buf)){for(var arrayCopy=new Uint8Array(buf.length),len=buf.length,i=0;i<len;i++)arrayCopy[i]=buf[i];return arrayCopy.buffer}throw new Error("Argument must be a Buffer")}(buffer)}),{type:(headersObj["content-type"]||{}).value||""}):Buffer.concat(self._body).toString()),"fetch"===self._mode){var headers=Object.keys(headersObj).map(function(name){return[headersObj[name].name,headersObj[name].value]});global.fetch(self._opts.url,{method:self._opts.method,headers:headers,body:body,mode:"cors",credentials:opts.withCredentials?"include":"same-origin"}).then(function(response){self._fetchResponse=response,self._connect()},function(reason){self.emit("error",reason)})}else{var xhr=self._xhr=new global.XMLHttpRequest;try{xhr.open(self._opts.method,self._opts.url,!0)}catch(err){return void process.nextTick(function(){self.emit("error",err)})}"responseType"in xhr&&(xhr.responseType=self._mode.split(":")[0]),"withCredentials"in xhr&&(xhr.withCredentials=!!opts.withCredentials),"text"===self._mode&&"overrideMimeType"in xhr&&xhr.overrideMimeType("text/plain; charset=x-user-defined"),Object.keys(headersObj).forEach(function(name){xhr.setRequestHeader(headersObj[name].name,headersObj[name].value)}),self._response=null,xhr.onreadystatechange=function(){switch(xhr.readyState){case rStates_LOADING:case rStates_DONE:self._onXHRProgress()}},"moz-chunked-arraybuffer"===self._mode&&(xhr.onprogress=function(){self._onXHRProgress()}),xhr.onerror=function(){self._destroyed||self.emit("error",new Error("XHR error"))};try{xhr.send(body)}catch(err){return void process.nextTick(function(){self.emit("error",err)})}}}},ClientRequest.prototype._onXHRProgress=function(){(function(xhr){try{var status=xhr.status;return null!==status&&0!==status}catch(e){return!1}})(this._xhr)&&!this._destroyed&&(this._response||this._connect(),this._response._onXHRProgress())},ClientRequest.prototype._connect=function(){this._destroyed||(this._response=new IncomingMessage(this._xhr,this._fetchResponse,this._mode),this.emit("response",this._response))},ClientRequest.prototype._write=function(chunk,encoding,cb){this._body.push(chunk),cb()},ClientRequest.prototype.abort=ClientRequest.prototype.destroy=function(){this._destroyed=!0,this._response&&(this._response._destroyed=!0),this._xhr&&this._xhr.abort()},ClientRequest.prototype.end=function(data,encoding,cb){"function"==typeof data&&(cb=data,data=void 0),Writable.prototype.end.call(this,data,encoding,cb)},ClientRequest.prototype.flushHeaders=function(){},ClientRequest.prototype.setTimeout=function(){},ClientRequest.prototype.setNoDelay=function(){},ClientRequest.prototype.setSocketKeepAlive=function(){};var maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode;function error(type){throw new RangeError(errors[type])}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((0!=flag)<<5)}function adapt(delta,numPoints,firstTime){var k=0;for(delta=firstTime?floor(delta/damp):delta>>1,delta+=floor(delta/numPoints);baseMinusTMin*tMax>>1<delta;k+=base)delta=floor(delta/baseMinusTMin);return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function toASCII(input){return function(string,fn){var parts=string.split("@"),result="";1<parts.length&&(result=parts[0]+"@",string=parts[1]);var encoded=function(array,fn){for(var length=array.length,result=[];length--;)result[length]=fn(array[length]);return result}((string=string.replace(regexSeparators,".")).split("."),fn).join(".");return result+encoded}(input,function(string){return regexNonASCII.test(string)?"xn--"+function(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,inputLength,handledCPCountPlusOne,baseMinusT,qMinusT,output=[];for(inputLength=(input=function(string){for(var value,extra,output=[],counter=0,length=string.length;counter<length;)55296<=(value=string.charCodeAt(counter++))&&value<=56319&&counter<length?56320==(64512&(extra=string.charCodeAt(counter++)))?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--):output.push(value);return output}(input)).length,n=initialN,bias=initialBias,j=delta=0;j<inputLength;++j)(currentValue=input[j])<128&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push(delimiter);handledCPCount<inputLength;){for(m=maxInt,j=0;j<inputLength;++j)n<=(currentValue=input[j])&&currentValue<m&&(m=currentValue);for(m-n>floor((maxInt-delta)/(handledCPCountPlusOne=handledCPCount+1))&&error("overflow"),delta+=(m-n)*handledCPCountPlusOne,n=m,j=0;j<inputLength;++j)if((currentValue=input[j])<n&&++delta>maxInt&&error("overflow"),currentValue==n){for(q=delta,k=base;!(q<(t=k<=bias?tMin:bias+tMax<=k?tMax:k-bias));k+=base)qMinusT=q-t,baseMinusT=base-t,output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0))),q=floor(qMinusT/baseMinusT);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength),delta=0,++handledCPCount}++delta,++n}return output.join("")}(string):string})}var url={parse:urlParse,resolve:urlResolve,resolveObject:urlResolveObject,format:urlFormat,Url:Url};function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,unwise=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&isObject(url)&&url instanceof Url)return url;var u=new Url;return u.parse(url,parseQueryString,slashesDenoteHost),u}function parse$1(self,url,parseQueryString,slashesDenoteHost){if(!isString(url))throw new TypeError("Parameter 'url' must be a string, not "+typeof url);var queryIndex=url.indexOf("?"),splitter=-1!==queryIndex&&queryIndex<url.indexOf("#")?"?":"#",uSplit=url.split(splitter);uSplit[0]=uSplit[0].replace(/\\/g,"/");var rest=url=uSplit.join(splitter);if(rest=rest.trim(),!slashesDenoteHost&&1===url.split("#").length){var simplePath=simplePathPattern.exec(rest);if(simplePath)return self.path=rest,self.href=rest,self.pathname=simplePath[1],simplePath[2]?(self.search=simplePath[2],self.query=parseQueryString?parse(self.search.substr(1)):self.search.substr(1)):parseQueryString&&(self.search="",self.query={}),self}var i,hec,l,p,proto=protocolPattern.exec(rest);if(proto){var lowerProto=(proto=proto[0]).toLowerCase();self.protocol=lowerProto,rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes="//"===rest.substr(0,2);!slashes||proto&&hostlessProtocol[proto]||(rest=rest.substr(2),self.slashes=!0)}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){var auth,atSign,hostEnd=-1;for(i=0;i<hostEndingChars.length;i++)-1!==(hec=rest.indexOf(hostEndingChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec);for(-1!==(atSign=-1===hostEnd?rest.lastIndexOf("@"):rest.lastIndexOf("@",hostEnd))&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),self.auth=decodeURIComponent(auth)),hostEnd=-1,i=0;i<nonHostChars.length;i++)-1!==(hec=rest.indexOf(nonHostChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec);-1===hostEnd&&(hostEnd=rest.length),self.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),parseHost(self),self.hostname=self.hostname||"";var ipv6Hostname="["===self.hostname[0]&&"]"===self.hostname[self.hostname.length-1];if(!ipv6Hostname){var hostparts=self.hostname.split(/\./);for(i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(part&&!part.match(hostnamePartPattern)){for(var newpart="",j=0,k=part.length;j<k;j++)127<part.charCodeAt(j)?newpart+="x":newpart+=part[j];if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(hostnamePartStart);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest="/"+notHost.join(".")+rest),self.hostname=validParts.join(".");break}}}}self.hostname.length>hostnameMaxLen?self.hostname="":self.hostname=self.hostname.toLowerCase(),ipv6Hostname||(self.hostname=toASCII(self.hostname)),p=self.port?":"+self.port:"";var h=self.hostname||"";self.host=h+p,self.href+=self.host,ipv6Hostname&&(self.hostname=self.hostname.substr(1,self.hostname.length-2),"/"!==rest[0]&&(rest="/"+rest))}if(!unsafeProtocol[lowerProto])for(i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(-1!==rest.indexOf(ae)){var esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");-1!==hash&&(self.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf("?");if(-1!==qm?(self.search=rest.substr(qm),self.query=rest.substr(qm+1),parseQueryString&&(self.query=parse(self.query)),rest=rest.slice(0,qm)):parseQueryString&&(self.search="",self.query={}),rest&&(self.pathname=rest),slashedProtocol[lowerProto]&&self.hostname&&!self.pathname&&(self.pathname="/"),self.pathname||self.search){p=self.pathname||"";var s=self.search||"";self.path=p+s}return self.href=format$1(self),self}function urlFormat(obj){return isString(obj)&&(obj=parse$1({},obj)),format$1(obj)}function format$1(self){var auth=self.auth||"";auth&&(auth=(auth=encodeURIComponent(auth)).replace(/%3A/i,":"),auth+="@");var protocol=self.protocol||"",pathname=self.pathname||"",hash=self.hash||"",host=!1,query="";self.host?host=auth+self.host:self.hostname&&(host=auth+(-1===self.hostname.indexOf(":")?self.hostname:"["+this.hostname+"]"),self.port&&(host+=":"+self.port)),self.query&&isObject(self.query)&&Object.keys(self.query).length&&(query=stringify(self.query));var search=self.search||query&&"?"+query||"";return protocol&&":"!==protocol.substr(-1)&&(protocol+=":"),self.slashes||(!protocol||slashedProtocol[protocol])&&!1!==host?(host="//"+(host||""),pathname&&"/"!==pathname.charAt(0)&&(pathname="/"+pathname)):host||(host=""),hash&&"#"!==hash.charAt(0)&&(hash="#"+hash),search&&"?"!==search.charAt(0)&&(search="?"+search),protocol+host+(pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)}))+(search=search.replace("#","%23"))+hash}function urlResolve(source,relative){return urlParse(source,!1,!0).resolve(relative)}function urlResolveObject(source,relative){return source?urlParse(source,!1,!0).resolveObject(relative):relative}function parseHost(self){var host=self.host,port=portPattern.exec(host);port&&(":"!==(port=port[0])&&(self.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(self.hostname=host)}Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){return parse$1(this,url,parseQueryString,slashesDenoteHost)},Url.prototype.format=function(){return format$1(this)},Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()},Url.prototype.resolveObject=function(relative){if(isString(relative)){var rel=new Url;rel.parse(relative,!1,!0),relative=rel}for(var relPath,result=new Url,tkeys=Object.keys(this),tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}if(result.hash=relative.hash,""===relative.href)return result.href=result.format(),result;if(relative.slashes&&!relative.protocol){for(var rkeys=Object.keys(relative),rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];"protocol"!==rkey&&(result[rkey]=relative[rkey])}return slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname="/"),result.href=result.format(),result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){for(var keys=Object.keys(relative),v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}return result.href=result.format(),result}if(result.protocol=relative.protocol,relative.host||hostlessProtocol[relative.protocol])result.pathname=relative.pathname;else{for(relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=""),relative.hostname||(relative.hostname=""),""!==relPath[0]&&relPath.unshift(""),relPath.length<2&&relPath.unshift(""),result.pathname=relPath.join("/")}if(result.search=relative.search,result.query=relative.query,result.host=relative.host||"",result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,result.pathname||result.search){var p=result.pathname||"",s=result.search||"";result.path=p+s}return result.slashes=result.slashes||relative.slashes,result.href=result.format(),result}var authInHost,isSourceAbs=result.pathname&&"/"===result.pathname.charAt(0),isRelAbs=relative.host||relative.pathname&&"/"===relative.pathname.charAt(0),mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic&&(result.hostname="",result.port=null,result.host&&(""===srcPath[0]?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host="",relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(""===relPath[0]?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),mustEndAbs=mustEndAbs&&(""===relPath[0]||""===srcPath[0])),isRelAbs)result.host=relative.host||""===relative.host?relative.host:result.host,result.hostname=relative.hostname||""===relative.hostname?relative.hostname:result.hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)srcPath||(srcPath=[]),srcPath.pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(null!=relative.search)return psychotic&&(result.hostname=result.host=srcPath.shift(),(authInHost=!!(result.host&&0<result.host.indexOf("@"))&&result.host.split("@"))&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())),result.search=relative.search,result.query=relative.query,isNull(result.pathname)&&isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.href=result.format(),result;if(!srcPath.length)return result.pathname=null,result.search?result.path="/"+result.search:result.path=null,result.href=result.format(),result;for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host||1<srcPath.length)&&("."===last||".."===last)||""===last,up=0,i=srcPath.length;0<=i;i--)"."===(last=srcPath[i])?srcPath.splice(i,1):".."===last?(srcPath.splice(i,1),up++):up&&(srcPath.splice(i,1),up--);if(!mustEndAbs&&!removeAllDots)for(;up--;up)srcPath.unshift("..");!mustEndAbs||""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0)||srcPath.unshift(""),hasTrailingSlash&&"/"!==srcPath.join("/").substr(-1)&&srcPath.push("");var isAbsolute=""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0);return psychotic&&(result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"",(authInHost=!!(result.host&&0<result.host.indexOf("@"))&&result.host.split("@"))&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())),(mustEndAbs=mustEndAbs||result.host&&srcPath.length)&&!isAbsolute&&srcPath.unshift(""),srcPath.length?result.pathname=srcPath.join("/"):(result.pathname=null,result.path=null),isNull(result.pathname)&&isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.auth=relative.auth||result.auth,result.slashes=result.slashes||relative.slashes,result.href=result.format(),result},Url.prototype.parseHost=function(){return parseHost(this)};var url$1=Object.freeze({parse:urlParse,resolve:urlResolve,resolveObject:urlResolveObject,format:urlFormat,default:url,Url:Url});function request(opts,cb){"string"==typeof opts&&(opts=urlParse(opts));var defaultProtocol=-1===global.location.protocol.search(/^https?:$/)?"http:":"",protocol=opts.protocol||defaultProtocol,host=opts.hostname||opts.host,port=opts.port,path=opts.path||"/";host&&-1!==host.indexOf(":")&&(host="["+host+"]"),opts.url=(host?protocol+"//"+host:"")+(port?":"+port:"")+path,opts.method=(opts.method||"GET").toUpperCase(),opts.headers=opts.headers||{};var req=new ClientRequest(opts);return cb&&req.on("response",cb),req}function get(opts,cb){var req=request(opts,cb);return req.end(),req}function Agent(){}Agent.defaultMaxSockets=4;var METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"],STATUS_CODES={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"},http={request:request,get:get,Agent:Agent,METHODS:METHODS,STATUS_CODES:STATUS_CODES},http$1=Object.freeze({request:request,get:get,Agent:Agent,METHODS:METHODS,STATUS_CODES:STATUS_CODES,default:http}),safeBuffer=createCommonjsModule(function(module,exports){var Buffer=bufferEs6.Buffer;function copyProps(src,dst){for(var key in src)dst[key]=src[key]}function SafeBuffer(arg,encodingOrOffset,length){return Buffer(arg,encodingOrOffset,length)}Buffer.from&&Buffer.alloc&&Buffer.allocUnsafe&&Buffer.allocUnsafeSlow?module.exports=bufferEs6:(copyProps(bufferEs6,exports),exports.Buffer=SafeBuffer),copyProps(Buffer,SafeBuffer),SafeBuffer.from=function(arg,encodingOrOffset,length){if("number"==typeof arg)throw new TypeError("Argument must not be a number");return Buffer(arg,encodingOrOffset,length)},SafeBuffer.alloc=function(size,fill,encoding){if("number"!=typeof size)throw new TypeError("Argument must be a number");var buf=Buffer(size);return void 0!==fill?"string"==typeof encoding?buf.fill(fill,encoding):buf.fill(fill):buf.fill(0),buf},SafeBuffer.allocUnsafe=function(size){if("number"!=typeof size)throw new TypeError("Argument must be a number");return Buffer(size)},SafeBuffer.allocUnsafeSlow=function(size){if("number"!=typeof size)throw new TypeError("Argument must be a number");return bufferEs6.SlowBuffer(size)}});safeBuffer.Buffer;function Queue(options){if(!(this instanceof Queue))return new Queue(options);options=options||{},this.concurrency=options.concurrency||1/0,this.pending=0,this.jobs=[],this.cbs=[],this._done=function(){this.pending--,this._run()}.bind(this)}["push","unshift","splice"].forEach(function(method){Queue.prototype[method]=function(){var methodResult=Array.prototype[method].apply(this.jobs,arguments);return this._run(),methodResult}}),Object.defineProperty(Queue.prototype,"length",{get:function(){return this.pending+this.jobs.length}}),Queue.prototype._run=function(){if(this.pending!==this.concurrency){if(this.jobs.length){var job=this.jobs.shift();this.pending++,job(this._done),this._run()}if(0===this.pending)for(;0!==this.cbs.length;){var cb=this.cbs.pop();process.nextTick(cb)}}},Queue.prototype.onDone=function(cb){"function"==typeof cb&&(this.cbs.push(cb),this._run())};var asyncLimiter=Queue,msg={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function arraySet(dest,src,src_offs,len,dest_offs){if(src.subarray&&dest.subarray)dest.set(src.subarray(src_offs,src_offs+len),dest_offs);else for(var i=0;i<len;i++)dest[dest_offs+i]=src[src_offs+i]}var Buf8=Uint8Array,Buf16=Uint16Array,Buf32=Int32Array,Z_FIXED=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN=2;function zero(buf){for(var len=buf.length;0<=--len;)buf[len]=0}var STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],static_ltree=new Array(2*(L_CODES+2));zero(static_ltree);var static_dtree=new Array(2*D_CODES);zero(static_dtree);var _dist_code=new Array(512);zero(_dist_code);var _length_code=new Array(256);zero(_length_code);var base_length=new Array(LENGTH_CODES);zero(base_length);var static_l_desc,static_d_desc,static_bl_desc,base_dist=new Array(D_CODES);function StaticTreeDesc(static_tree,extra_bits,extra_base,elems,max_length){this.static_tree=static_tree,this.extra_bits=extra_bits,this.extra_base=extra_base,this.elems=elems,this.max_length=max_length,this.has_stree=static_tree&&static_tree.length}function TreeDesc(dyn_tree,stat_desc){this.dyn_tree=dyn_tree,this.max_code=0,this.stat_desc=stat_desc}function d_code(dist){return dist<256?_dist_code[dist]:_dist_code[256+(dist>>>7)]}function put_short(s,w){s.pending_buf[s.pending++]=255&w,s.pending_buf[s.pending++]=w>>>8&255}function send_bits(s,value,length){s.bi_valid>Buf_size-length?(s.bi_buf|=value<<s.bi_valid&65535,put_short(s,s.bi_buf),s.bi_buf=value>>Buf_size-s.bi_valid,s.bi_valid+=length-Buf_size):(s.bi_buf|=value<<s.bi_valid&65535,s.bi_valid+=length)}function send_code(s,c,tree){send_bits(s,tree[2*c],tree[2*c+1])}function bi_reverse(code,len){for(var res=0;res|=1&code,code>>>=1,res<<=1,0<--len;);return res>>>1}function gen_codes(tree,max_code,bl_count){var bits,n,next_code=new Array(MAX_BITS+1),code=0;for(bits=1;bits<=MAX_BITS;bits++)next_code[bits]=code=code+bl_count[bits-1]<<1;for(n=0;n<=max_code;n++){var len=tree[2*n+1];0!==len&&(tree[2*n]=bi_reverse(next_code[len]++,len))}}function init_block(s){var n;for(n=0;n<L_CODES;n++)s.dyn_ltree[2*n]=0;for(n=0;n<D_CODES;n++)s.dyn_dtree[2*n]=0;for(n=0;n<BL_CODES;n++)s.bl_tree[2*n]=0;s.dyn_ltree[2*END_BLOCK]=1,s.opt_len=s.static_len=0,s.last_lit=s.matches=0}function bi_windup(s){8<s.bi_valid?put_short(s,s.bi_buf):0<s.bi_valid&&(s.pending_buf[s.pending++]=s.bi_buf),s.bi_buf=0,s.bi_valid=0}function smaller(tree,n,m,depth){var _n2=2*n,_m2=2*m;return tree[_n2]<tree[_m2]||tree[_n2]===tree[_m2]&&depth[n]<=depth[m]}function pqdownheap(s,tree,k){for(var v=s.heap[k],j=k<<1;j<=s.heap_len&&(j<s.heap_len&&smaller(tree,s.heap[j+1],s.heap[j],s.depth)&&j++,!smaller(tree,v,s.heap[j],s.depth));)s.heap[k]=s.heap[j],k=j,j<<=1;s.heap[k]=v}function compress_block(s,ltree,dtree){var dist,lc,code,extra,lx=0;if(0!==s.last_lit)for(;dist=s.pending_buf[s.d_buf+2*lx]<<8|s.pending_buf[s.d_buf+2*lx+1],lc=s.pending_buf[s.l_buf+lx],lx++,0===dist?send_code(s,lc,ltree):(send_code(s,(code=_length_code[lc])+LITERALS+1,ltree),0!==(extra=extra_lbits[code])&&send_bits(s,lc-=base_length[code],extra),send_code(s,code=d_code(--dist),dtree),0!==(extra=extra_dbits[code])&&send_bits(s,dist-=base_dist[code],extra)),lx<s.last_lit;);send_code(s,END_BLOCK,ltree)}function build_tree(s,desc){var n,m,node,tree=desc.dyn_tree,stree=desc.stat_desc.static_tree,has_stree=desc.stat_desc.has_stree,elems=desc.stat_desc.elems,max_code=-1;for(s.heap_len=0,s.heap_max=HEAP_SIZE,n=0;n<elems;n++)0!==tree[2*n]?(s.heap[++s.heap_len]=max_code=n,s.depth[n]=0):tree[2*n+1]=0;for(;s.heap_len<2;)tree[2*(node=s.heap[++s.heap_len]=max_code<2?++max_code:0)]=1,s.depth[node]=0,s.opt_len--,has_stree&&(s.static_len-=stree[2*node+1]);for(desc.max_code=max_code,n=s.heap_len>>1;1<=n;n--)pqdownheap(s,tree,n);for(node=elems;n=s.heap[1],s.heap[1]=s.heap[s.heap_len--],pqdownheap(s,tree,1),m=s.heap[1],s.heap[--s.heap_max]=n,s.heap[--s.heap_max]=m,tree[2*node]=tree[2*n]+tree[2*m],s.depth[node]=(s.depth[n]>=s.depth[m]?s.depth[n]:s.depth[m])+1,tree[2*n+1]=tree[2*m+1]=node,s.heap[1]=node++,pqdownheap(s,tree,1),2<=s.heap_len;);s.heap[--s.heap_max]=s.heap[1],function(s,desc){var h,n,m,bits,xbits,f,tree=desc.dyn_tree,max_code=desc.max_code,stree=desc.stat_desc.static_tree,has_stree=desc.stat_desc.has_stree,extra=desc.stat_desc.extra_bits,base=desc.stat_desc.extra_base,max_length=desc.stat_desc.max_length,overflow=0;for(bits=0;bits<=MAX_BITS;bits++)s.bl_count[bits]=0;for(tree[2*s.heap[s.heap_max]+1]=0,h=s.heap_max+1;h<HEAP_SIZE;h++)max_length<(bits=tree[2*tree[2*(n=s.heap[h])+1]+1]+1)&&(bits=max_length,overflow++),tree[2*n+1]=bits,max_code<n||(s.bl_count[bits]++,xbits=0,base<=n&&(xbits=extra[n-base]),f=tree[2*n],s.opt_len+=f*(bits+xbits),has_stree&&(s.static_len+=f*(stree[2*n+1]+xbits)));if(0!==overflow){do{for(bits=max_length-1;0===s.bl_count[bits];)bits--;s.bl_count[bits]--,s.bl_count[bits+1]+=2,s.bl_count[max_length]--,overflow-=2}while(0<overflow);for(bits=max_length;0!==bits;bits--)for(n=s.bl_count[bits];0!==n;)max_code<(m=s.heap[--h])||(tree[2*m+1]!==bits&&(s.opt_len+=(bits-tree[2*m+1])*tree[2*m],tree[2*m+1]=bits),n--)}}(s,desc),gen_codes(tree,max_code,s.bl_count)}function scan_tree(s,tree,max_code){var n,curlen,prevlen=-1,nextlen=tree[1],count=0,max_count=7,min_count=4;for(0===nextlen&&(max_count=138,min_count=3),tree[2*(max_code+1)+1]=65535,n=0;n<=max_code;n++)curlen=nextlen,nextlen=tree[2*(n+1)+1],++count<max_count&&curlen===nextlen||(count<min_count?s.bl_tree[2*curlen]+=count:0!==curlen?(curlen!==prevlen&&s.bl_tree[2*curlen]++,s.bl_tree[2*REP_3_6]++):count<=10?s.bl_tree[2*REPZ_3_10]++:s.bl_tree[2*REPZ_11_138]++,prevlen=curlen,(count=0)===nextlen?(max_count=138,min_count=3):curlen===nextlen?(max_count=6,min_count=3):(max_count=7,min_count=4))}function send_tree(s,tree,max_code){var n,curlen,prevlen=-1,nextlen=tree[1],count=0,max_count=7,min_count=4;for(0===nextlen&&(max_count=138,min_count=3),n=0;n<=max_code;n++)if(curlen=nextlen,nextlen=tree[2*(n+1)+1],!(++count<max_count&&curlen===nextlen)){if(count<min_count)for(;send_code(s,curlen,s.bl_tree),0!=--count;);else 0!==curlen?(curlen!==prevlen&&(send_code(s,curlen,s.bl_tree),count--),send_code(s,REP_3_6,s.bl_tree),send_bits(s,count-3,2)):count<=10?(send_code(s,REPZ_3_10,s.bl_tree),send_bits(s,count-3,3)):(send_code(s,REPZ_11_138,s.bl_tree),send_bits(s,count-11,7));prevlen=curlen,(count=0)===nextlen?(max_count=138,min_count=3):curlen===nextlen?(max_count=6,min_count=3):(max_count=7,min_count=4)}}zero(base_dist);var static_init_done=!1;function _tr_init(s){static_init_done||(!function(){var n,bits,length,code,dist,bl_count=new Array(MAX_BITS+1);for(code=length=0;code<LENGTH_CODES-1;code++)for(base_length[code]=length,n=0;n<1<<extra_lbits[code];n++)_length_code[length++]=code;for(_length_code[length-1]=code,code=dist=0;code<16;code++)for(base_dist[code]=dist,n=0;n<1<<extra_dbits[code];n++)_dist_code[dist++]=code;for(dist>>=7;code<D_CODES;code++)for(base_dist[code]=dist<<7,n=0;n<1<<extra_dbits[code]-7;n++)_dist_code[256+dist++]=code;for(bits=0;bits<=MAX_BITS;bits++)bl_count[bits]=0;for(n=0;n<=143;)static_ltree[2*n+1]=8,n++,bl_count[8]++;for(;n<=255;)static_ltree[2*n+1]=9,n++,bl_count[9]++;for(;n<=279;)static_ltree[2*n+1]=7,n++,bl_count[7]++;for(;n<=287;)static_ltree[2*n+1]=8,n++,bl_count[8]++;for(gen_codes(static_ltree,L_CODES+1,bl_count),n=0;n<D_CODES;n++)static_dtree[2*n+1]=5,static_dtree[2*n]=bi_reverse(n,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS+1,L_CODES,MAX_BITS),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES,MAX_BITS),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES,MAX_BL_BITS)}(),static_init_done=!0),s.l_desc=new TreeDesc(s.dyn_ltree,static_l_desc),s.d_desc=new TreeDesc(s.dyn_dtree,static_d_desc),s.bl_desc=new TreeDesc(s.bl_tree,static_bl_desc),s.bi_buf=0,s.bi_valid=0,init_block(s)}function _tr_stored_block(s,buf,stored_len,last){send_bits(s,(STORED_BLOCK<<1)+(last?1:0),3),function(s,buf,len,header){bi_windup(s),header&&(put_short(s,len),put_short(s,~len)),arraySet(s.pending_buf,s.window,buf,len,s.pending),s.pending+=len}(s,buf,stored_len,!0)}function _tr_align(s){send_bits(s,STATIC_TREES<<1,3),send_code(s,END_BLOCK,static_ltree),function(s){16===s.bi_valid?(put_short(s,s.bi_buf),s.bi_buf=0,s.bi_valid=0):8<=s.bi_valid&&(s.pending_buf[s.pending++]=255&s.bi_buf,s.bi_buf>>=8,s.bi_valid-=8)}(s)}function _tr_flush_block(s,buf,stored_len,last){var opt_lenb,static_lenb,max_blindex=0;0<s.level?(s.strm.data_type===Z_UNKNOWN&&(s.strm.data_type=function(s){var n,black_mask=4093624447;for(n=0;n<=31;n++,black_mask>>>=1)if(1&black_mask&&0!==s.dyn_ltree[2*n])return Z_BINARY;if(0!==s.dyn_ltree[18]||0!==s.dyn_ltree[20]||0!==s.dyn_ltree[26])return Z_TEXT;for(n=32;n<LITERALS;n++)if(0!==s.dyn_ltree[2*n])return Z_TEXT;return Z_BINARY}(s)),build_tree(s,s.l_desc),build_tree(s,s.d_desc),max_blindex=function(s){var max_blindex;for(scan_tree(s,s.dyn_ltree,s.l_desc.max_code),scan_tree(s,s.dyn_dtree,s.d_desc.max_code),build_tree(s,s.bl_desc),max_blindex=BL_CODES-1;3<=max_blindex&&0===s.bl_tree[2*bl_order[max_blindex]+1];max_blindex--);return s.opt_len+=3*(max_blindex+1)+5+5+4,max_blindex}(s),opt_lenb=s.opt_len+3+7>>>3,(static_lenb=s.static_len+3+7>>>3)<=opt_lenb&&(opt_lenb=static_lenb)):opt_lenb=static_lenb=stored_len+5,stored_len+4<=opt_lenb&&-1!==buf?_tr_stored_block(s,buf,stored_len,last):s.strategy===Z_FIXED||static_lenb===opt_lenb?(send_bits(s,(STATIC_TREES<<1)+(last?1:0),3),compress_block(s,static_ltree,static_dtree)):(send_bits(s,(DYN_TREES<<1)+(last?1:0),3),function(s,lcodes,dcodes,blcodes){var rank;for(send_bits(s,lcodes-257,5),send_bits(s,dcodes-1,5),send_bits(s,blcodes-4,4),rank=0;rank<blcodes;rank++)send_bits(s,s.bl_tree[2*bl_order[rank]+1],3);send_tree(s,s.dyn_ltree,lcodes-1),send_tree(s,s.dyn_dtree,dcodes-1)}(s,s.l_desc.max_code+1,s.d_desc.max_code+1,max_blindex+1),compress_block(s,s.dyn_ltree,s.dyn_dtree)),init_block(s),last&&bi_windup(s)}function _tr_tally(s,dist,lc){return s.pending_buf[s.d_buf+2*s.last_lit]=dist>>>8&255,s.pending_buf[s.d_buf+2*s.last_lit+1]=255&dist,s.pending_buf[s.l_buf+s.last_lit]=255&lc,s.last_lit++,0===dist?s.dyn_ltree[2*lc]++:(s.matches++,dist--,s.dyn_ltree[2*(_length_code[lc]+LITERALS+1)]++,s.dyn_dtree[2*d_code(dist)]++),s.last_lit===s.lit_bufsize-1}function adler32(adler,buf,len,pos){for(var s1=65535&adler|0,s2=adler>>>16&65535|0,n=0;0!==len;){for(len-=n=2e3<len?2e3:len;s2=s2+(s1=s1+buf[pos++]|0)|0,--n;);s1%=65521,s2%=65521}return s1|s2<<16|0}var crcTable=function(){for(var c,table=[],n=0;n<256;n++){c=n;for(var k=0;k<8;k++)c=1&c?3988292384^c>>>1:c>>>1;table[n]=c}return table}();function crc32(crc,buf,len,pos){var t=crcTable,end=pos+len;crc^=-1;for(var i=pos;i<end;i++)crc=crc>>>8^t[255&(crc^buf[i])];return-1^crc}var configuration_table,Z_NO_FLUSH=0,Z_PARTIAL_FLUSH=1,Z_FULL_FLUSH=3,Z_FINISH=4,Z_BLOCK=5,Z_OK=0,Z_STREAM_END=1,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_BUF_ERROR=-5,Z_DEFAULT_COMPRESSION=-1,Z_FILTERED=1,Z_HUFFMAN_ONLY=2,Z_RLE=3,Z_FIXED$1=4,Z_UNKNOWN$1=2,Z_DEFLATED=8,MAX_MEM_LEVEL=9,L_CODES$1=286,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,MIN_MATCH$1=3,MAX_MATCH$1=258,MIN_LOOKAHEAD=MAX_MATCH$1+MIN_MATCH$1+1,PRESET_DICT=32,INIT_STATE=42,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3;function err(strm,errorCode){return strm.msg=msg[errorCode],errorCode}function rank(f){return(f<<1)-(4<f?9:0)}function zero$1(buf){for(var len=buf.length;0<=--len;)buf[len]=0}function flush_pending(strm){var s=strm.state,len=s.pending;len>strm.avail_out&&(len=strm.avail_out),0!==len&&(arraySet(strm.output,s.pending_buf,s.pending_out,len,strm.next_out),strm.next_out+=len,s.pending_out+=len,strm.total_out+=len,strm.avail_out-=len,s.pending-=len,0===s.pending&&(s.pending_out=0))}function flush_block_only(s,last){_tr_flush_block(s,0<=s.block_start?s.block_start:-1,s.strstart-s.block_start,last),s.block_start=s.strstart,flush_pending(s.strm)}function put_byte(s,b){s.pending_buf[s.pending++]=b}function putShortMSB(s,b){s.pending_buf[s.pending++]=b>>>8&255,s.pending_buf[s.pending++]=255&b}function longest_match(s,cur_match){var match,len,chain_length=s.max_chain_length,scan=s.strstart,best_len=s.prev_length,nice_match=s.nice_match,limit=s.strstart>s.w_size-MIN_LOOKAHEAD?s.strstart-(s.w_size-MIN_LOOKAHEAD):0,_win=s.window,wmask=s.w_mask,prev=s.prev,strend=s.strstart+MAX_MATCH$1,scan_end1=_win[scan+best_len-1],scan_end=_win[scan+best_len];s.prev_length>=s.good_match&&(chain_length>>=2),nice_match>s.lookahead&&(nice_match=s.lookahead);do{if(_win[(match=cur_match)+best_len]===scan_end&&_win[match+best_len-1]===scan_end1&&_win[match]===_win[scan]&&_win[++match]===_win[scan+1]){scan+=2,match++;do{}while(_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&scan<strend);if(len=MAX_MATCH$1-(strend-scan),scan=strend-MAX_MATCH$1,best_len<len){if(s.match_start=cur_match,nice_match<=(best_len=len))break;scan_end1=_win[scan+best_len-1],scan_end=_win[scan+best_len]}}}while((cur_match=prev[cur_match&wmask])>limit&&0!=--chain_length);return best_len<=s.lookahead?best_len:s.lookahead}function fill_window(s){var p,n,m,more,str,strm,buf,start,size,len,_w_size=s.w_size;do{if(more=s.window_size-s.lookahead-s.strstart,s.strstart>=_w_size+(_w_size-MIN_LOOKAHEAD)){for(arraySet(s.window,s.window,_w_size,_w_size,0),s.match_start-=_w_size,s.strstart-=_w_size,s.block_start-=_w_size,p=n=s.hash_size;m=s.head[--p],s.head[p]=_w_size<=m?m-_w_size:0,--n;);for(p=n=_w_size;m=s.prev[--p],s.prev[p]=_w_size<=m?m-_w_size:0,--n;);more+=_w_size}if(0===s.strm.avail_in)break;if(strm=s.strm,buf=s.window,start=s.strstart+s.lookahead,size=more,len=void 0,len=strm.avail_in,size<len&&(len=size),n=0===len?0:(strm.avail_in-=len,arraySet(buf,strm.input,strm.next_in,len,start),1===strm.state.wrap?strm.adler=adler32(strm.adler,buf,len,start):2===strm.state.wrap&&(strm.adler=crc32(strm.adler,buf,len,start)),strm.next_in+=len,strm.total_in+=len,len),s.lookahead+=n,s.lookahead+s.insert>=MIN_MATCH$1)for(str=s.strstart-s.insert,s.ins_h=s.window[str],s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+1])&s.hash_mask;s.insert&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+MIN_MATCH$1-1])&s.hash_mask,s.prev[str&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=str,str++,s.insert--,!(s.lookahead+s.insert<MIN_MATCH$1)););}while(s.lookahead<MIN_LOOKAHEAD&&0!==s.strm.avail_in)}function deflate_fast(s,flush){for(var hash_head,bflush;;){if(s.lookahead<MIN_LOOKAHEAD){if(fill_window(s),s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH)return BS_NEED_MORE;if(0===s.lookahead)break}if(hash_head=0,s.lookahead>=MIN_MATCH$1&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH$1-1])&s.hash_mask,hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),0!==hash_head&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD&&(s.match_length=longest_match(s,hash_head)),s.match_length>=MIN_MATCH$1)if(bflush=_tr_tally(s,s.strstart-s.match_start,s.match_length-MIN_MATCH$1),s.lookahead-=s.match_length,s.match_length<=s.max_lazy_match&&s.lookahead>=MIN_MATCH$1){for(s.match_length--;s.strstart++,s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH$1-1])&s.hash_mask,hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart,0!=--s.match_length;);s.strstart++}else s.strstart+=s.match_length,s.match_length=0,s.ins_h=s.window[s.strstart],s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+1])&s.hash_mask;else bflush=_tr_tally(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++;if(bflush&&(flush_block_only(s,!1),0===s.strm.avail_out))return BS_NEED_MORE}return s.insert=s.strstart<MIN_MATCH$1-1?s.strstart:MIN_MATCH$1-1,flush===Z_FINISH?(flush_block_only(s,!0),0===s.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):s.last_lit&&(flush_block_only(s,!1),0===s.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_slow(s,flush){for(var hash_head,bflush,max_insert;;){if(s.lookahead<MIN_LOOKAHEAD){if(fill_window(s),s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH)return BS_NEED_MORE;if(0===s.lookahead)break}if(hash_head=0,s.lookahead>=MIN_MATCH$1&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH$1-1])&s.hash_mask,hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),s.prev_length=s.match_length,s.prev_match=s.match_start,s.match_length=MIN_MATCH$1-1,0!==hash_head&&s.prev_length<s.max_lazy_match&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD&&(s.match_length=longest_match(s,hash_head),s.match_length<=5&&(s.strategy===Z_FILTERED||s.match_length===MIN_MATCH$1&&4096<s.strstart-s.match_start)&&(s.match_length=MIN_MATCH$1-1)),s.prev_length>=MIN_MATCH$1&&s.match_length<=s.prev_length){for(max_insert=s.strstart+s.lookahead-MIN_MATCH$1,bflush=_tr_tally(s,s.strstart-1-s.prev_match,s.prev_length-MIN_MATCH$1),s.lookahead-=s.prev_length-1,s.prev_length-=2;++s.strstart<=max_insert&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH$1-1])&s.hash_mask,hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),0!=--s.prev_length;);if(s.match_available=0,s.match_length=MIN_MATCH$1-1,s.strstart++,bflush&&(flush_block_only(s,!1),0===s.strm.avail_out))return BS_NEED_MORE}else if(s.match_available){if((bflush=_tr_tally(s,0,s.window[s.strstart-1]))&&flush_block_only(s,!1),s.strstart++,s.lookahead--,0===s.strm.avail_out)return BS_NEED_MORE}else s.match_available=1,s.strstart++,s.lookahead--}return s.match_available&&(bflush=_tr_tally(s,0,s.window[s.strstart-1]),s.match_available=0),s.insert=s.strstart<MIN_MATCH$1-1?s.strstart:MIN_MATCH$1-1,flush===Z_FINISH?(flush_block_only(s,!0),0===s.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):s.last_lit&&(flush_block_only(s,!1),0===s.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function Config(good_length,max_lazy,nice_length,max_chain,func){this.good_length=good_length,this.max_lazy=max_lazy,this.nice_length=nice_length,this.max_chain=max_chain,this.func=func}function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Buf16(2*HEAP_SIZE$1),this.dyn_dtree=new Buf16(2*(2*D_CODES$1+1)),this.bl_tree=new Buf16(2*(2*BL_CODES$1+1)),zero$1(this.dyn_ltree),zero$1(this.dyn_dtree),zero$1(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Buf16(MAX_BITS$1+1),this.heap=new Buf16(2*L_CODES$1+1),zero$1(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Buf16(2*L_CODES$1+1),zero$1(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function deflateReset(strm){var s,ret=function(strm){var s;return strm&&strm.state?(strm.total_in=strm.total_out=0,strm.data_type=Z_UNKNOWN$1,(s=strm.state).pending=0,s.pending_out=0,s.wrap<0&&(s.wrap=-s.wrap),s.status=s.wrap?INIT_STATE:BUSY_STATE,strm.adler=2===s.wrap?0:1,s.last_flush=Z_NO_FLUSH,_tr_init(s),Z_OK):err(strm,Z_STREAM_ERROR)}(strm);return ret===Z_OK&&((s=strm.state).window_size=2*s.w_size,zero$1(s.head),s.max_lazy_match=configuration_table[s.level].max_lazy,s.good_match=configuration_table[s.level].good_length,s.nice_match=configuration_table[s.level].nice_length,s.max_chain_length=configuration_table[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=MIN_MATCH$1-1,s.match_available=0,s.ins_h=0),ret}function deflate(strm,flush){var old_flush,s,beg,val;if(!strm||!strm.state||Z_BLOCK<flush||flush<0)return strm?err(strm,Z_STREAM_ERROR):Z_STREAM_ERROR;if(s=strm.state,!strm.output||!strm.input&&0!==strm.avail_in||s.status===FINISH_STATE&&flush!==Z_FINISH)return err(strm,0===strm.avail_out?Z_BUF_ERROR:Z_STREAM_ERROR);if(s.strm=strm,old_flush=s.last_flush,s.last_flush=flush,s.status===INIT_STATE)if(2===s.wrap)strm.adler=0,put_byte(s,31),put_byte(s,139),put_byte(s,8),s.gzhead?(put_byte(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),put_byte(s,255&s.gzhead.time),put_byte(s,s.gzhead.time>>8&255),put_byte(s,s.gzhead.time>>16&255),put_byte(s,s.gzhead.time>>24&255),put_byte(s,9===s.level?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0),put_byte(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(put_byte(s,255&s.gzhead.extra.length),put_byte(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(strm.adler=crc32(strm.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=EXTRA_STATE):(put_byte(s,0),put_byte(s,0),put_byte(s,0),put_byte(s,0),put_byte(s,0),put_byte(s,9===s.level?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0),put_byte(s,OS_CODE),s.status=BUSY_STATE);else{var header=Z_DEFLATED+(s.w_bits-8<<4)<<8;header|=(s.strategy>=Z_HUFFMAN_ONLY||s.level<2?0:s.level<6?1:6===s.level?2:3)<<6,0!==s.strstart&&(header|=PRESET_DICT),header+=31-header%31,s.status=BUSY_STATE,putShortMSB(s,header),0!==s.strstart&&(putShortMSB(s,strm.adler>>>16),putShortMSB(s,65535&strm.adler)),strm.adler=1}if(s.status===EXTRA_STATE)if(s.gzhead.extra){for(beg=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)),flush_pending(strm),beg=s.pending,s.pending!==s.pending_buf_size));)put_byte(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=NAME_STATE)}else s.status=NAME_STATE;if(s.status===NAME_STATE)if(s.gzhead.name){beg=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)),flush_pending(strm),beg=s.pending,s.pending===s.pending_buf_size)){val=1;break}val=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,put_byte(s,val)}while(0!==val);s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)),0===val&&(s.gzindex=0,s.status=COMMENT_STATE)}else s.status=COMMENT_STATE;if(s.status===COMMENT_STATE)if(s.gzhead.comment){beg=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)),flush_pending(strm),beg=s.pending,s.pending===s.pending_buf_size)){val=1;break}val=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,put_byte(s,val)}while(0!==val);s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)),0===val&&(s.status=HCRC_STATE)}else s.status=HCRC_STATE;if(s.status===HCRC_STATE&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&flush_pending(strm),s.pending+2<=s.pending_buf_size&&(put_byte(s,255&strm.adler),put_byte(s,strm.adler>>8&255),strm.adler=0,s.status=BUSY_STATE)):s.status=BUSY_STATE),0!==s.pending){if(flush_pending(strm),0===strm.avail_out)return s.last_flush=-1,Z_OK}else if(0===strm.avail_in&&rank(flush)<=rank(old_flush)&&flush!==Z_FINISH)return err(strm,Z_BUF_ERROR);if(s.status===FINISH_STATE&&0!==strm.avail_in)return err(strm,Z_BUF_ERROR);if(0!==strm.avail_in||0!==s.lookahead||flush!==Z_NO_FLUSH&&s.status!==FINISH_STATE){var bstate=s.strategy===Z_HUFFMAN_ONLY?function(s,flush){for(var bflush;;){if(0===s.lookahead&&(fill_window(s),0===s.lookahead)){if(flush===Z_NO_FLUSH)return BS_NEED_MORE;break}if(s.match_length=0,bflush=_tr_tally(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,bflush&&(flush_block_only(s,!1),0===s.strm.avail_out))return BS_NEED_MORE}return s.insert=0,flush===Z_FINISH?(flush_block_only(s,!0),0===s.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):s.last_lit&&(flush_block_only(s,!1),0===s.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}(s,flush):s.strategy===Z_RLE?function(s,flush){for(var bflush,prev,scan,strend,_win=s.window;;){if(s.lookahead<=MAX_MATCH$1){if(fill_window(s),s.lookahead<=MAX_MATCH$1&&flush===Z_NO_FLUSH)return BS_NEED_MORE;if(0===s.lookahead)break}if(s.match_length=0,s.lookahead>=MIN_MATCH$1&&0<s.strstart&&(prev=_win[scan=s.strstart-1])===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]){strend=s.strstart+MAX_MATCH$1;do{}while(prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&scan<strend);s.match_length=MAX_MATCH$1-(strend-scan),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=MIN_MATCH$1?(bflush=_tr_tally(s,1,s.match_length-MIN_MATCH$1),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(bflush=_tr_tally(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),bflush&&(flush_block_only(s,!1),0===s.strm.avail_out))return BS_NEED_MORE}return s.insert=0,flush===Z_FINISH?(flush_block_only(s,!0),0===s.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):s.last_lit&&(flush_block_only(s,!1),0===s.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}(s,flush):configuration_table[s.level].func(s,flush);if(bstate!==BS_FINISH_STARTED&&bstate!==BS_FINISH_DONE||(s.status=FINISH_STATE),bstate===BS_NEED_MORE||bstate===BS_FINISH_STARTED)return 0===strm.avail_out&&(s.last_flush=-1),Z_OK;if(bstate===BS_BLOCK_DONE&&(flush===Z_PARTIAL_FLUSH?_tr_align(s):flush!==Z_BLOCK&&(_tr_stored_block(s,0,0,!1),flush===Z_FULL_FLUSH&&(zero$1(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),flush_pending(strm),0===strm.avail_out))return s.last_flush=-1,Z_OK}return flush!==Z_FINISH?Z_OK:s.wrap<=0?Z_STREAM_END:(2===s.wrap?(put_byte(s,255&strm.adler),put_byte(s,strm.adler>>8&255),put_byte(s,strm.adler>>16&255),put_byte(s,strm.adler>>24&255),put_byte(s,255&strm.total_in),put_byte(s,strm.total_in>>8&255),put_byte(s,strm.total_in>>16&255),put_byte(s,strm.total_in>>24&255)):(putShortMSB(s,strm.adler>>>16),putShortMSB(s,65535&strm.adler)),flush_pending(strm),0<s.wrap&&(s.wrap=-s.wrap),0!==s.pending?Z_OK:Z_STREAM_END)}configuration_table=[new Config(0,0,0,0,function(s,flush){var max_block_size=65535;for(max_block_size>s.pending_buf_size-5&&(max_block_size=s.pending_buf_size-5);;){if(s.lookahead<=1){if(fill_window(s),0===s.lookahead&&flush===Z_NO_FLUSH)return BS_NEED_MORE;if(0===s.lookahead)break}s.strstart+=s.lookahead,s.lookahead=0;var max_start=s.block_start+max_block_size;if((0===s.strstart||s.strstart>=max_start)&&(s.lookahead=s.strstart-max_start,s.strstart=max_start,flush_block_only(s,!1),0===s.strm.avail_out))return BS_NEED_MORE;if(s.strstart-s.block_start>=s.w_size-MIN_LOOKAHEAD&&(flush_block_only(s,!1),0===s.strm.avail_out))return BS_NEED_MORE}return s.insert=0,flush===Z_FINISH?(flush_block_only(s,!0),0===s.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):(s.strstart>s.block_start&&(flush_block_only(s,!1),s.strm.avail_out),BS_NEED_MORE)}),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)];var BAD=30,TYPE=12;function inflate_fast(strm,start){var state,_in,last,_out,beg,end,dmax,wsize,whave,wnext,s_window,hold,bits,lcode,dcode,lmask,dmask,here,op,len,dist,from,from_source,input,output;state=strm.state,_in=strm.next_in,input=strm.input,last=_in+(strm.avail_in-5),_out=strm.next_out,output=strm.output,beg=_out-(start-strm.avail_out),end=_out+(strm.avail_out-257),dmax=state.dmax,wsize=state.wsize,whave=state.whave,wnext=state.wnext,s_window=state.window,hold=state.hold,bits=state.bits,lcode=state.lencode,dcode=state.distcode,lmask=(1<<state.lenbits)-1,dmask=(1<<state.distbits)-1;top:do{bits<15&&(hold+=input[_in++]<<bits,bits+=8,hold+=input[_in++]<<bits,bits+=8),here=lcode[hold&lmask];dolen:for(;;){if(hold>>>=op=here>>>24,bits-=op,0===(op=here>>>16&255))output[_out++]=65535&here;else{if(!(16&op)){if(0==(64&op)){here=lcode[(65535&here)+(hold&(1<<op)-1)];continue dolen}if(32&op){state.mode=TYPE;break top}strm.msg="invalid literal/length code",state.mode=BAD;break top}len=65535&here,(op&=15)&&(bits<op&&(hold+=input[_in++]<<bits,bits+=8),len+=hold&(1<<op)-1,hold>>>=op,bits-=op),bits<15&&(hold+=input[_in++]<<bits,bits+=8,hold+=input[_in++]<<bits,bits+=8),here=dcode[hold&dmask];dodist:for(;;){if(hold>>>=op=here>>>24,bits-=op,!(16&(op=here>>>16&255))){if(0==(64&op)){here=dcode[(65535&here)+(hold&(1<<op)-1)];continue dodist}strm.msg="invalid distance code",state.mode=BAD;break top}if(dist=65535&here,bits<(op&=15)&&(hold+=input[_in++]<<bits,(bits+=8)<op&&(hold+=input[_in++]<<bits,bits+=8)),dmax<(dist+=hold&(1<<op)-1)){strm.msg="invalid distance too far back",state.mode=BAD;break top}if(hold>>>=op,bits-=op,(op=_out-beg)<dist){if(whave<(op=dist-op)&&state.sane){strm.msg="invalid distance too far back",state.mode=BAD;break top}if(from_source=s_window,(from=0)===wnext){if(from+=wsize-op,op<len){for(len-=op;output[_out++]=s_window[from++],--op;);from=_out-dist,from_source=output}}else if(wnext<op){if(from+=wsize+wnext-op,(op-=wnext)<len){for(len-=op;output[_out++]=s_window[from++],--op;);if(from=0,wnext<len){for(len-=op=wnext;output[_out++]=s_window[from++],--op;);from=_out-dist,from_source=output}}}else if(from+=wnext-op,op<len){for(len-=op;output[_out++]=s_window[from++],--op;);from=_out-dist,from_source=output}for(;2<len;)output[_out++]=from_source[from++],output[_out++]=from_source[from++],output[_out++]=from_source[from++],len-=3;len&&(output[_out++]=from_source[from++],1<len&&(output[_out++]=from_source[from++]))}else{for(from=_out-dist;output[_out++]=output[from++],output[_out++]=output[from++],output[_out++]=output[from++],2<(len-=3););len&&(output[_out++]=output[from++],1<len&&(output[_out++]=output[from++]))}break}}break}}while(_in<last&&_out<end);_in-=len=bits>>3,hold&=(1<<(bits-=len<<3))-1,strm.next_in=_in,strm.next_out=_out,strm.avail_in=_in<last?last-_in+5:5-(_in-last),strm.avail_out=_out<end?end-_out+257:257-(_out-end),state.hold=hold,state.bits=bits}var MAXBITS=15,ENOUGH_LENS=852,ENOUGH_DISTS=592,CODES=0,LENS=1,DISTS=2,lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function inflate_table(type,lens,lens_index,codes,table,table_index,work,opts){var incr,fill,low,mask,next,end,here_bits,here_op,here_val,bits=opts.bits,len=0,sym=0,min=0,max=0,root=0,curr=0,drop=0,left=0,used=0,huff=0,base=null,base_index=0,count=new Buf16(MAXBITS+1),offs=new Buf16(MAXBITS+1),extra=null,extra_index=0;for(len=0;len<=MAXBITS;len++)count[len]=0;for(sym=0;sym<codes;sym++)count[lens[lens_index+sym]]++;for(root=bits,max=MAXBITS;1<=max&&0===count[max];max--);if(max<root&&(root=max),0===max)return table[table_index++]=20971520,table[table_index++]=20971520,opts.bits=1,0;for(min=1;min<max&&0===count[min];min++);for(root<min&&(root=min),len=left=1;len<=MAXBITS;len++)if(left<<=1,(left-=count[len])<0)return-1;if(0<left&&(type===CODES||1!==max))return-1;for(offs[1]=0,len=1;len<MAXBITS;len++)offs[len+1]=offs[len]+count[len];for(sym=0;sym<codes;sym++)0!==lens[lens_index+sym]&&(work[offs[lens[lens_index+sym]]++]=sym);if(type===CODES?(base=extra=work,end=19):type===LENS?(base=lbase,base_index-=257,extra=lext,extra_index-=257,end=256):(base=dbase,extra=dext,end=-1),len=min,next=table_index,drop=sym=huff=0,low=-1,mask=(used=1<<(curr=root))-1,type===LENS&&ENOUGH_LENS<used||type===DISTS&&ENOUGH_DISTS<used)return 1;for(;;){for(here_bits=len-drop,work[sym]<end?(here_op=0,here_val=work[sym]):work[sym]>end?(here_op=extra[extra_index+work[sym]],here_val=base[base_index+work[sym]]):(here_op=96,here_val=0),incr=1<<len-drop,min=fill=1<<curr;table[next+(huff>>drop)+(fill-=incr)]=here_bits<<24|here_op<<16|here_val|0,0!==fill;);for(incr=1<<len-1;huff&incr;)incr>>=1;if(0!==incr?(huff&=incr-1,huff+=incr):huff=0,sym++,0==--count[len]){if(len===max)break;len=lens[lens_index+work[sym]]}if(root<len&&(huff&mask)!==low){for(0===drop&&(drop=root),next+=min,left=1<<(curr=len-drop);curr+drop<max&&!((left-=count[curr+drop])<=0);)curr++,left<<=1;if(used+=1<<curr,type===LENS&&ENOUGH_LENS<used||type===DISTS&&ENOUGH_DISTS<used)return 1;table[low=huff&mask]=root<<24|curr<<16|next-table_index|0}}return 0!==huff&&(table[next+huff]=len-drop<<24|64<<16|0),opts.bits=root,0}var CODES$1=0,LENS$1=1,DISTS$1=2,Z_FINISH$1=4,Z_BLOCK$1=5,Z_TREES=6,Z_OK$1=0,Z_STREAM_END$1=1,Z_NEED_DICT=2,Z_STREAM_ERROR$1=-2,Z_DATA_ERROR$1=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR$1=-5,Z_DEFLATED$1=8,HEAD=1,FLAGS=2,TIME=3,OS=4,EXLEN=5,EXTRA=6,NAME=7,COMMENT=8,HCRC=9,DICTID=10,DICT=11,TYPE$1=12,TYPEDO=13,STORED=14,COPY_=15,COPY=16,TABLE=17,LENLENS=18,CODELENS=19,LEN_=20,LEN=21,LENEXT=22,DIST=23,DISTEXT=24,MATCH=25,LIT=26,CHECK=27,LENGTH=28,DONE=29,BAD$1=30,MEM=31,SYNC=32,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592;function zswap32(q){return(q>>>24&255)+(q>>>8&65280)+((65280&q)<<8)+((255&q)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Buf16(320),this.work=new Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateReset(strm){var state;return strm&&strm.state?((state=strm.state).wsize=0,state.whave=0,state.wnext=0,function(strm){var state;return strm&&strm.state?(state=strm.state,strm.total_in=strm.total_out=state.total=0,strm.msg="",state.wrap&&(strm.adler=1&state.wrap),state.mode=HEAD,state.last=0,state.havedict=0,state.dmax=32768,state.head=null,state.hold=0,state.bits=0,state.lencode=state.lendyn=new Buf32(ENOUGH_LENS$1),state.distcode=state.distdyn=new Buf32(ENOUGH_DISTS$1),state.sane=1,state.back=-1,Z_OK$1):Z_STREAM_ERROR$1}(strm)):Z_STREAM_ERROR$1}function inflateInit2(strm,windowBits){var ret,state;return strm?(state=new InflateState,(strm.state=state).window=null,(ret=function(strm,windowBits){var wrap,state;return strm&&strm.state?(state=strm.state,windowBits<0?(wrap=0,windowBits=-windowBits):(wrap=1+(windowBits>>4),windowBits<48&&(windowBits&=15)),windowBits&&(windowBits<8||15<windowBits)?Z_STREAM_ERROR$1:(null!==state.window&&state.wbits!==windowBits&&(state.window=null),state.wrap=wrap,state.wbits=windowBits,inflateReset(strm))):Z_STREAM_ERROR$1}(strm,windowBits))!==Z_OK$1&&(strm.state=null),ret):Z_STREAM_ERROR$1}var lenfix,distfix,virgin=!0;function fixedtables(state){if(virgin){var sym;for(lenfix=new Buf32(512),distfix=new Buf32(32),sym=0;sym<144;)state.lens[sym++]=8;for(;sym<256;)state.lens[sym++]=9;for(;sym<280;)state.lens[sym++]=7;for(;sym<288;)state.lens[sym++]=8;for(inflate_table(LENS$1,state.lens,0,288,lenfix,0,state.work,{bits:9}),sym=0;sym<32;)state.lens[sym++]=5;inflate_table(DISTS$1,state.lens,0,32,distfix,0,state.work,{bits:5}),virgin=!1}state.lencode=lenfix,state.lenbits=9,state.distcode=distfix,state.distbits=5}function inflate(strm,flush){var state,input,output,next,put,have,left,hold,bits,_in,_out,copy,from,from_source,here_bits,here_op,here_val,last_bits,last_op,last_val,len,ret,opts,n,here=0,hbuf=new Buf8(4),order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!strm||!strm.state||!strm.output||!strm.input&&0!==strm.avail_in)return Z_STREAM_ERROR$1;(state=strm.state).mode===TYPE$1&&(state.mode=TYPEDO),put=strm.next_out,output=strm.output,left=strm.avail_out,next=strm.next_in,input=strm.input,have=strm.avail_in,hold=state.hold,bits=state.bits,_in=have,_out=left,ret=Z_OK$1;inf_leave:for(;;)switch(state.mode){case HEAD:if(0===state.wrap){state.mode=TYPEDO;break}for(;bits<16;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(2&state.wrap&&35615===hold){hbuf[state.check=0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0),bits=hold=0,state.mode=FLAGS;break}if(state.flags=0,state.head&&(state.head.done=!1),!(1&state.wrap)||(((255&hold)<<8)+(hold>>8))%31){strm.msg="incorrect header check",state.mode=BAD$1;break}if((15&hold)!==Z_DEFLATED$1){strm.msg="unknown compression method",state.mode=BAD$1;break}if(bits-=4,len=8+(15&(hold>>>=4)),0===state.wbits)state.wbits=len;else if(len>state.wbits){strm.msg="invalid window size",state.mode=BAD$1;break}state.dmax=1<<len,strm.adler=state.check=1,state.mode=512&hold?DICTID:TYPE$1,bits=hold=0;break;case FLAGS:for(;bits<16;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(state.flags=hold,(255&state.flags)!==Z_DEFLATED$1){strm.msg="unknown compression method",state.mode=BAD$1;break}if(57344&state.flags){strm.msg="unknown header flags set",state.mode=BAD$1;break}state.head&&(state.head.text=hold>>8&1),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0)),bits=hold=0,state.mode=TIME;case TIME:for(;bits<32;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.head&&(state.head.time=hold),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,hbuf[2]=hold>>>16&255,hbuf[3]=hold>>>24&255,state.check=crc32(state.check,hbuf,4,0)),bits=hold=0,state.mode=OS;case OS:for(;bits<16;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.head&&(state.head.xflags=255&hold,state.head.os=hold>>8),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0)),bits=hold=0,state.mode=EXLEN;case EXLEN:if(1024&state.flags){for(;bits<16;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.length=hold,state.head&&(state.head.extra_len=hold),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0)),bits=hold=0}else state.head&&(state.head.extra=null);state.mode=EXTRA;case EXTRA:if(1024&state.flags&&(have<(copy=state.length)&&(copy=have),copy&&(state.head&&(len=state.head.extra_len-state.length,state.head.extra||(state.head.extra=new Array(state.head.extra_len)),arraySet(state.head.extra,input,next,copy,len)),512&state.flags&&(state.check=crc32(state.check,input,copy,next)),have-=copy,next+=copy,state.length-=copy),state.length))break inf_leave;state.length=0,state.mode=NAME;case NAME:if(2048&state.flags){if(0===have)break inf_leave;for(copy=0;len=input[next+copy++],state.head&&len&&state.length<65536&&(state.head.name+=String.fromCharCode(len)),len&&copy<have;);if(512&state.flags&&(state.check=crc32(state.check,input,copy,next)),have-=copy,next+=copy,len)break inf_leave}else state.head&&(state.head.name=null);state.length=0,state.mode=COMMENT;case COMMENT:if(4096&state.flags){if(0===have)break inf_leave;for(copy=0;len=input[next+copy++],state.head&&len&&state.length<65536&&(state.head.comment+=String.fromCharCode(len)),len&&copy<have;);if(512&state.flags&&(state.check=crc32(state.check,input,copy,next)),have-=copy,next+=copy,len)break inf_leave}else state.head&&(state.head.comment=null);state.mode=HCRC;case HCRC:if(512&state.flags){for(;bits<16;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(hold!==(65535&state.check)){strm.msg="header crc mismatch",state.mode=BAD$1;break}bits=hold=0}state.head&&(state.head.hcrc=state.flags>>9&1,state.head.done=!0),strm.adler=state.check=0,state.mode=TYPE$1;break;case DICTID:for(;bits<32;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}strm.adler=state.check=zswap32(hold),bits=hold=0,state.mode=DICT;case DICT:if(0===state.havedict)return strm.next_out=put,strm.avail_out=left,strm.next_in=next,strm.avail_in=have,state.hold=hold,state.bits=bits,Z_NEED_DICT;strm.adler=state.check=1,state.mode=TYPE$1;case TYPE$1:if(flush===Z_BLOCK$1||flush===Z_TREES)break inf_leave;case TYPEDO:if(state.last){hold>>>=7&bits,bits-=7&bits,state.mode=CHECK;break}for(;bits<3;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}switch(state.last=1&hold,bits-=1,3&(hold>>>=1)){case 0:state.mode=STORED;break;case 1:if(fixedtables(state),state.mode=LEN_,flush===Z_TREES){hold>>>=2,bits-=2;break inf_leave}break;case 2:state.mode=TABLE;break;case 3:strm.msg="invalid block type",state.mode=BAD$1}hold>>>=2,bits-=2;break;case STORED:for(hold>>>=7&bits,bits-=7&bits;bits<32;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if((65535&hold)!=(hold>>>16^65535)){strm.msg="invalid stored block lengths",state.mode=BAD$1;break}if(state.length=65535&hold,bits=hold=0,state.mode=COPY_,flush===Z_TREES)break inf_leave;case COPY_:state.mode=COPY;case COPY:if(copy=state.length){if(have<copy&&(copy=have),left<copy&&(copy=left),0===copy)break inf_leave;arraySet(output,input,next,copy,put),have-=copy,next+=copy,left-=copy,put+=copy,state.length-=copy;break}state.mode=TYPE$1;break;case TABLE:for(;bits<14;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(state.nlen=257+(31&hold),hold>>>=5,bits-=5,state.ndist=1+(31&hold),hold>>>=5,bits-=5,state.ncode=4+(15&hold),hold>>>=4,bits-=4,286<state.nlen||30<state.ndist){strm.msg="too many length or distance symbols",state.mode=BAD$1;break}state.have=0,state.mode=LENLENS;case LENLENS:for(;state.have<state.ncode;){for(;bits<3;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.lens[order[state.have++]]=7&hold,hold>>>=3,bits-=3}for(;state.have<19;)state.lens[order[state.have++]]=0;if(state.lencode=state.lendyn,state.lenbits=7,opts={bits:state.lenbits},ret=inflate_table(CODES$1,state.lens,0,19,state.lencode,0,state.work,opts),state.lenbits=opts.bits,ret){strm.msg="invalid code lengths set",state.mode=BAD$1;break}state.have=0,state.mode=CODELENS;case CODELENS:for(;state.have<state.nlen+state.ndist;){for(;here_op=(here=state.lencode[hold&(1<<state.lenbits)-1])>>>16&255,here_val=65535&here,!((here_bits=here>>>24)<=bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(here_val<16)hold>>>=here_bits,bits-=here_bits,state.lens[state.have++]=here_val;else{if(16===here_val){for(n=here_bits+2;bits<n;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(hold>>>=here_bits,bits-=here_bits,0===state.have){strm.msg="invalid bit length repeat",state.mode=BAD$1;break}len=state.lens[state.have-1],copy=3+(3&hold),hold>>>=2,bits-=2}else if(17===here_val){for(n=here_bits+3;bits<n;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}bits-=here_bits,len=0,copy=3+(7&(hold>>>=here_bits)),hold>>>=3,bits-=3}else{for(n=here_bits+7;bits<n;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}bits-=here_bits,len=0,copy=11+(127&(hold>>>=here_bits)),hold>>>=7,bits-=7}if(state.have+copy>state.nlen+state.ndist){strm.msg="invalid bit length repeat",state.mode=BAD$1;break}for(;copy--;)state.lens[state.have++]=len}}if(state.mode===BAD$1)break;if(0===state.lens[256]){strm.msg="invalid code -- missing end-of-block",state.mode=BAD$1;break}if(state.lenbits=9,opts={bits:state.lenbits},ret=inflate_table(LENS$1,state.lens,0,state.nlen,state.lencode,0,state.work,opts),state.lenbits=opts.bits,ret){strm.msg="invalid literal/lengths set",state.mode=BAD$1;break}if(state.distbits=6,state.distcode=state.distdyn,opts={bits:state.distbits},ret=inflate_table(DISTS$1,state.lens,state.nlen,state.ndist,state.distcode,0,state.work,opts),state.distbits=opts.bits,ret){strm.msg="invalid distances set",state.mode=BAD$1;break}if(state.mode=LEN_,flush===Z_TREES)break inf_leave;case LEN_:state.mode=LEN;case LEN:if(6<=have&&258<=left){strm.next_out=put,strm.avail_out=left,strm.next_in=next,strm.avail_in=have,state.hold=hold,state.bits=bits,inflate_fast(strm,_out),put=strm.next_out,output=strm.output,left=strm.avail_out,next=strm.next_in,input=strm.input,have=strm.avail_in,hold=state.hold,bits=state.bits,state.mode===TYPE$1&&(state.back=-1);break}for(state.back=0;here_op=(here=state.lencode[hold&(1<<state.lenbits)-1])>>>16&255,here_val=65535&here,!((here_bits=here>>>24)<=bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(here_op&&0==(240&here_op)){for(last_bits=here_bits,last_op=here_op,last_val=here_val;here_op=(here=state.lencode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)])>>>16&255,here_val=65535&here,!(last_bits+(here_bits=here>>>24)<=bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}hold>>>=last_bits,bits-=last_bits,state.back+=last_bits}if(hold>>>=here_bits,bits-=here_bits,state.back+=here_bits,state.length=here_val,0===here_op){state.mode=LIT;break}if(32&here_op){state.back=-1,state.mode=TYPE$1;break}if(64&here_op){strm.msg="invalid literal/length code",state.mode=BAD$1;break}state.extra=15&here_op,state.mode=LENEXT;case LENEXT:if(state.extra){for(n=state.extra;bits<n;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.length+=hold&(1<<state.extra)-1,hold>>>=state.extra,bits-=state.extra,state.back+=state.extra}state.was=state.length,state.mode=DIST;case DIST:for(;here_op=(here=state.distcode[hold&(1<<state.distbits)-1])>>>16&255,here_val=65535&here,!((here_bits=here>>>24)<=bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(0==(240&here_op)){for(last_bits=here_bits,last_op=here_op,last_val=here_val;here_op=(here=state.distcode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)])>>>16&255,here_val=65535&here,!(last_bits+(here_bits=here>>>24)<=bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}hold>>>=last_bits,bits-=last_bits,state.back+=last_bits}if(hold>>>=here_bits,bits-=here_bits,state.back+=here_bits,64&here_op){strm.msg="invalid distance code",state.mode=BAD$1;break}state.offset=here_val,state.extra=15&here_op,state.mode=DISTEXT;case DISTEXT:if(state.extra){for(n=state.extra;bits<n;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.offset+=hold&(1<<state.extra)-1,hold>>>=state.extra,bits-=state.extra,state.back+=state.extra}if(state.offset>state.dmax){strm.msg="invalid distance too far back",state.mode=BAD$1;break}state.mode=MATCH;case MATCH:if(0===left)break inf_leave;if(copy=_out-left,state.offset>copy){if((copy=state.offset-copy)>state.whave&&state.sane){strm.msg="invalid distance too far back",state.mode=BAD$1;break}copy>state.wnext?(copy-=state.wnext,from=state.wsize-copy):from=state.wnext-copy,copy>state.length&&(copy=state.length),from_source=state.window}else from_source=output,from=put-state.offset,copy=state.length;for(left<copy&&(copy=left),left-=copy,state.length-=copy;output[put++]=from_source[from++],--copy;);0===state.length&&(state.mode=LEN);break;case LIT:if(0===left)break inf_leave;output[put++]=state.length,left--,state.mode=LEN;break;case CHECK:if(state.wrap){for(;bits<32;){if(0===have)break inf_leave;have--,hold|=input[next++]<<bits,bits+=8}if(_out-=left,strm.total_out+=_out,state.total+=_out,_out&&(strm.adler=state.check=state.flags?crc32(state.check,output,_out,put-_out):adler32(state.check,output,_out,put-_out)),_out=left,(state.flags?hold:zswap32(hold))!==state.check){strm.msg="incorrect data check",state.mode=BAD$1;break}bits=hold=0}state.mode=LENGTH;case LENGTH:if(state.wrap&&state.flags){for(;bits<32;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(hold!==(4294967295&state.total)){strm.msg="incorrect length check",state.mode=BAD$1;break}bits=hold=0}state.mode=DONE;case DONE:ret=Z_STREAM_END$1;break inf_leave;case BAD$1:ret=Z_DATA_ERROR$1;break inf_leave;case MEM:return Z_MEM_ERROR;case SYNC:default:return Z_STREAM_ERROR$1}return strm.next_out=put,strm.avail_out=left,strm.next_in=next,strm.avail_in=have,state.hold=hold,state.bits=bits,(state.wsize||_out!==strm.avail_out&&state.mode<BAD$1&&(state.mode<CHECK||flush!==Z_FINISH$1))&&function(strm,src,end,copy){var dist,state=strm.state;return null===state.window&&(state.wsize=1<<state.wbits,state.wnext=0,state.whave=0,state.window=new Buf8(state.wsize)),copy>=state.wsize?(arraySet(state.window,src,end-state.wsize,state.wsize,0),state.wnext=0,state.whave=state.wsize):(copy<(dist=state.wsize-state.wnext)&&(dist=copy),arraySet(state.window,src,end-copy,dist,state.wnext),(copy-=dist)?(arraySet(state.window,src,end-copy,copy,0),state.wnext=copy,state.whave=state.wsize):(state.wnext+=dist,state.wnext===state.wsize&&(state.wnext=0),state.whave<state.wsize&&(state.whave+=dist))),0}(strm,strm.output,strm.next_out,_out-strm.avail_out)?(state.mode=MEM,Z_MEM_ERROR):(_in-=strm.avail_in,_out-=strm.avail_out,strm.total_in+=_in,strm.total_out+=_out,state.total+=_out,state.wrap&&_out&&(strm.adler=state.check=state.flags?crc32(state.check,output,_out,strm.next_out-_out):adler32(state.check,output,_out,strm.next_out-_out)),strm.data_type=state.bits+(state.last?64:0)+(state.mode===TYPE$1?128:0)+(state.mode===LEN_||state.mode===COPY_?256:0),(0===_in&&0===_out||flush===Z_FINISH$1)&&ret===Z_OK$1&&(ret=Z_BUF_ERROR$1),ret)}var status,DEFLATE=1,UNZIP=7;function Zlib(mode){if(mode<DEFLATE||UNZIP<mode)throw new TypeError("Bad argument");this.mode=mode,this.init_done=!1,this.write_in_progress=!1,this.pending_close=!1,this.windowBits=0,this.level=0,this.memLevel=0,this.strategy=0,this.dictionary=null}function bufferSet(data,offset){for(var i=0;i<data.length;i++)this[offset+i]=data[i]}Zlib.prototype.init=function(windowBits,level,memLevel,strategy,dictionary){var status;switch(this.windowBits=windowBits,this.level=level,this.memLevel=memLevel,this.strategy=strategy,3!==this.mode&&4!==this.mode||(this.windowBits+=16),this.mode===UNZIP&&(this.windowBits+=32),5!==this.mode&&6!==this.mode||(this.windowBits=-this.windowBits),this.strm=new ZStream,this.mode){case DEFLATE:case 3:case 5:status=function(strm,level,method,windowBits,memLevel,strategy){if(!strm)return Z_STREAM_ERROR;var wrap=1;if(level===Z_DEFAULT_COMPRESSION&&(level=6),windowBits<0?(wrap=0,windowBits=-windowBits):15<windowBits&&(wrap=2,windowBits-=16),memLevel<1||MAX_MEM_LEVEL<memLevel||method!==Z_DEFLATED||windowBits<8||15<windowBits||level<0||9<level||strategy<0||Z_FIXED$1<strategy)return err(strm,Z_STREAM_ERROR);8===windowBits&&(windowBits=9);var s=new DeflateState;return(strm.state=s).strm=strm,s.wrap=wrap,s.gzhead=null,s.w_bits=windowBits,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=memLevel+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+MIN_MATCH$1-1)/MIN_MATCH$1),s.window=new Buf8(2*s.w_size),s.head=new Buf16(s.hash_size),s.prev=new Buf16(s.w_size),s.lit_bufsize=1<<memLevel+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=level,s.strategy=strategy,s.method=method,deflateReset(strm)}(this.strm,this.level,8,this.windowBits,this.memLevel,this.strategy);break;case 2:case 4:case 6:case UNZIP:status=inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}0===status?(this.write_in_progress=!1,this.init_done=!0):this._error(status)},Zlib.prototype.params=function(){throw new Error("deflateParams Not supported")},Zlib.prototype._writeCheck=function(){if(!this.init_done)throw new Error("write before init");if(0===this.mode)throw new Error("already finalized");if(this.write_in_progress)throw new Error("write already in progress");if(this.pending_close)throw new Error("close is pending")},Zlib.prototype.write=function(flush,input,in_off,in_len,out,out_off,out_len){this._writeCheck(),this.write_in_progress=!0;var self=this;return process.nextTick(function(){self.write_in_progress=!1;var res=self._write(flush,input,in_off,in_len,out,out_off,out_len);self.callback(res[0],res[1]),self.pending_close&&self.close()}),this},Zlib.prototype.writeSync=function(flush,input,in_off,in_len,out,out_off,out_len){return this._writeCheck(),this._write(flush,input,in_off,in_len,out,out_off,out_len)},Zlib.prototype._write=function(flush,input,in_off,in_len,out,out_off,out_len){if(this.write_in_progress=!0,0!==flush&&1!==flush&&2!==flush&&3!==flush&&4!==flush&&5!==flush)throw new Error("Invalid flush value");null==input&&(input=new Buffer(0),in_off=in_len=0),out._set?out.set=out._set:out.set=bufferSet;var status,strm=this.strm;switch(strm.avail_in=in_len,strm.input=input,strm.next_in=in_off,strm.avail_out=out_len,strm.output=out,strm.next_out=out_off,this.mode){case DEFLATE:case 3:case 5:status=deflate(strm,flush);break;case UNZIP:case 2:case 4:case 6:status=inflate(strm,flush);break;default:throw new Error("Unknown mode "+this.mode)}return 1!==status&&0!==status&&this._error(status),this.write_in_progress=!1,[strm.avail_in,strm.avail_out]},Zlib.prototype.close=function(){var strm,status;this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,this.mode===DEFLATE||3===this.mode||5===this.mode?(strm=this.strm)&&strm.state&&((status=strm.state.status)!==INIT_STATE&&status!==EXTRA_STATE&&status!==NAME_STATE&&status!==COMMENT_STATE&&status!==HCRC_STATE&&status!==BUSY_STATE&&status!==FINISH_STATE?err(strm,Z_STREAM_ERROR):(strm.state=null,status===BUSY_STATE&&err(strm,Z_DATA_ERROR))):function(strm){if(!strm||!strm.state)return;var state=strm.state;state.window&&(state.window=null),strm.state=null}(this.strm),this.mode=0)},Zlib.prototype.reset=function(){switch(this.mode){case DEFLATE:case 5:status=deflateReset(this.strm);break;case 2:case 6:status=inflateReset(this.strm)}0!==status&&this._error(status)},Zlib.prototype._error=function(status){this.onerror(msg[status]+": "+this.strm.msg,status),this.write_in_progress=!1,this.pending_close&&this.close()};var _binding=Object.freeze({NONE:0,DEFLATE:DEFLATE,INFLATE:2,GZIP:3,GUNZIP:4,DEFLATERAW:5,INFLATERAW:6,UNZIP:UNZIP,Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8,Zlib:Zlib});var binding$1={};Object.keys(_binding).forEach(function(key){binding$1[key]=_binding[key]}),binding$1.Z_MIN_WINDOWBITS=8,binding$1.Z_MAX_WINDOWBITS=15,binding$1.Z_DEFAULT_WINDOWBITS=15,binding$1.Z_MIN_CHUNK=64,binding$1.Z_MAX_CHUNK=1/0,binding$1.Z_DEFAULT_CHUNK=16384,binding$1.Z_MIN_MEMLEVEL=1,binding$1.Z_MAX_MEMLEVEL=9,binding$1.Z_DEFAULT_MEMLEVEL=8,binding$1.Z_MIN_LEVEL=-1,binding$1.Z_MAX_LEVEL=9,binding$1.Z_DEFAULT_LEVEL=binding$1.Z_DEFAULT_COMPRESSION;var codes={Z_OK:binding$1.Z_OK,Z_STREAM_END:binding$1.Z_STREAM_END,Z_NEED_DICT:binding$1.Z_NEED_DICT,Z_ERRNO:binding$1.Z_ERRNO,Z_STREAM_ERROR:binding$1.Z_STREAM_ERROR,Z_DATA_ERROR:binding$1.Z_DATA_ERROR,Z_MEM_ERROR:binding$1.Z_MEM_ERROR,Z_BUF_ERROR:binding$1.Z_BUF_ERROR,Z_VERSION_ERROR:binding$1.Z_VERSION_ERROR};function createDeflate(o){return new Deflate(o)}function createInflate(o){return new Inflate(o)}function createDeflateRaw(o){return new DeflateRaw(o)}function createInflateRaw(o){return new InflateRaw(o)}function createGzip(o){return new Gzip(o)}function createGunzip(o){return new Gunzip(o)}function createUnzip(o){return new Unzip(o)}function deflate$1(buffer,opts,callback){return"function"==typeof opts&&(callback=opts,opts={}),zlibBuffer(new Deflate(opts),buffer,callback)}function deflateSync(buffer,opts){return zlibBufferSync(new Deflate(opts),buffer)}function gzip(buffer,opts,callback){return"function"==typeof opts&&(callback=opts,opts={}),zlibBuffer(new Gzip(opts),buffer,callback)}function gzipSync(buffer,opts){return zlibBufferSync(new Gzip(opts),buffer)}function deflateRaw(buffer,opts,callback){return"function"==typeof opts&&(callback=opts,opts={}),zlibBuffer(new DeflateRaw(opts),buffer,callback)}function deflateRawSync(buffer,opts){return zlibBufferSync(new DeflateRaw(opts),buffer)}function unzip(buffer,opts,callback){return"function"==typeof opts&&(callback=opts,opts={}),zlibBuffer(new Unzip(opts),buffer,callback)}function unzipSync(buffer,opts){return zlibBufferSync(new Unzip(opts),buffer)}function inflate$1(buffer,opts,callback){return"function"==typeof opts&&(callback=opts,opts={}),zlibBuffer(new Inflate(opts),buffer,callback)}function inflateSync(buffer,opts){return zlibBufferSync(new Inflate(opts),buffer)}function gunzip(buffer,opts,callback){return"function"==typeof opts&&(callback=opts,opts={}),zlibBuffer(new Gunzip(opts),buffer,callback)}function gunzipSync(buffer,opts){return zlibBufferSync(new Gunzip(opts),buffer)}function inflateRaw(buffer,opts,callback){return"function"==typeof opts&&(callback=opts,opts={}),zlibBuffer(new InflateRaw(opts),buffer,callback)}function inflateRawSync(buffer,opts){return zlibBufferSync(new InflateRaw(opts),buffer)}function zlibBuffer(engine,buffer,callback){var buffers=[],nread=0;function flow(){for(var chunk;null!==(chunk=engine.read());)buffers.push(chunk),nread+=chunk.length;engine.once("readable",flow)}function onEnd(){var buf=Buffer.concat(buffers,nread);buffers=[],callback(null,buf),engine.close()}engine.on("error",function(err){engine.removeListener("end",onEnd),engine.removeListener("readable",flow),callback(err)}),engine.on("end",onEnd),engine.end(buffer),flow()}function zlibBufferSync(engine,buffer){if("string"==typeof buffer&&(buffer=new Buffer(buffer)),!Buffer.isBuffer(buffer))throw new TypeError("Not a string or buffer");var flushFlag=binding$1.Z_FINISH;return engine._processChunk(buffer,flushFlag)}function Deflate(opts){if(!(this instanceof Deflate))return new Deflate(opts);Zlib$1.call(this,opts,binding$1.DEFLATE)}function Inflate(opts){if(!(this instanceof Inflate))return new Inflate(opts);Zlib$1.call(this,opts,binding$1.INFLATE)}function Gzip(opts){if(!(this instanceof Gzip))return new Gzip(opts);Zlib$1.call(this,opts,binding$1.GZIP)}function Gunzip(opts){if(!(this instanceof Gunzip))return new Gunzip(opts);Zlib$1.call(this,opts,binding$1.GUNZIP)}function DeflateRaw(opts){if(!(this instanceof DeflateRaw))return new DeflateRaw(opts);Zlib$1.call(this,opts,binding$1.DEFLATERAW)}function InflateRaw(opts){if(!(this instanceof InflateRaw))return new InflateRaw(opts);Zlib$1.call(this,opts,binding$1.INFLATERAW)}function Unzip(opts){if(!(this instanceof Unzip))return new Unzip(opts);Zlib$1.call(this,opts,binding$1.UNZIP)}function Zlib$1(opts,mode){if(this._opts=opts=opts||{},this._chunkSize=opts.chunkSize||binding$1.Z_DEFAULT_CHUNK,Transform.call(this,opts),opts.flush&&opts.flush!==binding$1.Z_NO_FLUSH&&opts.flush!==binding$1.Z_PARTIAL_FLUSH&&opts.flush!==binding$1.Z_SYNC_FLUSH&&opts.flush!==binding$1.Z_FULL_FLUSH&&opts.flush!==binding$1.Z_FINISH&&opts.flush!==binding$1.Z_BLOCK)throw new Error("Invalid flush flag: "+opts.flush);if(this._flushFlag=opts.flush||binding$1.Z_NO_FLUSH,opts.chunkSize&&(opts.chunkSize<binding$1.Z_MIN_CHUNK||opts.chunkSize>binding$1.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+opts.chunkSize);if(opts.windowBits&&(opts.windowBits<binding$1.Z_MIN_WINDOWBITS||opts.windowBits>binding$1.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+opts.windowBits);if(opts.level&&(opts.level<binding$1.Z_MIN_LEVEL||opts.level>binding$1.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+opts.level);if(opts.memLevel&&(opts.memLevel<binding$1.Z_MIN_MEMLEVEL||opts.memLevel>binding$1.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+opts.memLevel);if(opts.strategy&&opts.strategy!=binding$1.Z_FILTERED&&opts.strategy!=binding$1.Z_HUFFMAN_ONLY&&opts.strategy!=binding$1.Z_RLE&&opts.strategy!=binding$1.Z_FIXED&&opts.strategy!=binding$1.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+opts.strategy);if(opts.dictionary&&!Buffer.isBuffer(opts.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._binding=new binding$1.Zlib(mode);var self=this;this._hadError=!1,this._binding.onerror=function(message,errno){self._binding=null,self._hadError=!0;var error=new Error(message);error.errno=errno,error.code=binding$1.codes[errno],self.emit("error",error)};var level=binding$1.Z_DEFAULT_COMPRESSION;"number"==typeof opts.level&&(level=opts.level);var strategy=binding$1.Z_DEFAULT_STRATEGY;"number"==typeof opts.strategy&&(strategy=opts.strategy),this._binding.init(opts.windowBits||binding$1.Z_DEFAULT_WINDOWBITS,level,opts.memLevel||binding$1.Z_DEFAULT_MEMLEVEL,strategy,opts.dictionary),this._buffer=new Buffer(this._chunkSize),this._offset=0,this._closed=!1,this._level=level,this._strategy=strategy,this.once("end",this.close)}Object.keys(codes).forEach(function(k){codes[codes[k]]=k}),inherits$1(Zlib$1,Transform),Zlib$1.prototype.params=function(level,strategy,callback){if(level<binding$1.Z_MIN_LEVEL||level>binding$1.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+level);if(strategy!=binding$1.Z_FILTERED&&strategy!=binding$1.Z_HUFFMAN_ONLY&&strategy!=binding$1.Z_RLE&&strategy!=binding$1.Z_FIXED&&strategy!=binding$1.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+strategy);if(this._level!==level||this._strategy!==strategy){var self=this;this.flush(binding$1.Z_SYNC_FLUSH,function(){self._binding.params(level,strategy),self._hadError||(self._level=level,self._strategy=strategy,callback&&callback())})}else process.nextTick(callback)},Zlib$1.prototype.reset=function(){return this._binding.reset()},Zlib$1.prototype._flush=function(callback){this._transform(new Buffer(0),"",callback)},Zlib$1.prototype.flush=function(kind,callback){var ws=this._writableState;if(("function"==typeof kind||void 0===kind&&!callback)&&(callback=kind,kind=binding$1.Z_FULL_FLUSH),ws.ended)callback&&process.nextTick(callback);else if(ws.ending)callback&&this.once("end",callback);else if(ws.needDrain){var self=this;this.once("drain",function(){self.flush(callback)})}else this._flushFlag=kind,this.write(new Buffer(0),"",callback)},Zlib$1.prototype.close=function(callback){if(callback&&process.nextTick(callback),!this._closed){this._closed=!0,this._binding.close();var self=this;process.nextTick(function(){self.emit("close")})}},Zlib$1.prototype._transform=function(chunk,encoding,cb){var flushFlag,ws=this._writableState,last=(ws.ending||ws.ended)&&(!chunk||ws.length===chunk.length);if(null===!chunk&&!Buffer.isBuffer(chunk))return cb(new Error("invalid input"));last?flushFlag=binding$1.Z_FINISH:(flushFlag=this._flushFlag,chunk.length>=ws.length&&(this._flushFlag=this._opts.flush||binding$1.Z_NO_FLUSH)),this._processChunk(chunk,flushFlag,cb)},Zlib$1.prototype._processChunk=function(chunk,flushFlag,cb){var availInBefore=chunk&&chunk.length,availOutBefore=this._chunkSize-this._offset,inOff=0,self=this,async="function"==typeof cb;if(!async){var error,buffers=[],nread=0;this.on("error",function(er){error=er});do{var res=this._binding.writeSync(flushFlag,chunk,inOff,availInBefore,this._buffer,this._offset,availOutBefore)}while(!this._hadError&&callback(res[0],res[1]));if(this._hadError)throw error;var buf=Buffer.concat(buffers,nread);return this.close(),buf}var req=this._binding.write(flushFlag,chunk,inOff,availInBefore,this._buffer,this._offset,availOutBefore);function callback(availInAfter,availOutAfter){if(!self._hadError){var have=availOutBefore-availOutAfter;if(function(a,msg){if(!a)throw new Error(msg)}(0<=have,"have should not go down"),0<have){var out=self._buffer.slice(self._offset,self._offset+have);self._offset+=have,async?self.push(out):(buffers.push(out),nread+=out.length)}if((0===availOutAfter||self._offset>=self._chunkSize)&&(availOutBefore=self._chunkSize,self._offset=0,self._buffer=new Buffer(self._chunkSize)),0===availOutAfter){if(inOff+=availInBefore-availInAfter,availInBefore=availInAfter,!async)return!0;var newReq=self._binding.write(flushFlag,chunk,inOff,availInBefore,self._buffer,self._offset,self._chunkSize);return newReq.callback=callback,void(newReq.buffer=chunk)}if(!async)return!1;cb()}}req.buffer=chunk,req.callback=callback},inherits$1(Deflate,Zlib$1),inherits$1(Inflate,Zlib$1),inherits$1(Gzip,Zlib$1),inherits$1(Gunzip,Zlib$1),inherits$1(DeflateRaw,Zlib$1),inherits$1(InflateRaw,Zlib$1),inherits$1(Unzip,Zlib$1);var zlib={codes:codes,createDeflate:createDeflate,createInflate:createInflate,createDeflateRaw:createDeflateRaw,createInflateRaw:createInflateRaw,createGzip:createGzip,createGunzip:createGunzip,createUnzip:createUnzip,deflate:deflate$1,deflateSync:deflateSync,gzip:gzip,gzipSync:gzipSync,deflateRaw:deflateRaw,deflateRawSync:deflateRawSync,unzip:unzip,unzipSync:unzipSync,inflate:inflate$1,inflateSync:inflateSync,gunzip:gunzip,gunzipSync:gunzipSync,inflateRaw:inflateRaw,inflateRawSync:inflateRawSync,Deflate:Deflate,Inflate:Inflate,Gzip:Gzip,Gunzip:Gunzip,DeflateRaw:DeflateRaw,InflateRaw:InflateRaw,Unzip:Unzip,Zlib:Zlib$1},zlib$1=Object.freeze({codes:codes,createDeflate:createDeflate,createInflate:createInflate,createDeflateRaw:createDeflateRaw,createInflateRaw:createInflateRaw,createGzip:createGzip,createGunzip:createGunzip,createUnzip:createUnzip,deflate:deflate$1,deflateSync:deflateSync,gzip:gzip,gzipSync:gzipSync,deflateRaw:deflateRaw,deflateRawSync:deflateRawSync,unzip:unzip,unzipSync:unzipSync,inflate:inflate$1,inflateSync:inflateSync,gunzip:gunzip,gunzipSync:gunzipSync,inflateRaw:inflateRaw,inflateRawSync:inflateRawSync,Deflate:Deflate,Inflate:Inflate,Gzip:Gzip,Gunzip:Gunzip,DeflateRaw:DeflateRaw,InflateRaw:InflateRaw,Unzip:Unzip,Zlib:Zlib$1,default:zlib});function normalizeArray(parts,allowAboveRoot){for(var up=0,i=parts.length-1;0<=i;i--){var last=parts[i];"."===last?parts.splice(i,1):".."===last?(parts.splice(i,1),up++):up&&(parts.splice(i,1),up--)}if(allowAboveRoot)for(;up--;up)parts.unshift("..");return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};function resolve(){for(var arguments$1=arguments,resolvedPath="",resolvedAbsolute=!1,i=arguments.length-1;-1<=i&&!resolvedAbsolute;i--){var path=0<=i?arguments$1[i]:"/";if("string"!=typeof path)throw new TypeError("Arguments to path.resolve must be strings");path&&(resolvedPath=path+"/"+resolvedPath,resolvedAbsolute="/"===path.charAt(0))}return(resolvedAbsolute?"/":"")+(resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/"))||"."}function normalize(path){var isPathAbsolute=isAbsolute(path),trailingSlash="/"===substr(path,-1);return(path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isPathAbsolute).join("/"))||isPathAbsolute||(path="."),path&&trailingSlash&&(path+="/"),(isPathAbsolute?"/":"")+path}function isAbsolute(path){return"/"===path.charAt(0)}function join(){return normalize(filter(Array.prototype.slice.call(arguments,0),function(p,index){if("string"!=typeof p)throw new TypeError("Arguments to path.join must be strings");return p}).join("/"))}function relative(from,to){function trim(arr){for(var start=0;start<arr.length&&""===arr[start];start++);for(var end=arr.length-1;0<=end&&""===arr[end];end--);return end<start?[]:arr.slice(start,end-start+1)}from=resolve(from).substr(1),to=resolve(to).substr(1);for(var fromParts=trim(from.split("/")),toParts=trim(to.split("/")),length=Math.min(fromParts.length,toParts.length),samePartsLength=length,i=0;i<length;i++)if(fromParts[i]!==toParts[i]){samePartsLength=i;break}var outputParts=[];for(i=samePartsLength;i<fromParts.length;i++)outputParts.push("..");return(outputParts=outputParts.concat(toParts.slice(samePartsLength))).join("/")}function dirname(path){var result=splitPath(path),root=result[0],dir=result[1];return root||dir?(dir&&(dir=dir.substr(0,dir.length-1)),root+dir):"."}function basename(path,ext){var f=splitPath(path)[2];return ext&&f.substr(-1*ext.length)===ext&&(f=f.substr(0,f.length-ext.length)),f}function extname(path){return splitPath(path)[3]}var path={extname:extname,basename:basename,dirname:dirname,sep:"/",delimiter:":",relative:relative,join:join,isAbsolute:isAbsolute,normalize:normalize,resolve:resolve};function filter(xs,f){if(xs.filter)return xs.filter(f);for(var res=[],i=0;i<xs.length;i++)f(xs[i],i,xs)&&res.push(xs[i]);return res}var zlibLimiter,substr="b"==="ab".substr(-1)?function(str,start,len){return str.substr(start,len)}:function(str,start,len){return start<0&&(start=str.length+start),str.substr(start,len)},path$1=Object.freeze({resolve:resolve,normalize:normalize,isAbsolute:isAbsolute,join:join,relative:relative,sep:"/",delimiter:":",dirname:dirname,basename:basename,extname:extname,default:path}),crypto=empty$1&&empty||empty$1,path$2=path$1&&path||path$1,bindings_1=createCommonjsModule(function(module,exports){var join=path$2.join,dirname=path$2.dirname,exists=crypto.accessSync&&function(path){try{crypto.accessSync(path)}catch(e){return!1}return!0}||crypto.existsSync||path$2.existsSync,defaults={arrow:process.env.NODE_BINDINGS_ARROW||" → ",compiled:process.env.NODE_BINDINGS_COMPILED_DIR||"compiled",platform:process.platform,arch:process.arch,version:process.versions.node,bindings:"bindings.node",try:[["module_root","build","bindings"],["module_root","build","Debug","bindings"],["module_root","build","Release","bindings"],["module_root","out","Debug","bindings"],["module_root","Debug","bindings"],["module_root","out","Release","bindings"],["module_root","Release","bindings"],["module_root","build","default","bindings"],["module_root","compiled","version","platform","arch","bindings"]]};module.exports=exports=function(opts){"string"==typeof opts?opts={bindings:opts}:opts||(opts={}),Object.keys(defaults).map(function(i){i in opts||(opts[i]=defaults[i])}),opts.module_root||(opts.module_root=exports.getRoot(exports.getFileName())),".node"!=path$2.extname(opts.bindings)&&(opts.bindings+=".node");for(var n,b,err,tries=[],i=0,l=opts.try.length;i<l;i++){n=join.apply(null,opts.try[i].map(function(p){return opts[p]||p})),tries.push(n);try{return b=opts.path?commonjsRequire.resolve(n):commonjsRequire(),opts.path||(b.path=n),b}catch(e){if(!/not find/i.test(e.message))throw e}}throw(err=new Error("Could not locate the bindings file. Tried:\n"+tries.map(function(a){return opts.arrow+a}).join("\n"))).tries=tries,err},exports.getFileName=function(calling_file){var fileName,origPST=Error.prepareStackTrace,origSTL=Error.stackTraceLimit;return Error.stackTraceLimit=10,Error.prepareStackTrace=function(e,st){for(var i=0,l=st.length;i<l;i++)if((fileName=st[i].getFileName())!==__filename){if(!calling_file)return;if(fileName!==calling_file)return}},Error.captureStackTrace({}),Error.prepareStackTrace=origPST,Error.stackTraceLimit=origSTL,fileName},exports.getRoot=function(file){for(var prev,dir=dirname(file);;){if("."===dir&&(dir=process.cwd()),exists(join(dir,"package.json"))||exists(join(dir,"node_modules")))return dir;if(prev===dir)throw new Error('Could not find module root given file: "'+file+'". Do you have a `package.json` file? ');dir=join(prev=dir,"..")}}}),fallback=(bindings_1.getFileName,bindings_1.getRoot,{mask:function(source,mask,output,offset,length){for(var i=0;i<length;i++)output[offset+i]=source[i]^mask[3&i]},unmask:function(buffer,mask){for(var length=buffer.length,i=0;i<length;i++)buffer[i]^=mask[3&i]}}),bufferutil=createCommonjsModule(function(module){try{module.exports=bindings_1("bufferutil")}catch(e){module.exports=fallback}}),BufferUtil=createCommonjsModule(function(module){var Buffer=safeBuffer.Buffer,concat=function(list,totalLength){for(var target=Buffer.allocUnsafe(totalLength),offset=0,i=0;i<list.length;i++){var buf=list[i];buf.copy(target,offset),offset+=buf.length}return target};try{var bufferUtil=bufferutil;module.exports=Object.assign({concat:concat},bufferUtil.BufferUtil||bufferUtil)}catch(e){var mask=function(source,mask,output,offset,length){for(var i=0;i<length;i++)output[offset+i]=source[i]^mask[3&i]},unmask=function(buffer,mask){for(var length=buffer.length,i=0;i<length;i++)buffer[i]^=mask[3&i]};module.exports={concat:concat,mask:mask,unmask:unmask}}}),zlib$2=(BufferUtil.concat,BufferUtil.mask,BufferUtil.unmask,zlib$1&&zlib||zlib$1),Buffer$2=safeBuffer.Buffer,TRAILER=Buffer$2.from([0,0,255,255]),EMPTY_BLOCK=Buffer$2.from([0]),kWriteInProgress=Symbol("write-in-progress"),kPendingClose=Symbol("pending-close"),kTotalLength=Symbol("total-length"),kCallback=Symbol("callback"),kBuffers=Symbol("buffers"),kError=Symbol("error"),kOwner=Symbol("owner"),PerMessageDeflate=function(options,isServer,maxPayload){if(this._maxPayload=0|maxPayload,this._options=options||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!isServer,this._deflate=null,this._inflate=null,this.params=null,!zlibLimiter){var concurrency=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;zlibLimiter=new asyncLimiter({concurrency:concurrency})}},staticAccessors={extensionName:{configurable:!0}};staticAccessors.extensionName.get=function(){return"permessage-deflate"},PerMessageDeflate.prototype.offer=function(){var params={};return this._options.serverNoContextTakeover&&(params.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(params.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(params.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?params.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(params.client_max_window_bits=!0),params},PerMessageDeflate.prototype.accept=function(paramsList){var params;return paramsList=this.normalizeParams(paramsList),params=this._isServer?this.acceptAsServer(paramsList):this.acceptAsClient(paramsList),this.params=params},PerMessageDeflate.prototype.cleanup=function(){this._inflate&&(this._inflate[kWriteInProgress]?this._inflate[kPendingClose]=!0:(this._inflate.close(),this._inflate=null)),this._deflate&&(this._deflate[kWriteInProgress]?this._deflate[kPendingClose]=!0:(this._deflate.close(),this._deflate=null))},PerMessageDeflate.prototype.acceptAsServer=function(paramsList){var this$1=this,accepted={};if(!paramsList.some(function(params){if(!(!1===this$1._options.serverNoContextTakeover&&params.server_no_context_takeover||!1===this$1._options.serverMaxWindowBits&&params.server_max_window_bits||"number"==typeof this$1._options.serverMaxWindowBits&&"number"==typeof params.server_max_window_bits&&this$1._options.serverMaxWindowBits>params.server_max_window_bits||"number"==typeof this$1._options.clientMaxWindowBits&&!params.client_max_window_bits))return(this$1._options.serverNoContextTakeover||params.server_no_context_takeover)&&(accepted.server_no_context_takeover=!0),(this$1._options.clientNoContextTakeover||!1!==this$1._options.clientNoContextTakeover&&params.client_no_context_takeover)&&(accepted.client_no_context_takeover=!0),"number"==typeof this$1._options.serverMaxWindowBits?accepted.server_max_window_bits=this$1._options.serverMaxWindowBits:"number"==typeof params.server_max_window_bits&&(accepted.server_max_window_bits=params.server_max_window_bits),"number"==typeof this$1._options.clientMaxWindowBits?accepted.client_max_window_bits=this$1._options.clientMaxWindowBits:!1!==this$1._options.clientMaxWindowBits&&"number"==typeof params.client_max_window_bits&&(accepted.client_max_window_bits=params.client_max_window_bits),!0}))throw new Error("Doesn't support the offered configuration");return accepted},PerMessageDeflate.prototype.acceptAsClient=function(paramsList){var params=paramsList[0];if(!1===this._options.clientNoContextTakeover&&params.client_no_context_takeover)throw new Error('Invalid value for "client_no_context_takeover"');if("number"==typeof this._options.clientMaxWindowBits&&(!params.client_max_window_bits||params.client_max_window_bits>this._options.clientMaxWindowBits)||!1===this._options.clientMaxWindowBits&&params.client_max_window_bits)throw new Error('Invalid value for "client_max_window_bits"');return params},PerMessageDeflate.prototype.normalizeParams=function(paramsList){var this$1=this;return paramsList.map(function(params){return Object.keys(params).forEach(function(key){var value=params[key];if(1<value.length)throw new Error("Multiple extension parameters for "+key);switch(value=value[0],key){case"server_no_context_takeover":case"client_no_context_takeover":if(!0!==value)throw new Error("invalid extension parameter value for "+key+" ("+value+")");params[key]=!0;break;case"server_max_window_bits":case"client_max_window_bits":if("string"==typeof value&&(value=parseInt(value,10),Number.isNaN(value)||value<zlib$2.Z_MIN_WINDOWBITS||value>zlib$2.Z_MAX_WINDOWBITS))throw new Error("invalid extension parameter value for "+key+" ("+value+")");if(!this$1._isServer&&!0===value)throw new Error("Missing extension parameter value for "+key);params[key]=value;break;default:throw new Error("Not defined extension parameter ("+key+")")}}),params})},PerMessageDeflate.prototype.decompress=function(data,fin,callback){var this$1=this;zlibLimiter.push(function(done){this$1._decompress(data,fin,function(err,result){done(),callback(err,result)})})},PerMessageDeflate.prototype.compress=function(data,fin,callback){var this$1=this;zlibLimiter.push(function(done){this$1._compress(data,fin,function(err,result){done(),callback(err,result)})})},PerMessageDeflate.prototype._decompress=function(data,fin,callback){var this$1=this,endpoint=this._isServer?"client":"server";if(!this._inflate){var key=endpoint+"_max_window_bits",windowBits="number"!=typeof this.params[key]?zlib$2.Z_DEFAULT_WINDOWBITS:this.params[key];this._inflate=zlib$2.createInflateRaw({windowBits:windowBits}),this._inflate[kTotalLength]=0,this._inflate[kBuffers]=[],(this._inflate[kOwner]=this)._inflate.on("error",inflateOnError),this._inflate.on("data",inflateOnData)}this._inflate[kCallback]=callback,this._inflate[kWriteInProgress]=!0,this._inflate.write(data),fin&&this._inflate.write(TRAILER),this._inflate.flush(function(){var err=this$1._inflate[kError];if(err)return this$1._inflate.close(),this$1._inflate=null,void callback(err);var data=BufferUtil.concat(this$1._inflate[kBuffers],this$1._inflate[kTotalLength]);fin&&this$1.params[endpoint+"_no_context_takeover"]||this$1._inflate[kPendingClose]?(this$1._inflate.close(),this$1._inflate=null):(this$1._inflate[kWriteInProgress]=!1,this$1._inflate[kTotalLength]=0,this$1._inflate[kBuffers]=[]),callback(null,data)})},PerMessageDeflate.prototype._compress=function(data,fin,callback){var this$1=this;if(data&&0!==data.length){var endpoint=this._isServer?"server":"client";if(!this._deflate){var key=endpoint+"_max_window_bits",windowBits="number"!=typeof this.params[key]?zlib$2.Z_DEFAULT_WINDOWBITS:this.params[key];this._deflate=zlib$2.createDeflateRaw({memLevel:this._options.memLevel,level:this._options.level,flush:zlib$2.Z_SYNC_FLUSH,windowBits:windowBits}),this._deflate[kTotalLength]=0,this._deflate[kBuffers]=[],this._deflate.on("data",deflateOnData)}this._deflate[kWriteInProgress]=!0,this._deflate.write(data),this._deflate.flush(zlib$2.Z_SYNC_FLUSH,function(){var data=BufferUtil.concat(this$1._deflate[kBuffers],this$1._deflate[kTotalLength]);fin&&(data=data.slice(0,data.length-4)),fin&&this$1.params[endpoint+"_no_context_takeover"]||this$1._deflate[kPendingClose]?(this$1._deflate.close(),this$1._deflate=null):(this$1._deflate[kWriteInProgress]=!1,this$1._deflate[kTotalLength]=0,this$1._deflate[kBuffers]=[]),callback(null,data)})}else process.nextTick(callback,null,EMPTY_BLOCK)},Object.defineProperties(PerMessageDeflate,staticAccessors);var PerMessageDeflate_1=PerMessageDeflate;function deflateOnData(chunk){this[kBuffers].push(chunk),this[kTotalLength]+=chunk.length}function inflateOnData(chunk){this[kTotalLength]+=chunk.length,this[kOwner]._maxPayload<1||this[kTotalLength]<=this[kOwner]._maxPayload?this[kBuffers].push(chunk):(this[kError]=new Error("max payload size exceeded"),this[kError].closeCode=1009,this.removeListener("data",inflateOnData),this.reset())}function inflateOnError(err){this[kOwner]._inflate=null,this[kCallback](err)}var Event=function(type,target){this.target=target,this.type=type},MessageEvent=function(Event){function MessageEvent(data,target){Event.call(this,"message",target),this.data=data}return Event&&(MessageEvent.__proto__=Event),(MessageEvent.prototype=Object.create(Event&&Event.prototype)).constructor=MessageEvent}(Event),CloseEvent=function(Event){function CloseEvent(code,reason,target){Event.call(this,"close",target),this.wasClean=target._closeFrameReceived&&target._closeFrameSent,this.reason=reason,this.code=code}return Event&&(CloseEvent.__proto__=Event),(CloseEvent.prototype=Object.create(Event&&Event.prototype)).constructor=CloseEvent}(Event),OpenEvent=function(Event){function OpenEvent(target){Event.call(this,"open",target)}return Event&&(OpenEvent.__proto__=Event),(OpenEvent.prototype=Object.create(Event&&Event.prototype)).constructor=OpenEvent}(Event),EventTarget_1={addEventListener:function(method,listener){function onMessage(data){listener.call(this,new MessageEvent(data,this))}function onClose(code,message){listener.call(this,new CloseEvent(code,message,this))}function onError(event){event.type="error",event.target=this,listener.call(this,event)}function onOpen(){listener.call(this,new OpenEvent(this))}"function"==typeof listener&&("message"===method?(onMessage._listener=listener,this.on(method,onMessage)):"close"===method?(onClose._listener=listener,this.on(method,onClose)):"error"===method?(onError._listener=listener,this.on(method,onError)):"open"===method?(onOpen._listener=listener,this.on(method,onOpen)):this.on(method,listener))},removeEventListener:function(method,listener){for(var listeners=this.listeners(method),i=0;i<listeners.length;i++)listeners[i]!==listener&&listeners[i]._listener!==listener||this.removeListener(method,listeners[i])}},tokenChars=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function push(dest,name,elem){Object.prototype.hasOwnProperty.call(dest,name)?dest[name].push(elem):dest[name]=[elem]}var Extensions={format:function(value){return Object.keys(value).map(function(token){var paramsList=value[token];return Array.isArray(paramsList)||(paramsList=[paramsList]),paramsList.map(function(params){return[token].concat(Object.keys(params).map(function(k){var p=params[k];return Array.isArray(p)||(p=[p]),p.map(function(v){return!0===v?k:k+"="+v}).join("; ")})).join("; ")}).join(", ")}).join(", ")},parse:function(header){var offers={};if(void 0===header||""===header)return offers;for(var extensionName,paramName,params={},mustUnescape=!1,isEscaping=!1,inQuotes=!1,start=-1,end=-1,i=0;i<header.length;i++){var code=header.charCodeAt(i);if(void 0===extensionName)if(-1===end&&1===tokenChars[code])-1===start&&(start=i);else if(32===code||9===code)-1===end&&-1!==start&&(end=i);else{if(59!==code&&44!==code)throw new Error("unexpected character at index "+i);if(-1===start)throw new Error("unexpected character at index "+i);-1===end&&(end=i);var name=header.slice(start,end);44===code?(push(offers,name,params),params={}):extensionName=name,start=end=-1}else if(void 0===paramName)if(-1===end&&1===tokenChars[code])-1===start&&(start=i);else if(32===code||9===code)-1===end&&-1!==start&&(end=i);else if(59===code||44===code){if(-1===start)throw new Error("unexpected character at index "+i);-1===end&&(end=i),push(params,header.slice(start,end),!0),44===code&&(push(offers,extensionName,params),params={},extensionName=void 0),start=end=-1}else{if(61!==code||-1===start||-1!==end)throw new Error("unexpected character at index "+i);paramName=header.slice(start,i),start=end=-1}else if(isEscaping){if(1!==tokenChars[code])throw new Error("unexpected character at index "+i);-1===start?start=i:mustUnescape||(mustUnescape=!0),isEscaping=!1}else if(inQuotes)if(1===tokenChars[code])-1===start&&(start=i);else if(34===code&&-1!==start)inQuotes=!1,end=i;else{if(92!==code)throw new Error("unexpected character at index "+i);isEscaping=!0}else if(34===code&&61===header.charCodeAt(i-1))inQuotes=!0;else if(-1===end&&1===tokenChars[code])-1===start&&(start=i);else if(-1===start||32!==code&&9!==code){if(59!==code&&44!==code)throw new Error("unexpected character at index "+i);if(-1===start)throw new Error("unexpected character at index "+i);-1===end&&(end=i);var value=header.slice(start,end);mustUnescape&&(value=value.replace(/\\/g,""),mustUnescape=!1),push(params,paramName,value),44===code&&(push(offers,extensionName,params),params={},extensionName=void 0),paramName=void 0,start=end=-1}else-1===end&&(end=i)}if(-1===start||inQuotes)throw new Error("unexpected end of input");-1===end&&(end=i);var token=header.slice(start,end);return void 0===extensionName?push(offers,token,{}):(void 0===paramName?push(params,token,!0):push(params,paramName,mustUnescape?token.replace(/\\/g,""):token),push(offers,extensionName,params)),offers}},Constants={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",EMPTY_BUFFER:safeBuffer.Buffer.alloc(0),NOOP:function(){}},fallback$1=function(buf){for(var len=buf.length,i=0;i<len;)if(buf[i]<128)i++;else if(192==(224&buf[i])){if(i+1===len||128!=(192&buf[i+1])||192==(254&buf[i]))return!1;i+=2}else if(224==(240&buf[i])){if(len<=i+2||128!=(192&buf[i+1])||128!=(192&buf[i+2])||224===buf[i]&&128==(224&buf[i+1])||237===buf[i]&&160==(224&buf[i+1]))return!1;i+=3}else{if(240!=(248&buf[i]))return!1;if(len<=i+3||128!=(192&buf[i+1])||128!=(192&buf[i+2])||128!=(192&buf[i+3])||240===buf[i]&&128==(240&buf[i+1])||244===buf[i]&&143<buf[i+1]||244<buf[i])return!1;i+=4}return!0},utf8Validate=createCommonjsModule(function(module){try{module.exports=bindings_1("validation")}catch(e){module.exports=fallback$1}}),Validation=createCommonjsModule(function(module){try{var isValidUTF8=utf8Validate;module.exports="object"==typeof isValidUTF8?isValidUTF8.Validation.isValidUTF8:isValidUTF8}catch(e){module.exports=function(){return!0}}}),ErrorCodes_isValidErrorCode=function(code){return 1e3<=code&&code<=1013&&1004!==code&&1005!==code&&1006!==code||3e3<=code&&code<=4999},Buffer$4=safeBuffer.Buffer,Receiver=function(extensions,maxPayload,binaryType){this._binaryType=binaryType||Constants.BINARY_TYPES[0],this._extensions=extensions||{},this._maxPayload=0|maxPayload,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._fragmented=0,this._masked=!1,this._fin=!1,this._mask=null,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._cleanupCallback=null,this._hadError=!1,this._dead=!1,this._loop=!1,this.onmessage=null,this.onclose=null,this.onerror=null,this.onping=null,this.onpong=null,this._state=0};Receiver.prototype.readBuffer=function(bytes){var dst,l,offset=0;if(this._bufferedBytes-=bytes,bytes===this._buffers[0].length)return this._buffers.shift();if(bytes<this._buffers[0].length)return dst=this._buffers[0].slice(0,bytes),this._buffers[0]=this._buffers[0].slice(bytes),dst;for(dst=Buffer$4.allocUnsafe(bytes);0<bytes;)(l=this._buffers[0].length)<=bytes?(this._buffers[0].copy(dst,offset),offset+=l,this._buffers.shift()):(this._buffers[0].copy(dst,offset,0,bytes),this._buffers[0]=this._buffers[0].slice(bytes)),bytes-=l;return dst},Receiver.prototype.hasBufferedBytes=function(n){return this._bufferedBytes>=n||(this._loop=!1,this._dead&&this.cleanup(this._cleanupCallback),!1)},Receiver.prototype.add=function(data){this._dead||(this._bufferedBytes+=data.length,this._buffers.push(data),this.startLoop())},Receiver.prototype.startLoop=function(){for(this._loop=!0;this._loop;)switch(this._state){case 0:this.getInfo();break;case 1:this.getPayloadLength16();break;case 2:this.getPayloadLength64();break;case 3:this.getMask();break;case 4:this.getData();break;default:this._loop=!1}},Receiver.prototype.getInfo=function(){if(this.hasBufferedBytes(2)){var buf=this.readBuffer(2);if(0==(48&buf[0])){var compressed=64==(64&buf[0]);if(!compressed||this._extensions[PerMessageDeflate_1.extensionName]){if(this._fin=128==(128&buf[0]),this._opcode=15&buf[0],this._payloadLength=127&buf[1],0===this._opcode){if(compressed)return void this.error(new Error("RSV1 must be clear"),1002);if(!this._fragmented)return void this.error(new Error("invalid opcode: "+this._opcode),1002);this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return void this.error(new Error("invalid opcode: "+this._opcode),1002);this._compressed=compressed}else{if(!(7<this._opcode&&this._opcode<11))return void this.error(new Error("invalid opcode: "+this._opcode),1002);if(!this._fin)return void this.error(new Error("FIN must be set"),1002);if(compressed)return void this.error(new Error("RSV1 must be clear"),1002);if(125<this._payloadLength)return void this.error(new Error("invalid payload length"),1002)}this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=128==(128&buf[1]),126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength()}else this.error(new Error("RSV1 must be clear"),1002)}else this.error(new Error("RSV2 and RSV3 must be clear"),1002)}},Receiver.prototype.getPayloadLength16=function(){this.hasBufferedBytes(2)&&(this._payloadLength=this.readBuffer(2).readUInt16BE(0,!0),this.haveLength())},Receiver.prototype.getPayloadLength64=function(){if(this.hasBufferedBytes(8)){var buf=this.readBuffer(8),num=buf.readUInt32BE(0,!0);num>Math.pow(2,21)-1?this.error(new Error("max payload size exceeded"),1009):(this._payloadLength=num*Math.pow(2,32)+buf.readUInt32BE(4,!0),this.haveLength())}},Receiver.prototype.haveLength=function(){this._opcode<8&&this.maxPayloadExceeded(this._payloadLength)||(this._masked?this._state=3:this._state=4)},Receiver.prototype.getMask=function(){this.hasBufferedBytes(4)&&(this._mask=this.readBuffer(4),this._state=4)},Receiver.prototype.getData=function(){var data=Constants.EMPTY_BUFFER;if(this._payloadLength){if(!this.hasBufferedBytes(this._payloadLength))return;data=this.readBuffer(this._payloadLength),this._masked&&BufferUtil.unmask(data,this._mask)}7<this._opcode?this.controlMessage(data):this._compressed?(this._state=5,this.decompress(data)):this.pushFragment(data)&&this.dataMessage()},Receiver.prototype.decompress=function(data){var this$1=this;this._extensions[PerMessageDeflate_1.extensionName].decompress(data,this._fin,function(err,buf){err?this$1.error(err,1009===err.closeCode?1009:1007):(this$1.pushFragment(buf)&&this$1.dataMessage(),this$1.startLoop())})},Receiver.prototype.dataMessage=function(){if(this._fin){var messageLength=this._messageLength,fragments=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){var data;data="nodebuffer"===this._binaryType?toBuffer(fragments,messageLength):"arraybuffer"===this._binaryType?function(buf){if(0===buf.byteOffset&&buf.byteLength===buf.buffer.byteLength)return buf.buffer;return buf.buffer.slice(buf.byteOffset,buf.byteOffset+buf.byteLength)}(toBuffer(fragments,messageLength)):fragments,this.onmessage(data)}else{var buf=toBuffer(fragments,messageLength);if(!Validation(buf))return void this.error(new Error("invalid utf8 sequence"),1007);this.onmessage(buf.toString())}}this._state=0},Receiver.prototype.controlMessage=function(data){if(8!==this._opcode)9===this._opcode?this.onping(data):this.onpong(data),this._state=0;else if(0===data.length)this.onclose(1e3,""),this._loop=!1,this.cleanup(this._cleanupCallback);else if(1===data.length)this.error(new Error("invalid payload length"),1002);else{var code=data.readUInt16BE(0,!0);if(!ErrorCodes_isValidErrorCode(code))return void this.error(new Error("invalid status code: "+code),1002);var buf=data.slice(2);if(!Validation(buf))return void this.error(new Error("invalid utf8 sequence"),1007);this.onclose(code,buf.toString()),this._loop=!1,this.cleanup(this._cleanupCallback)}},Receiver.prototype.error=function(err,code){this.onerror(err,code),this._hadError=!0,this._loop=!1,this.cleanup(this._cleanupCallback)},Receiver.prototype.maxPayloadExceeded=function(length){if(0===length||this._maxPayload<1)return!1;var fullLength=this._totalPayloadLength+length;return fullLength<=this._maxPayload?(this._totalPayloadLength=fullLength,!1):(this.error(new Error("max payload size exceeded"),1009),!0)},Receiver.prototype.pushFragment=function(fragment){if(0===fragment.length)return!0;var totalLength=this._messageLength+fragment.length;return this._maxPayload<1||totalLength<=this._maxPayload?(this._messageLength=totalLength,this._fragments.push(fragment),!0):(this.error(new Error("max payload size exceeded"),1009),!1)},Receiver.prototype.cleanup=function(cb){this._dead=!0,this._hadError||!this._loop&&5!==this._state?(this._extensions=null,this._fragments=null,this._buffers=null,this._mask=null,this._cleanupCallback=null,this.onmessage=null,this.onclose=null,this.onerror=null,this.onping=null,this.onpong=null,cb&&cb()):this._cleanupCallback=cb};var Receiver_1=Receiver;function toBuffer(fragments,messageLength){return 1===fragments.length?fragments[0]:1<fragments.length?BufferUtil.concat(fragments,messageLength):Constants.EMPTY_BUFFER}var Buffer$5=safeBuffer.Buffer,Sender=function(socket,extensions){this._extensions=extensions||{},this._socket=socket,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]};Sender.frame=function(data,options){var merge=data.length<1024||options.mask&&options.readOnly,offset=options.mask?6:2,payloadLength=data.length;65536<=data.length?(offset+=8,payloadLength=127):125<data.length&&(offset+=2,payloadLength=126);var target=Buffer$5.allocUnsafe(merge?data.length+offset:offset);if(target[0]=options.fin?128|options.opcode:options.opcode,options.rsv1&&(target[0]|=64),126===payloadLength?target.writeUInt16BE(data.length,2,!0):127===payloadLength&&(target.writeUInt32BE(0,2,!0),target.writeUInt32BE(data.length,6,!0)),!options.mask)return target[1]=payloadLength,merge?(data.copy(target,offset),[target]):[target,data];var mask=crypto.randomBytes(4);return target[1]=128|payloadLength,target[offset-4]=mask[0],target[offset-3]=mask[1],target[offset-2]=mask[2],target[offset-1]=mask[3],merge?(BufferUtil.mask(data,mask,target,offset,data.length),[target]):(BufferUtil.mask(data,mask,data,0,data.length),[target,data])},Sender.prototype.close=function(code,data,mask,cb){var buf;if(void 0===code)code=1e3;else if("number"!=typeof code||!ErrorCodes_isValidErrorCode(code))throw new Error("first argument must be a valid error code number");void 0===data||""===data?1e3===code?buf=Constants.EMPTY_BUFFER:(buf=Buffer$5.allocUnsafe(2)).writeUInt16BE(code,0,!0):((buf=Buffer$5.allocUnsafe(2+Buffer$5.byteLength(data))).writeUInt16BE(code,0,!0),buf.write(data,2)),this._deflating?this.enqueue([this.doClose,buf,mask,cb]):this.doClose(buf,mask,cb)},Sender.prototype.doClose=function(data,mask,cb){this.sendFrame(Sender.frame(data,{fin:!0,rsv1:!1,opcode:8,mask:mask,readOnly:!1}),cb)},Sender.prototype.ping=function(data,mask){var readOnly=!0;Buffer$5.isBuffer(data)||(data instanceof ArrayBuffer?data=Buffer$5.from(data):ArrayBuffer.isView(data)?data=viewToBuffer(data):(data=Buffer$5.from(data),readOnly=!1)),this._deflating?this.enqueue([this.doPing,data,mask,readOnly]):this.doPing(data,mask,readOnly)},Sender.prototype.doPing=function(data,mask,readOnly){this.sendFrame(Sender.frame(data,{fin:!0,rsv1:!1,opcode:9,mask:mask,readOnly:readOnly}))},Sender.prototype.pong=function(data,mask){var readOnly=!0;Buffer$5.isBuffer(data)||(data instanceof ArrayBuffer?data=Buffer$5.from(data):ArrayBuffer.isView(data)?data=viewToBuffer(data):(data=Buffer$5.from(data),readOnly=!1)),this._deflating?this.enqueue([this.doPong,data,mask,readOnly]):this.doPong(data,mask,readOnly)},Sender.prototype.doPong=function(data,mask,readOnly){this.sendFrame(Sender.frame(data,{fin:!0,rsv1:!1,opcode:10,mask:mask,readOnly:readOnly}))},Sender.prototype.send=function(data,options,cb){var opcode=options.binary?2:1,rsv1=options.compress,readOnly=!0;Buffer$5.isBuffer(data)||(data instanceof ArrayBuffer?data=Buffer$5.from(data):ArrayBuffer.isView(data)?data=viewToBuffer(data):(data=Buffer$5.from(data),readOnly=!1));var perMessageDeflate=this._extensions[PerMessageDeflate_1.extensionName];if(this._firstFragment?(this._firstFragment=!1,rsv1&&perMessageDeflate&&(rsv1=data.length>=perMessageDeflate._threshold),this._compress=rsv1):(rsv1=!1,opcode=0),options.fin&&(this._firstFragment=!0),perMessageDeflate){var opts={fin:options.fin,rsv1:rsv1,opcode:opcode,mask:options.mask,readOnly:readOnly};this._deflating?this.enqueue([this.dispatch,data,this._compress,opts,cb]):this.dispatch(data,this._compress,opts,cb)}else this.sendFrame(Sender.frame(data,{fin:options.fin,rsv1:!1,opcode:opcode,mask:options.mask,readOnly:readOnly}),cb)},Sender.prototype.dispatch=function(data,compress,options,cb){var this$1=this;if(compress){var perMessageDeflate=this._extensions[PerMessageDeflate_1.extensionName];this._deflating=!0,perMessageDeflate.compress(data,options.fin,function(_,buf){options.readOnly=!1,this$1.sendFrame(Sender.frame(buf,options),cb),this$1._deflating=!1,this$1.dequeue()})}else this.sendFrame(Sender.frame(data,options),cb)},Sender.prototype.dequeue=function(){for(;!this._deflating&&this._queue.length;){var params=this._queue.shift();this._bufferedBytes-=params[1].length,params[0].apply(this,params.slice(1))}},Sender.prototype.enqueue=function(params){this._bufferedBytes+=params[1].length,this._queue.push(params)},Sender.prototype.sendFrame=function(list,cb){2===list.length?(this._socket.write(list[0]),this._socket.write(list[1],cb)):this._socket.write(list[0],cb)};var Sender_1=Sender;function viewToBuffer(view){var buf=Buffer$5.from(view.buffer);return view.byteLength!==view.buffer.byteLength?buf.slice(view.byteOffset,view.byteOffset+view.byteLength):buf}var EventEmitter$1=events&&EventEmitter||events,http$2=http$1&&http||http$1,url$2=url$1&&url||url$1,protocolVersions=[8,13],WebSocket=function(EventEmitter){function WebSocket(address,protocols,options){EventEmitter.call(this),protocols?"string"==typeof protocols?protocols=[protocols]:Array.isArray(protocols)||(options=protocols,protocols=[]):protocols=[],this.readyState=WebSocket.CONNECTING,this.bytesReceived=0,this.extensions={},this.protocol="",this._binaryType=Constants.BINARY_TYPES[0],this._finalize=this.finalize.bind(this),this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._finalized=!1,this._closeCode=1006,this._receiver=null,this._sender=null,this._socket=null,this._ultron=null,Array.isArray(address)?function(socket,head,options){this.protocolVersion=options.protocolVersion,this._maxPayload=options.maxPayload,this.extensions=options.extensions,this.protocol=options.protocol,this._isServer=!0,this.setSocket(socket,head)}.call(this,address[0],address[1],options):initAsClient.call(this,address,protocols,options)}EventEmitter&&(WebSocket.__proto__=EventEmitter),(WebSocket.prototype=Object.create(EventEmitter&&EventEmitter.prototype)).constructor=WebSocket;var prototypeAccessors={CONNECTING:{configurable:!0},CLOSING:{configurable:!0},CLOSED:{configurable:!0},OPEN:{configurable:!0},bufferedAmount:{configurable:!0},binaryType:{configurable:!0}};return prototypeAccessors.CONNECTING.get=function(){return WebSocket.CONNECTING},prototypeAccessors.CLOSING.get=function(){return WebSocket.CLOSING},prototypeAccessors.CLOSED.get=function(){return WebSocket.CLOSED},prototypeAccessors.OPEN.get=function(){return WebSocket.OPEN},prototypeAccessors.bufferedAmount.get=function(){var amount=0;return this._socket&&(amount=this._socket.bufferSize+this._sender._bufferedBytes),amount},prototypeAccessors.binaryType.get=function(){return this._binaryType},prototypeAccessors.binaryType.set=function(type){Constants.BINARY_TYPES.indexOf(type)<0||(this._binaryType=type,this._receiver&&(this._receiver._binaryType=type))},WebSocket.prototype.setSocket=function(socket,head){var this$1=this;socket.setTimeout(0),socket.setNoDelay(),this._receiver=new Receiver_1(this.extensions,this._maxPayload,this.binaryType),this._sender=new Sender_1(socket,this.extensions),this._ultron=new ultron(socket),this._socket=socket,this._ultron.on("close",this._finalize),this._ultron.on("error",this._finalize),this._ultron.on("end",this._finalize),0<head.length&&socket.unshift(head),this._ultron.on("data",function(data){this$1.bytesReceived+=data.length,this$1._receiver.add(data)}),this._receiver.onmessage=function(data){return this$1.emit("message",data)},this._receiver.onping=function(data){this$1.pong(data,!this$1._isServer,!0),this$1.emit("ping",data)},this._receiver.onpong=function(data){return this$1.emit("pong",data)},this._receiver.onclose=function(code,reason){this$1._closeFrameReceived=!0,this$1._closeMessage=reason,this$1._closeCode=code,this$1._finalized||this$1.close(code,reason)},this._receiver.onerror=function(error,code){this$1._closeMessage="",this$1._closeCode=code,this$1.readyState=WebSocket.CLOSING,this$1.emit("error",error),this$1.finalize(!0)},this.readyState=WebSocket.OPEN,this.emit("open")},WebSocket.prototype.finalize=function(error){var this$1=this;if(!this._finalized){if(this.readyState=WebSocket.CLOSING,this._finalized=!0,"object"==typeof error&&this.emit("error",error),!this._socket)return this.emitClose();clearTimeout(this._closeTimer),this._closeTimer=null,this._ultron.destroy(),this._ultron=null,this._socket.on("error",Constants.NOOP),error?this._socket.destroy():this._socket.end(),this._socket=null,this._sender=null,this._receiver.cleanup(function(){return this$1.emitClose()}),this._receiver=null}},WebSocket.prototype.emitClose=function(){this.readyState=WebSocket.CLOSED,this.emit("close",this._closeCode,this._closeMessage),this.extensions[PerMessageDeflate_1.extensionName]&&this.extensions[PerMessageDeflate_1.extensionName].cleanup(),this.extensions=null,this.removeAllListeners()},WebSocket.prototype.pause=function(){if(this.readyState!==WebSocket.OPEN)throw new Error("not opened");this._socket.pause()},WebSocket.prototype.resume=function(){if(this.readyState!==WebSocket.OPEN)throw new Error("not opened");this._socket.resume()},WebSocket.prototype.close=function(code,data){var this$1=this;if(this.readyState!==WebSocket.CLOSED)return this.readyState===WebSocket.CONNECTING?(this._req.abort(),void this.finalize(new Error("closed before the connection is established"))):void(this.readyState!==WebSocket.CLOSING?(this.readyState=WebSocket.CLOSING,this._sender.close(code,data,!this._isServer,function(err){err||(this$1._closeFrameSent=!0,this$1._finalized||(this$1._closeFrameReceived&&this$1._socket.end(),this$1._closeTimer=setTimeout(this$1._finalize,3e4,!0)))})):this._closeFrameSent&&this._closeFrameReceived&&this._socket.end())},WebSocket.prototype.ping=function(data,mask,failSilently){if(this.readyState!==WebSocket.OPEN){if(failSilently)return;throw new Error("not opened")}"number"==typeof data&&(data=data.toString()),void 0===mask&&(mask=!this._isServer),this._sender.ping(data||Constants.EMPTY_BUFFER,mask)},WebSocket.prototype.pong=function(data,mask,failSilently){if(this.readyState!==WebSocket.OPEN){if(failSilently)return;throw new Error("not opened")}"number"==typeof data&&(data=data.toString()),void 0===mask&&(mask=!this._isServer),this._sender.pong(data||Constants.EMPTY_BUFFER,mask)},WebSocket.prototype.send=function(data,options,cb){if("function"==typeof options&&(cb=options,options={}),this.readyState===WebSocket.OPEN){"number"==typeof data&&(data=data.toString());var opts=Object.assign({binary:"string"!=typeof data,mask:!this._isServer,compress:!0,fin:!0},options);this.extensions[PerMessageDeflate_1.extensionName]||(opts.compress=!1),this._sender.send(data||Constants.EMPTY_BUFFER,opts,cb)}else{if(!cb)throw new Error("not opened");cb(new Error("not opened"))}},WebSocket.prototype.terminate=function(){if(this.readyState!==WebSocket.CLOSED)return this.readyState===WebSocket.CONNECTING?(this._req.abort(),void this.finalize(new Error("closed before the connection is established"))):void this.finalize(!0)},Object.defineProperties(WebSocket.prototype,prototypeAccessors),WebSocket}(EventEmitter$1);WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,["open","error","close","message"].forEach(function(method){Object.defineProperty(WebSocket.prototype,"on"+method,{get:function(){for(var listeners=this.listeners(method),i=0;i<listeners.length;i++)if(listeners[i]._listener)return listeners[i]._listener},set:function(listener){for(var listeners=this.listeners(method),i=0;i<listeners.length;i++)listeners[i]._listener&&this.removeListener(method,listeners[i]);this.addEventListener(method,listener)}})}),WebSocket.prototype.addEventListener=EventTarget_1.addEventListener,WebSocket.prototype.removeEventListener=EventTarget_1.removeEventListener;var WebSocket_1=WebSocket;function initAsClient(address,protocols,options){var obj,this$1=this;if(options=Object.assign({protocolVersion:protocolVersions[1],protocol:protocols.join(","),perMessageDeflate:!0,handshakeTimeout:null,localAddress:null,headers:null,family:null,origin:null,agent:null,host:null,checkServerIdentity:null,rejectUnauthorized:null,passphrase:null,ciphers:null,ecdhCurve:null,cert:null,key:null,pfx:null,ca:null},options),-1===protocolVersions.indexOf(options.protocolVersion))throw new Error("unsupported protocol version: "+options.protocolVersion+" (supported versions: "+protocolVersions.join(", ")+")");this.protocolVersion=options.protocolVersion,this._isServer=!1,this.url=address;var serverUrl=url$2.parse(address),isUnixSocket="ws+unix:"===serverUrl.protocol;if(!(serverUrl.host||isUnixSocket&&serverUrl.path))throw new Error("invalid url");var perMessageDeflate,isSecure="wss:"===serverUrl.protocol||"https:"===serverUrl.protocol,key=crypto.randomBytes(16).toString("base64"),httpObj=http$2,requestOptions={port:serverUrl.port||(isSecure?443:80),host:serverUrl.hostname,path:"/",headers:{"Sec-WebSocket-Version":options.protocolVersion,"Sec-WebSocket-Key":key,Connection:"Upgrade",Upgrade:"websocket"}};if(options.headers&&Object.assign(requestOptions.headers,options.headers),options.perMessageDeflate&&(perMessageDeflate=new PerMessageDeflate_1(!0!==options.perMessageDeflate?options.perMessageDeflate:{},!1),requestOptions.headers["Sec-WebSocket-Extensions"]=Extensions.format(((obj={})[PerMessageDeflate_1.extensionName]=perMessageDeflate.offer(),obj))),options.protocol&&(requestOptions.headers["Sec-WebSocket-Protocol"]=options.protocol),options.origin&&(options.protocolVersion<13?requestOptions.headers["Sec-WebSocket-Origin"]=options.origin:requestOptions.headers.Origin=options.origin),options.host&&(requestOptions.headers.Host=options.host),serverUrl.auth&&(requestOptions.auth=serverUrl.auth),options.localAddress&&(requestOptions.localAddress=options.localAddress),options.family&&(requestOptions.family=options.family),isUnixSocket){var parts=serverUrl.path.split(":");requestOptions.socketPath=parts[0],requestOptions.path=parts[1]}else serverUrl.path&&("/"!==serverUrl.path.charAt(0)?requestOptions.path="/"+serverUrl.path:requestOptions.path=serverUrl.path);var agent=options.agent;(null!=options.rejectUnauthorized||options.checkServerIdentity||options.passphrase||options.ciphers||options.ecdhCurve||options.cert||options.key||options.pfx||options.ca)&&(options.passphrase&&(requestOptions.passphrase=options.passphrase),options.ciphers&&(requestOptions.ciphers=options.ciphers),options.ecdhCurve&&(requestOptions.ecdhCurve=options.ecdhCurve),options.cert&&(requestOptions.cert=options.cert),options.key&&(requestOptions.key=options.key),options.pfx&&(requestOptions.pfx=options.pfx),options.ca&&(requestOptions.ca=options.ca),options.checkServerIdentity&&(requestOptions.checkServerIdentity=options.checkServerIdentity),null!=options.rejectUnauthorized&&(requestOptions.rejectUnauthorized=options.rejectUnauthorized),agent||(agent=new httpObj.Agent(requestOptions))),agent&&(requestOptions.agent=agent),this._req=httpObj.get(requestOptions),options.handshakeTimeout&&this._req.setTimeout(options.handshakeTimeout,function(){this$1._req.abort(),this$1.finalize(new Error("opening handshake has timed out"))}),this._req.on("error",function(error){this$1._req.aborted||(this$1._req=null,this$1.finalize(error))}),this._req.on("response",function(res){this$1.emit("unexpected-response",this$1._req,res)||(this$1._req.abort(),this$1.finalize(new Error("unexpected server response ("+res.statusCode+")")))}),this._req.on("upgrade",function(res,socket,head){if(this$1.emit("headers",res.headers,res),this$1.readyState===WebSocket.CONNECTING){this$1._req=null;var digest=crypto.createHash("sha1").update(key+Constants.GUID,"binary").digest("base64");if(res.headers["sec-websocket-accept"]!==digest)return socket.destroy(),this$1.finalize(new Error("invalid server key"));var protError,serverProt=res.headers["sec-websocket-protocol"],protList=(options.protocol||"").split(/, */);if(!options.protocol&&serverProt?protError="server sent a subprotocol even though none requested":options.protocol&&!serverProt?protError="server sent no subprotocol even though requested":serverProt&&-1===protList.indexOf(serverProt)&&(protError="server responded with an invalid protocol"),protError)return socket.destroy(),this$1.finalize(new Error(protError));if(serverProt&&(this$1.protocol=serverProt),perMessageDeflate)try{var serverExtensions=Extensions.parse(res.headers["sec-websocket-extensions"]);serverExtensions[PerMessageDeflate_1.extensionName]&&(perMessageDeflate.accept(serverExtensions[PerMessageDeflate_1.extensionName]),this$1.extensions[PerMessageDeflate_1.extensionName]=perMessageDeflate)}catch(err){return socket.destroy(),void this$1.finalize(new Error("invalid Sec-WebSocket-Extensions header"))}this$1.setSocket(socket,head)}})}var Buffer$6=safeBuffer.Buffer,WebSocketServer_1=function(EventEmitter){function WebSocketServer(options,callback){var this$1=this;if(EventEmitter.call(this),null==(options=Object.assign({maxPayload:104857600,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null},options)).port&&!options.server&&!options.noServer)throw new TypeError("missing or invalid options");null!=options.port?(this._server=http$2.createServer(function(req,res){var body=http$2.STATUS_CODES[426];res.writeHead(426,{"Content-Length":body.length,"Content-Type":"text/plain"}),res.end(body)}),this._server.listen(options.port,options.host,options.backlog,callback)):options.server&&(this._server=options.server),this._server&&(this._ultron=new ultron(this._server),this._ultron.on("listening",function(){return this$1.emit("listening")}),this._ultron.on("error",function(err){return this$1.emit("error",err)}),this._ultron.on("upgrade",function(req,socket,head){this$1.handleUpgrade(req,socket,head,function(client){this$1.emit("connection",client,req)})})),!0===options.perMessageDeflate&&(options.perMessageDeflate={}),options.clientTracking&&(this.clients=new Set),this.options=options}return EventEmitter&&(WebSocketServer.__proto__=EventEmitter),((WebSocketServer.prototype=Object.create(EventEmitter&&EventEmitter.prototype)).constructor=WebSocketServer).prototype.close=function(cb){if(this.clients)for(var i=0,list=this.clients;i<list.length;i+=1){list[i].terminate()}var server=this._server;if(server&&(this._ultron.destroy(),this._ultron=this._server=null,null!=this.options.port))return server.close(cb);cb&&cb()},WebSocketServer.prototype.shouldHandle=function(req){return!this.options.path||url$2.parse(req.url).pathname===this.options.path},WebSocketServer.prototype.handleUpgrade=function(req,socket,head,cb){var this$1=this;socket.on("error",socketError);var version=+req.headers["sec-websocket-version"],extensions={};if("GET"!==req.method||"websocket"!==req.headers.upgrade.toLowerCase()||!req.headers["sec-websocket-key"]||8!==version&&13!==version||!this.shouldHandle(req))return abortConnection(socket,400);if(this.options.perMessageDeflate){var perMessageDeflate=new PerMessageDeflate_1(this.options.perMessageDeflate,!0,this.options.maxPayload);try{var offers=Extensions.parse(req.headers["sec-websocket-extensions"]);offers[PerMessageDeflate_1.extensionName]&&(perMessageDeflate.accept(offers[PerMessageDeflate_1.extensionName]),extensions[PerMessageDeflate_1.extensionName]=perMessageDeflate)}catch(err){return abortConnection(socket,400)}}var protocol=(req.headers["sec-websocket-protocol"]||"").split(/, */);if(this.options.handleProtocols){if(!1===(protocol=this.options.handleProtocols(protocol,req)))return abortConnection(socket,401)}else protocol=protocol[0];if(this.options.verifyClient){var info={origin:req.headers[8===version?"sec-websocket-origin":"origin"],secure:!(!req.connection.authorized&&!req.connection.encrypted),req:req};if(2===this.options.verifyClient.length)return void this.options.verifyClient(info,function(verified,code,message){if(!verified)return abortConnection(socket,code||401,message);this$1.completeUpgrade(protocol,extensions,version,req,socket,head,cb)});if(!this.options.verifyClient(info))return abortConnection(socket,401)}this.completeUpgrade(protocol,extensions,version,req,socket,head,cb)},WebSocketServer.prototype.completeUpgrade=function(protocol,extensions,version,req,socket,head,cb){var obj,this$1=this;if(!socket.readable||!socket.writable)return socket.destroy();var headers=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade","Sec-WebSocket-Accept: "+crypto.createHash("sha1").update(req.headers["sec-websocket-key"]+Constants.GUID,"binary").digest("base64")];if(protocol&&headers.push("Sec-WebSocket-Protocol: "+protocol),extensions[PerMessageDeflate_1.extensionName]){var params=extensions[PerMessageDeflate_1.extensionName].params,value=Extensions.format(((obj={})[PerMessageDeflate_1.extensionName]=[params],obj));headers.push("Sec-WebSocket-Extensions: "+value)}this.emit("headers",headers,req),socket.write(headers.concat("\r\n").join("\r\n"));var client=new WebSocket_1([socket,head],null,{maxPayload:this.options.maxPayload,protocolVersion:version,extensions:extensions,protocol:protocol});this.clients&&(this.clients.add(client),client.on("close",function(){return this$1.clients.delete(client)})),socket.removeListener("error",socketError),cb(client)},WebSocketServer}(EventEmitter$1);function socketError(){this.destroy()}function abortConnection(socket,code,message){socket.writable&&(message=message||http$2.STATUS_CODES[code],socket.write("HTTP/1.1 "+code+" "+http$2.STATUS_CODES[code]+"\r\nConnection: close\r\nContent-type: text/html\r\nContent-Length: "+Buffer$6.byteLength(message)+"\r\n\r\n"+message)),socket.removeListener("error",socketError),socket.destroy()}WebSocket_1.Server=WebSocketServer_1,WebSocket_1.Receiver=Receiver_1,WebSocket_1.Sender=Sender_1;var WebSocket$1,createWebSocket,ws=WebSocket_1,querystring=qs$1&&qs||qs$1,Response$1=response.Response;commonjsGlobal.WebSocket?(WebSocket$1=commonjsGlobal.WebSocket,createWebSocket=function(uri,options){return new WebSocket$1(uri)}):(WebSocket$1=ws,createWebSocket=function(uri,options){return new WebSocket$1(uri,null,options)});var TimeoutError$1=scErrors.TimeoutError,BadConnectionError$1=scErrors.BadConnectionError,SCTransport=function(authEngine,codecEngine,options){this.state=this.CLOSED,this.auth=authEngine,this.codec=codecEngine,this.options=options,this.connectTimeout=options.connectTimeout,this.pingTimeout=options.ackTimeout,this.callIdGenerator=options.callIdGenerator,this.authTokenName=options.authTokenName,this._pingTimeoutTicker=null,this._callbackMap={},this._batchSendList=[],this.open()};SCTransport.prototype=Object.create(componentEmitter.prototype),SCTransport.CONNECTING=SCTransport.prototype.CONNECTING="connecting",SCTransport.OPEN=SCTransport.prototype.OPEN="open",SCTransport.CLOSED=SCTransport.prototype.CLOSED="closed",SCTransport.prototype.uri=function(){var host,query=this.options.query||{},schema=this.options.secure?"wss":"ws";if(this.options.timestampRequests&&(query[this.options.timestampParam]=(new Date).getTime()),(query=querystring.encode(query)).length&&(query="?"+query),this.options.host)host=this.options.host;else{var port="";this.options.port&&("wss"==schema&&443!=this.options.port||"ws"==schema&&80!=this.options.port)&&(port=":"+this.options.port),host=this.options.hostname+port}return schema+"://"+host+this.options.path+query},SCTransport.prototype.open=function(){var self=this;this.state=this.CONNECTING;var uri=this.uri(),wsSocket=createWebSocket(uri,this.options);wsSocket.binaryType=this.options.binaryType,(this.socket=wsSocket).onopen=function(){self._onOpen()},wsSocket.onclose=function(event){var code;code=null==event.code?1005:event.code,self._onClose(code,event.reason)},wsSocket.onmessage=function(message,flags){self._onMessage(message.data)},wsSocket.onerror=function(error){self.state===self.CONNECTING&&self._onClose(1006)},this._connectTimeoutRef=setTimeout(function(){self._onClose(4007),self.socket.close(4007)},this.connectTimeout)},SCTransport.prototype._onOpen=function(){var self=this;clearTimeout(this._connectTimeoutRef),this._resetPingTimeout(),this._handshake(function(err,status){var statusCode;err?(statusCode=status&&status.code?status.code:4003,self._onError(err),self._onClose(statusCode,err.toString()),self.socket.close(statusCode)):(self.state=self.OPEN,componentEmitter.prototype.emit.call(self,"open",status),self._resetPingTimeout())})},SCTransport.prototype._handshake=function(callback){var self=this;this.auth.loadToken(this.authTokenName,function(err,token){if(err)callback(err);else{self.emit("#handshake",{authToken:token},{force:!0},function(err,status){status&&(status.authToken=token,status.authError&&(status.authError=scErrors.hydrateError(status.authError))),callback(err,status)})}})},SCTransport.prototype._abortAllPendingEventsDueToBadConnection=function(failureType){for(var i in this._callbackMap)if(this._callbackMap.hasOwnProperty(i)){var eventObject=this._callbackMap[i];delete this._callbackMap[i],clearTimeout(eventObject.timeout),delete eventObject.timeout;var errorMessage="Event '"+eventObject.event+"' was aborted due to a bad connection",badConnectionError=new BadConnectionError$1(errorMessage,failureType),callback=eventObject.callback;delete eventObject.callback,callback.call(eventObject,badConnectionError,eventObject)}},SCTransport.prototype._onClose=function(code,data){delete this.socket.onopen,delete this.socket.onclose,delete this.socket.onmessage,delete this.socket.onerror,clearTimeout(this._connectTimeoutRef),this.state==this.OPEN?(this.state=this.CLOSED,componentEmitter.prototype.emit.call(this,"close",code,data),this._abortAllPendingEventsDueToBadConnection("disconnect")):this.state==this.CONNECTING&&(this.state=this.CLOSED,componentEmitter.prototype.emit.call(this,"openAbort",code,data),this._abortAllPendingEventsDueToBadConnection("connectAbort"))},SCTransport.prototype._handleEventObject=function(obj,message){if(obj&&null!=obj.event){var response$$1=new Response$1(this,obj.cid);componentEmitter.prototype.emit.call(this,"event",obj.event,obj.data,response$$1)}else if(obj&&null!=obj.rid){var eventObject=this._callbackMap[obj.rid];if(eventObject&&(clearTimeout(eventObject.timeout),delete eventObject.timeout,delete this._callbackMap[obj.rid],eventObject.callback)){var rehydratedError=scErrors.hydrateError(obj.error);eventObject.callback(rehydratedError,obj.data)}}else componentEmitter.prototype.emit.call(this,"event","raw",message)},SCTransport.prototype._onMessage=function(message){componentEmitter.prototype.emit.call(this,"event","message",message);var obj=this.decode(message);if("#1"==obj)this._resetPingTimeout(),this.socket.readyState==this.socket.OPEN&&this.sendObject("#2");else if(Array.isArray(obj))for(var len=obj.length,i=0;i<len;i++)this._handleEventObject(obj[i],message);else this._handleEventObject(obj,message)},SCTransport.prototype._onError=function(err){componentEmitter.prototype.emit.call(this,"error",err)},SCTransport.prototype._resetPingTimeout=function(){var self=this;(new Date).getTime();clearTimeout(this._pingTimeoutTicker),this._pingTimeoutTicker=setTimeout(function(){self._onClose(4e3),self.socket.close(4e3)},this.pingTimeout)},SCTransport.prototype.getBytesReceived=function(){return this.socket.bytesReceived},SCTransport.prototype.close=function(code,data){if(code=code||1e3,this.state==this.OPEN){var packet={code:code,data:data};this.emit("#disconnect",packet),this._onClose(code,data),this.socket.close(code)}else this.state==this.CONNECTING&&(this._onClose(code,data),this.socket.close(code))},SCTransport.prototype.emitObject=function(eventObject,options){var simpleEventObject={event:eventObject.event,data:eventObject.data};return eventObject.callback&&(simpleEventObject.cid=eventObject.cid=this.callIdGenerator(),this._callbackMap[eventObject.cid]=eventObject),this.sendObject(simpleEventObject,options),eventObject.cid||null},SCTransport.prototype._handleEventAckTimeout=function(eventObject){eventObject.cid&&delete this._callbackMap[eventObject.cid],delete eventObject.timeout;var callback=eventObject.callback;if(callback){delete eventObject.callback;var error=new TimeoutError$1("Event response for '"+eventObject.event+"' timed out");callback.call(eventObject,error,eventObject)}},SCTransport.prototype.emit=function(event,data,a,b){var callback,options,self=this;b?(options=a,callback=b):a instanceof Function?(options={},callback=a):options=a;var eventObject={event:event,data:data,callback:callback};callback&&!options.noTimeout&&(eventObject.timeout=setTimeout(function(){self._handleEventAckTimeout(eventObject)},this.options.ackTimeout));var cid=null;return(this.state==this.OPEN||options.force)&&(cid=this.emitObject(eventObject,options)),cid},SCTransport.prototype.cancelPendingResponse=function(cid){delete this._callbackMap[cid]},SCTransport.prototype.decode=function(message){return this.codec.decode(message)},SCTransport.prototype.encode=function(object){return this.codec.encode(object)},SCTransport.prototype.send=function(data){this.socket.readyState!=this.socket.OPEN?this._onClose(1005):this.socket.send(data)},SCTransport.prototype.serializeObject=function(object){var str,formatError;try{str=this.encode(object)}catch(err){formatError=err,this._onError(formatError)}return formatError?null:str},SCTransport.prototype.sendObjectBatch=function(object){var self=this;this._batchSendList.push(object),this._batchTimeout||(this._batchTimeout=setTimeout(function(){if(delete self._batchTimeout,self._batchSendList.length){var str=self.serializeObject(self._batchSendList);null!=str&&self.send(str),self._batchSendList=[]}},this.options.pubSubBatchDuration||0))},SCTransport.prototype.sendObjectSingle=function(object){var str=this.serializeObject(object);null!=str&&this.send(str)},SCTransport.prototype.sendObject=function(object,options){options&&options.batch?this.sendObjectBatch(object):this.sendObjectSingle(object)};var errorMessage,ListPrototype,sctransport={SCTransport:SCTransport};function List(){if(arguments.length)return List.from(arguments)}function ListItem(){}errorMessage="An argument without append, prepend, or detach methods was given to `List",ListPrototype=List.prototype,List.of=function(){return List.from.call(this,arguments)},List.from=function(items){var length,iterator,item,list=new this;if(items&&(length=items.length))for(iterator=-1;++iterator<length;)null!=(item=items[iterator])&&list.append(item);return list},ListPrototype.head=null,ListPrototype.tail=null,ListPrototype.toArray=function(){for(var item=this.head,result=[];item;)result.push(item),item=item.next;return result},ListPrototype.prepend=function(item){if(!item)return!1;if(!item.append||!item.prepend||!item.detach)throw new Error(errorMessage+"#prepend`.");var head;return(head=this.head)?head.prepend(item):(item.detach(),(item.list=this).head=item)},ListPrototype.append=function(item){if(!item)return!1;if(!item.append||!item.prepend||!item.detach)throw new Error(errorMessage+"#append`.");var head,tail;return(tail=this.tail)?tail.append(item):(head=this.head)?head.append(item):(item.detach(),(item.list=this).head=item)};var ListItemPrototype=(List.Item=ListItem).prototype;ListItemPrototype.next=null,ListItemPrototype.prev=null,ListItemPrototype.list=null,ListItemPrototype.detach=function(){var list=this.list,prev=this.prev,next=this.next;return list&&(list.tail===this&&(list.tail=prev),list.head===this&&(list.head=next),list.tail===list.head&&(list.tail=null),prev&&(prev.next=next),next&&(next.prev=prev),this.prev=this.next=this.list=null),this},ListItemPrototype.prepend=function(item){if(!(item&&item.append&&item.prepend&&item.detach))throw new Error(errorMessage+"Item#prepend`.");var list=this.list,prev=this.prev;return!!list&&(item.detach(),prev&&((item.prev=prev).next=item),item.next=this,item.list=list,this.prev=item,this===list.head&&(list.head=item),list.tail||(list.tail=this),item)},ListItemPrototype.append=function(item){if(!(item&&item.append&&item.prepend&&item.detach))throw new Error(errorMessage+"Item#append`.");var list=this.list,next=this.next;return!!list&&(item.detach(),next&&((item.next=next).prev=item),item.prev=this,item.list=list,this.next=item,this!==list.tail&&list.tail||(list.tail=item),item)};var linkedList$1=List,base64=createCommonjsModule(function(module,exports){!function(root){var freeExports=exports,freeModule=module&&module.exports==freeExports&&module,freeGlobal="object"==typeof commonjsGlobal&&commonjsGlobal;freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal||(root=freeGlobal);var InvalidCharacterError=function(message){this.message=message};(InvalidCharacterError.prototype=new Error).name="InvalidCharacterError";var error=function(message){throw new InvalidCharacterError(message)},TABLE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",REGEX_SPACE_CHARACTERS=/[\t\n\f\r ]/g,base64={encode:function(input){input=String(input),/[^\0-\xFF]/.test(input)&&error("The string to be encoded contains characters outside of the Latin1 range.");for(var a,b,c,buffer,padding=input.length%3,output="",position=-1,length=input.length-padding;++position<length;)a=input.charCodeAt(position)<<16,b=input.charCodeAt(++position)<<8,c=input.charCodeAt(++position),output+=TABLE.charAt((buffer=a+b+c)>>18&63)+TABLE.charAt(buffer>>12&63)+TABLE.charAt(buffer>>6&63)+TABLE.charAt(63&buffer);return 2==padding?(a=input.charCodeAt(position)<<8,b=input.charCodeAt(++position),output+=TABLE.charAt((buffer=a+b)>>10)+TABLE.charAt(buffer>>4&63)+TABLE.charAt(buffer<<2&63)+"="):1==padding&&(buffer=input.charCodeAt(position),output+=TABLE.charAt(buffer>>2)+TABLE.charAt(buffer<<4&63)+"=="),output},decode:function(input){var length=(input=String(input).replace(REGEX_SPACE_CHARACTERS,"")).length;length%4==0&&(length=(input=input.replace(/==?$/,"")).length),(length%4==1||/[^+a-zA-Z0-9/]/.test(input))&&error("Invalid character: the string to be decoded is not correctly encoded.");for(var bitStorage,buffer,bitCounter=0,output="",position=-1;++position<length;)buffer=TABLE.indexOf(input.charAt(position)),bitStorage=bitCounter%4?64*bitStorage+buffer:buffer,bitCounter++%4&&(output+=String.fromCharCode(255&bitStorage>>(-2*bitCounter&6)));return output},version:"0.1.0"};if(freeExports&&!freeExports.nodeType)if(freeModule)freeModule.exports=base64;else for(var key in base64)base64.hasOwnProperty(key)&&(freeExports[key]=base64[key]);else root.base64=base64}(commonjsGlobal)}),clone_1=createCommonjsModule(function(module){var clone=function(){function _instanceof(obj,type){return null!=type&&obj instanceof type}var nativeMap,nativeSet,nativePromise;try{nativeMap=Map}catch(_){nativeMap=function(){}}try{nativeSet=Set}catch(_){nativeSet=function(){}}try{nativePromise=Promise}catch(_){nativePromise=function(){}}function clone(parent,circular,depth,prototype,includeNonEnumerable){"object"==typeof circular&&(depth=circular.depth,prototype=circular.prototype,includeNonEnumerable=circular.includeNonEnumerable,circular=circular.circular);var allParents=[],allChildren=[],useBuffer="undefined"!=typeof Buffer;return void 0===circular&&(circular=!0),void 0===depth&&(depth=1/0),function _clone(parent,depth){if(null===parent)return null;if(0===depth)return parent;var child,proto;if("object"!=typeof parent)return parent;if(_instanceof(parent,nativeMap))child=new nativeMap;else if(_instanceof(parent,nativeSet))child=new nativeSet;else if(_instanceof(parent,nativePromise))child=new nativePromise(function(resolve,reject){parent.then(function(value){resolve(_clone(value,depth-1))},function(err){reject(_clone(err,depth-1))})});else if(clone.__isArray(parent))child=[];else if(clone.__isRegExp(parent))child=new RegExp(parent.source,__getRegExpFlags(parent)),parent.lastIndex&&(child.lastIndex=parent.lastIndex);else if(clone.__isDate(parent))child=new Date(parent.getTime());else{if(useBuffer&&Buffer.isBuffer(parent))return child=new Buffer(parent.length),parent.copy(child),child;_instanceof(parent,Error)?child=Object.create(parent):void 0===prototype?(proto=Object.getPrototypeOf(parent),child=Object.create(proto)):(child=Object.create(prototype),proto=prototype)}if(circular){var index=allParents.indexOf(parent);if(-1!=index)return allChildren[index];allParents.push(parent),allChildren.push(child)}for(var i in _instanceof(parent,nativeMap)&&parent.forEach(function(value,key){var keyChild=_clone(key,depth-1),valueChild=_clone(value,depth-1);child.set(keyChild,valueChild)}),_instanceof(parent,nativeSet)&&parent.forEach(function(value){var entryChild=_clone(value,depth-1);child.add(entryChild)}),parent){var attrs;proto&&(attrs=Object.getOwnPropertyDescriptor(proto,i)),attrs&&null==attrs.set||(child[i]=_clone(parent[i],depth-1))}if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(parent);for(i=0;i<symbols.length;i++){var symbol=symbols[i];(!(descriptor=Object.getOwnPropertyDescriptor(parent,symbol))||descriptor.enumerable||includeNonEnumerable)&&(child[symbol]=_clone(parent[symbol],depth-1),descriptor.enumerable||Object.defineProperty(child,symbol,{enumerable:!1}))}}if(includeNonEnumerable){var allPropertyNames=Object.getOwnPropertyNames(parent);for(i=0;i<allPropertyNames.length;i++){var descriptor,propertyName=allPropertyNames[i];(descriptor=Object.getOwnPropertyDescriptor(parent,propertyName))&&descriptor.enumerable||(child[propertyName]=_clone(parent[propertyName],depth-1),Object.defineProperty(child,propertyName,{enumerable:!1}))}}return child}(parent,depth)}function __objToStr(o){return Object.prototype.toString.call(o)}function __getRegExpFlags(re){var flags="";return re.global&&(flags+="g"),re.ignoreCase&&(flags+="i"),re.multiline&&(flags+="m"),flags}return clone.clonePrototype=function(parent){if(null===parent)return null;var c=function(){};return c.prototype=parent,new c},clone.__objToStr=__objToStr,clone.__isDate=function(o){return"object"==typeof o&&"[object Date]"===__objToStr(o)},clone.__isArray=function(o){return"object"==typeof o&&"[object Array]"===__objToStr(o)},clone.__isRegExp=function(o){return"object"==typeof o&&"[object RegExp]"===__objToStr(o)},clone.__getRegExpFlags=__getRegExpFlags,clone}();module.exports&&(module.exports=clone)}),SCChannel$1=scChannel.SCChannel,AuthEngine$1=auth.AuthEngine,SCTransport$1=sctransport.SCTransport,InvalidArgumentsError$1=scErrors.InvalidArgumentsError,InvalidMessageError$1=scErrors.InvalidMessageError,SocketProtocolError$1=scErrors.SocketProtocolError,TimeoutError$2=scErrors.TimeoutError,BadConnectionError$2=scErrors.BadConnectionError,isBrowser="undefined"!=typeof window,SCSocket=function(opts){var self=this;componentEmitter.call(this),this.id=null,this.state=this.CLOSED,this.authState=this.UNAUTHENTICATED,this.signedAuthToken=null,this.authToken=null,this.pendingReconnect=!1,this.pendingReconnectTimeout=null,this.preparingPendingSubscriptions=!1,this.clientId=opts.clientId,this.connectTimeout=opts.connectTimeout,this.ackTimeout=opts.ackTimeout,this.channelPrefix=opts.channelPrefix||null,this.disconnectOnUnload=null==opts.disconnectOnUnload||opts.disconnectOnUnload,this.authTokenName=opts.authTokenName,this.pingTimeout=this.ackTimeout,this._clientMap=opts.clientMap||{};var maxTimeout=Math.pow(2,31)-1,verifyDuration=function(propertyName){if(self[propertyName]>maxTimeout)throw new InvalidArgumentsError$1("The "+propertyName+" value provided exceeded the maximum amount allowed")};if(verifyDuration("connectTimeout"),verifyDuration("ackTimeout"),verifyDuration("pingTimeout"),this._localEvents={connect:1,connectAbort:1,close:1,disconnect:1,message:1,error:1,raw:1,fail:1,kickOut:1,subscribe:1,unsubscribe:1,subscribeStateChange:1,authStateChange:1,authenticate:1,deauthenticate:1,removeAuthToken:1,subscribeRequest:1},this.connectAttempts=0,this._emitBuffer=new linkedList$1,this.channels={},this.options=opts,this._cid=1,this.options.callIdGenerator=function(){return self._cid++},this.options.autoReconnect){null==this.options.autoReconnectOptions&&(this.options.autoReconnectOptions={});var reconnectOptions=this.options.autoReconnectOptions;null==reconnectOptions.initialDelay&&(reconnectOptions.initialDelay=1e4),null==reconnectOptions.randomness&&(reconnectOptions.randomness=1e4),null==reconnectOptions.multiplier&&(reconnectOptions.multiplier=1.5),null==reconnectOptions.maxDelay&&(reconnectOptions.maxDelay=6e4)}null==this.options.subscriptionRetryOptions&&(this.options.subscriptionRetryOptions={}),this.options.authEngine?this.auth=this.options.authEngine:this.auth=new AuthEngine$1,this.options.codecEngine?this.codec=this.options.codecEngine:this.codec=scFormatter,this.options.path=this.options.path.replace(/\/$/,"")+"/",this.options.query=opts.query||{},"string"==typeof this.options.query&&(this.options.query=querystring.parse(this.options.query)),this.options.autoConnect&&this.connect(),this._channelEmitter=new componentEmitter,isBrowser&&this.disconnectOnUnload&&commonjsGlobal.addEventListener&&(this._unloadHandler=function(){self.disconnect()},commonjsGlobal.addEventListener("beforeunload",this._unloadHandler,!1))};SCSocket.prototype=Object.create(componentEmitter.prototype),SCSocket.CONNECTING=SCSocket.prototype.CONNECTING=SCTransport$1.prototype.CONNECTING,SCSocket.OPEN=SCSocket.prototype.OPEN=SCTransport$1.prototype.OPEN,SCSocket.CLOSED=SCSocket.prototype.CLOSED=SCTransport$1.prototype.CLOSED,SCSocket.AUTHENTICATED=SCSocket.prototype.AUTHENTICATED="authenticated",SCSocket.UNAUTHENTICATED=SCSocket.prototype.UNAUTHENTICATED="unauthenticated",SCSocket.PENDING=SCSocket.prototype.PENDING="pending",SCSocket.ignoreStatuses=scErrors.socketProtocolIgnoreStatuses,SCSocket.errorStatuses=scErrors.socketProtocolErrorStatuses,SCSocket.prototype._privateEventHandlerMap={"#publish":function(data){var undecoratedChannelName=this._undecorateChannelName(data.channel);this.isSubscribed(undecoratedChannelName,!0)&&this._channelEmitter.emit(undecoratedChannelName,data.data)},"#kickOut":function(data){var undecoratedChannelName=this._undecorateChannelName(data.channel),channel=this.channels[undecoratedChannelName];channel&&(componentEmitter.prototype.emit.call(this,"kickOut",data.message,undecoratedChannelName),channel.emit("kickOut",data.message,undecoratedChannelName),this._triggerChannelUnsubscribe(channel))},"#setAuthToken":function(data,response$$1){var self=this;if(data){this.auth.saveToken(this.authTokenName,data.token,{},function(err){err?(response$$1.error(err),self._onSCError(err)):(self._changeToAuthenticatedState(data.token),response$$1.end())})}else response$$1.error(new InvalidMessageError$1("No token data provided by #setAuthToken event"))},"#removeAuthToken":function(data,response$$1){var self=this;this.auth.removeToken(this.authTokenName,function(err,oldToken){err?(response$$1.error(err),self._onSCError(err)):(componentEmitter.prototype.emit.call(self,"removeAuthToken",oldToken),self._changeToUnauthenticatedStateAndClearTokens(),response$$1.end())})},"#disconnect":function(data){this.transport.close(data.code,data.data)}},SCSocket.prototype.getState=function(){return this.state},SCSocket.prototype.getBytesReceived=function(){return this.transport.getBytesReceived()},SCSocket.prototype.deauthenticate=function(callback){var self=this;this.auth.removeToken(this.authTokenName,function(err,oldToken){err?self._onSCError(err):(componentEmitter.prototype.emit.call(self,"removeAuthToken",oldToken),self.state!=self.CLOSED&&self.emit("#removeAuthToken"),self._changeToUnauthenticatedStateAndClearTokens()),callback&&callback(err)})},SCSocket.prototype.connect=SCSocket.prototype.open=function(){var self=this;this.state==this.CLOSED&&(this.pendingReconnect=!1,this.pendingReconnectTimeout=null,clearTimeout(this._reconnectTimeoutRef),this.state=this.CONNECTING,componentEmitter.prototype.emit.call(this,"connecting"),this.transport&&this.transport.off(),this.transport=new SCTransport$1(this.auth,this.codec,this.options),this.transport.on("open",function(status){self.state=self.OPEN,self._onSCOpen(status)}),this.transport.on("error",function(err){self._onSCError(err)}),this.transport.on("close",function(code,data){self.state=self.CLOSED,self._onSCClose(code,data)}),this.transport.on("openAbort",function(code,data){self.state=self.CLOSED,self._onSCClose(code,data,!0)}),this.transport.on("event",function(event,data,res){self._onSCEvent(event,data,res)}))},SCSocket.prototype.reconnect=function(){this.disconnect(),this.connect()},SCSocket.prototype.disconnect=function(code,data){if("number"!=typeof(code=code||1e3))throw new InvalidArgumentsError$1("If specified, the code argument must be a number");this.state==this.OPEN||this.state==this.CONNECTING?this.transport.close(code,data):(this.pendingReconnect=!1,this.pendingReconnectTimeout=null,clearTimeout(this._reconnectTimeoutRef))},SCSocket.prototype.destroy=function(){this._unloadHandler&&commonjsGlobal.removeEventListener("beforeunload",this._unloadHandler,!1),this.disconnect(),delete this._clientMap[this.clientId]},SCSocket.prototype._changeToUnauthenticatedStateAndClearTokens=function(){if(this.authState!=this.UNAUTHENTICATED){var oldState=this.authState;this.authState=this.UNAUTHENTICATED,this.signedAuthToken=null,this.authToken=null;var stateChangeData={oldState:oldState,newState:this.authState};componentEmitter.prototype.emit.call(this,"authStateChange",stateChangeData),oldState==this.AUTHENTICATED&&componentEmitter.prototype.emit.call(this,"deauthenticate"),componentEmitter.prototype.emit.call(this,"authTokenChange",this.signedAuthToken)}},SCSocket.prototype._changeToAuthenticatedState=function(signedAuthToken){if(this.signedAuthToken=signedAuthToken,this.authToken=this._extractAuthTokenData(signedAuthToken),this.authState!=this.AUTHENTICATED){var oldState=this.authState;this.authState=this.AUTHENTICATED;var stateChangeData={oldState:oldState,newState:this.authState,signedAuthToken:signedAuthToken,authToken:this.authToken};this.preparingPendingSubscriptions||this.processPendingSubscriptions(),componentEmitter.prototype.emit.call(this,"authStateChange",stateChangeData),componentEmitter.prototype.emit.call(this,"authenticate",signedAuthToken)}componentEmitter.prototype.emit.call(this,"authTokenChange",signedAuthToken)},SCSocket.prototype.decodeBase64=function(encodedString){var decodedString;"undefined"==typeof Buffer?decodedString=commonjsGlobal.atob?commonjsGlobal.atob(encodedString):base64.decode(encodedString):decodedString=new Buffer(encodedString,"base64").toString("utf8");return decodedString},SCSocket.prototype.encodeBase64=function(decodedString){var encodedString;"undefined"==typeof Buffer?encodedString=commonjsGlobal.btoa?commonjsGlobal.btoa(decodedString):base64.encode(decodedString):encodedString=new Buffer(decodedString,"utf8").toString("base64");return encodedString},SCSocket.prototype._extractAuthTokenData=function(signedAuthToken){var encodedTokenData=(signedAuthToken||"").split(".")[1];if(null!=encodedTokenData){var tokenData=encodedTokenData;try{return tokenData=this.decodeBase64(tokenData),JSON.parse(tokenData)}catch(e){return tokenData}}return null},SCSocket.prototype.getAuthToken=function(){return this.authToken},SCSocket.prototype.getSignedAuthToken=function(){return this.signedAuthToken},SCSocket.prototype.authenticate=function(signedAuthToken,callback){var self=this;this.emit("#authenticate",signedAuthToken,function(err,authStatus){authStatus&&null!=authStatus.isAuthenticated?authStatus.authError&&(authStatus.authError=scErrors.hydrateError(authStatus.authError)):authStatus={isAuthenticated:self.authState,authError:null},err?("BadConnectionError"!=err.name&&"TimeoutError"!=err.name&&self._changeToUnauthenticatedStateAndClearTokens(),callback&&callback(err,authStatus)):self.auth.saveToken(self.authTokenName,signedAuthToken,{},function(err){err&&self._onSCError(err),authStatus.isAuthenticated?self._changeToAuthenticatedState(signedAuthToken):self._changeToUnauthenticatedStateAndClearTokens(),callback&&callback(err,authStatus)})})},SCSocket.prototype._tryReconnect=function(initialDelay){var timeout,self=this,exponent=this.connectAttempts++,reconnectOptions=this.options.autoReconnectOptions;if(null==initialDelay||0<exponent){var initialTimeout=Math.round(reconnectOptions.initialDelay+(reconnectOptions.randomness||0)*Math.random());timeout=Math.round(initialTimeout*Math.pow(reconnectOptions.multiplier,exponent))}else timeout=initialDelay;timeout>reconnectOptions.maxDelay&&(timeout=reconnectOptions.maxDelay),clearTimeout(this._reconnectTimeoutRef),this.pendingReconnect=!0,this.pendingReconnectTimeout=timeout,this._reconnectTimeoutRef=setTimeout(function(){self.connect()},timeout)},SCSocket.prototype._onSCOpen=function(status){var self=this;this.preparingPendingSubscriptions=!0,status?(this.id=status.id,this.pingTimeout=status.pingTimeout,this.transport.pingTimeout=this.pingTimeout,status.isAuthenticated?this._changeToAuthenticatedState(status.authToken):this._changeToUnauthenticatedStateAndClearTokens()):this._changeToUnauthenticatedStateAndClearTokens(),this.connectAttempts=0,this.options.autoSubscribeOnConnect&&this.processPendingSubscriptions(),componentEmitter.prototype.emit.call(this,"connect",status,function(){self.processPendingSubscriptions()}),this._flushEmitBuffer()},SCSocket.prototype._onSCError=function(err){var self=this;setTimeout(function(){if(self.listeners("error").length<1)throw err;componentEmitter.prototype.emit.call(self,"error",err)},0)},SCSocket.prototype._suspendSubscriptions=function(){var channel,newState;for(var channelName in this.channels)this.channels.hasOwnProperty(channelName)&&(newState=(channel=this.channels[channelName]).state==channel.SUBSCRIBED||channel.state==channel.PENDING?channel.PENDING:channel.UNSUBSCRIBED,this._triggerChannelUnsubscribe(channel,newState))},SCSocket.prototype._abortAllPendingEventsDueToBadConnection=function(failureType){for(var nextNode,currentNode=this._emitBuffer.head;currentNode;){nextNode=currentNode.next;var eventObject=currentNode.data;clearTimeout(eventObject.timeout),delete eventObject.timeout,currentNode.detach(),currentNode=nextNode;var callback=eventObject.callback;if(callback){delete eventObject.callback;var errorMessage="Event '"+eventObject.event+"' was aborted due to a bad connection",error=new BadConnectionError$2(errorMessage,failureType);callback.call(eventObject,error,eventObject)}eventObject.cid&&this.transport.cancelPendingResponse(eventObject.cid)}},SCSocket.prototype._onSCClose=function(code,data,openAbort){if(this.id=null,this.transport&&this.transport.off(),this.pendingReconnect=!1,this.pendingReconnectTimeout=null,clearTimeout(this._reconnectTimeoutRef),this._suspendSubscriptions(),this._abortAllPendingEventsDueToBadConnection(openAbort?"connectAbort":"disconnect"),this.options.autoReconnect&&(4e3==code||4001==code||1005==code?this._tryReconnect(0):1e3!=code&&code<4500&&this._tryReconnect()),openAbort?componentEmitter.prototype.emit.call(this,"connectAbort",code,data):componentEmitter.prototype.emit.call(this,"disconnect",code,data),componentEmitter.prototype.emit.call(this,"close",code,data),!SCSocket.ignoreStatuses[code]){var closeMessage;closeMessage=data?"Socket connection closed with status code "+code+" and reason: "+data:"Socket connection closed with status code "+code;var err=new SocketProtocolError$1(SCSocket.errorStatuses[code]||closeMessage,code);this._onSCError(err)}},SCSocket.prototype._onSCEvent=function(event,data,res){var handler=this._privateEventHandlerMap[event];handler?handler.call(this,data,res):componentEmitter.prototype.emit.call(this,event,data,function(){res&&res.callback.apply(res,arguments)})},SCSocket.prototype.decode=function(message){return this.transport.decode(message)},SCSocket.prototype.encode=function(object){return this.transport.encode(object)},SCSocket.prototype._flushEmitBuffer=function(){for(var nextNode,currentNode=this._emitBuffer.head;currentNode;){nextNode=currentNode.next;var eventObject=currentNode.data;currentNode.detach(),this.transport.emitObject(eventObject),currentNode=nextNode}},SCSocket.prototype._handleEventAckTimeout=function(eventObject,eventNode){eventNode&&eventNode.detach(),delete eventObject.timeout;var callback=eventObject.callback;if(callback){delete eventObject.callback;var error=new TimeoutError$2("Event response for '"+eventObject.event+"' timed out");callback.call(eventObject,error,eventObject)}eventObject.cid&&this.transport.cancelPendingResponse(eventObject.cid)},SCSocket.prototype._emit=function(event,data,callback){var self=this;this.state==this.CLOSED&&this.connect();var eventObject={event:event,callback:callback},eventNode=new linkedList$1.Item;this.options.cloneData?eventObject.data=clone_1(data):eventObject.data=data,(eventNode.data=eventObject).timeout=setTimeout(function(){self._handleEventAckTimeout(eventObject,eventNode)},this.ackTimeout),this._emitBuffer.append(eventNode),this.state==this.OPEN&&this._flushEmitBuffer()},SCSocket.prototype.send=function(data){this.transport.send(data)},SCSocket.prototype.emit=function(event,data,callback){null==this._localEvents[event]?this._emit(event,data,callback):componentEmitter.prototype.emit.call(this,event,data)},SCSocket.prototype.publish=function(channelName,data,callback){var pubData={channel:this._decorateChannelName(channelName),data:data};this.emit("#publish",pubData,callback)},SCSocket.prototype._triggerChannelSubscribe=function(channel,subscriptionOptions){var channelName=channel.name;if(channel.state!=channel.SUBSCRIBED){var oldState=channel.state;channel.state=channel.SUBSCRIBED;var stateChangeData={channel:channelName,oldState:oldState,newState:channel.state,subscriptionOptions:subscriptionOptions};channel.emit("subscribeStateChange",stateChangeData),channel.emit("subscribe",channelName,subscriptionOptions),componentEmitter.prototype.emit.call(this,"subscribeStateChange",stateChangeData),componentEmitter.prototype.emit.call(this,"subscribe",channelName,subscriptionOptions)}},SCSocket.prototype._triggerChannelSubscribeFail=function(err,channel,subscriptionOptions){var channelName=channel.name,meetsAuthRequirements=!channel.waitForAuth||this.authState==this.AUTHENTICATED;channel.state!=channel.UNSUBSCRIBED&&meetsAuthRequirements&&(channel.state=channel.UNSUBSCRIBED,channel.emit("subscribeFail",err,channelName,subscriptionOptions),componentEmitter.prototype.emit.call(this,"subscribeFail",err,channelName,subscriptionOptions))},SCSocket.prototype._cancelPendingSubscribeCallback=function(channel){null!=channel._pendingSubscriptionCid&&(this.transport.cancelPendingResponse(channel._pendingSubscriptionCid),delete channel._pendingSubscriptionCid)},SCSocket.prototype._decorateChannelName=function(channelName){return this.channelPrefix&&(channelName=this.channelPrefix+channelName),channelName},SCSocket.prototype._undecorateChannelName=function(decoratedChannelName){return this.channelPrefix&&0==decoratedChannelName.indexOf(this.channelPrefix)?decoratedChannelName.replace(this.channelPrefix,""):decoratedChannelName},SCSocket.prototype._trySubscribe=function(channel){var self=this,meetsAuthRequirements=!channel.waitForAuth||this.authState==this.AUTHENTICATED;if(this.state==this.OPEN&&!this.preparingPendingSubscriptions&&null==channel._pendingSubscriptionCid&&meetsAuthRequirements){var options={noTimeout:!0},subscriptionOptions={channel:this._decorateChannelName(channel.name)};channel.waitForAuth&&(options.waitForAuth=!0,subscriptionOptions.waitForAuth=options.waitForAuth),channel.data&&(subscriptionOptions.data=channel.data),channel.batch&&(options.batch=!0,subscriptionOptions.batch=!0),channel._pendingSubscriptionCid=this.transport.emit("#subscribe",subscriptionOptions,options,function(err){delete channel._pendingSubscriptionCid,err?self._triggerChannelSubscribeFail(err,channel,subscriptionOptions):self._triggerChannelSubscribe(channel,subscriptionOptions)}),componentEmitter.prototype.emit.call(this,"subscribeRequest",channel.name,subscriptionOptions)}},SCSocket.prototype.subscribe=function(channelName,options){var channel=this.channels[channelName];return channel?options&&channel.setOptions(options):(channel=new SCChannel$1(channelName,this,options),this.channels[channelName]=channel),channel.state==channel.UNSUBSCRIBED&&(channel.state=channel.PENDING,this._trySubscribe(channel)),channel},SCSocket.prototype._triggerChannelUnsubscribe=function(channel,newState){var channelName=channel.name,oldState=channel.state;if(channel.state=newState||channel.UNSUBSCRIBED,this._cancelPendingSubscribeCallback(channel),oldState==channel.SUBSCRIBED){var stateChangeData={channel:channelName,oldState:oldState,newState:channel.state};channel.emit("subscribeStateChange",stateChangeData),channel.emit("unsubscribe",channelName),componentEmitter.prototype.emit.call(this,"subscribeStateChange",stateChangeData),componentEmitter.prototype.emit.call(this,"unsubscribe",channelName)}},SCSocket.prototype._tryUnsubscribe=function(channel){if(this.state==this.OPEN){var options={noTimeout:!0};channel.batch&&(options.batch=!0),this._cancelPendingSubscribeCallback(channel);var decoratedChannelName=this._decorateChannelName(channel.name);this.transport.emit("#unsubscribe",decoratedChannelName,options)}},SCSocket.prototype.unsubscribe=function(channelName){var channel=this.channels[channelName];channel&&channel.state!=channel.UNSUBSCRIBED&&(this._triggerChannelUnsubscribe(channel),this._tryUnsubscribe(channel))},SCSocket.prototype.channel=function(channelName,options){var currentChannel=this.channels[channelName];return currentChannel||(currentChannel=new SCChannel$1(channelName,this,options),this.channels[channelName]=currentChannel),currentChannel},SCSocket.prototype.destroyChannel=function(channelName){var channel=this.channels[channelName];channel.unwatch(),channel.unsubscribe(),delete this.channels[channelName]},SCSocket.prototype.subscriptions=function(includePending){var channel,subs=[];for(var channelName in this.channels)this.channels.hasOwnProperty(channelName)&&(channel=this.channels[channelName],(includePending?channel&&(channel.state==channel.SUBSCRIBED||channel.state==channel.PENDING):channel&&channel.state==channel.SUBSCRIBED)&&subs.push(channelName));return subs},SCSocket.prototype.isSubscribed=function(channelName,includePending){var channel=this.channels[channelName];return includePending?!!channel&&(channel.state==channel.SUBSCRIBED||channel.state==channel.PENDING):!!channel&&channel.state==channel.SUBSCRIBED},SCSocket.prototype.processPendingSubscriptions=function(){var self=this;this.preparingPendingSubscriptions=!1;var pendingChannels=[];for(var i in this.channels)if(this.channels.hasOwnProperty(i)){var channel=this.channels[i];channel.state==channel.PENDING&&pendingChannels.push(channel)}pendingChannels.sort(function(a,b){var ap=a.priority||0,bp=b.priority||0;return bp<ap?-1:ap<bp?1:0}),pendingChannels.forEach(function(channel){self._trySubscribe(channel)})},SCSocket.prototype.watch=function(channelName,handler){if("function"!=typeof handler)throw new InvalidArgumentsError$1("No handler function was provided");this._channelEmitter.on(channelName,handler)},SCSocket.prototype.unwatch=function(channelName,handler){handler?this._channelEmitter.removeListener(channelName,handler):this._channelEmitter.removeAllListeners(channelName)},SCSocket.prototype.watchers=function(channelName){return this._channelEmitter.listeners(channelName)};for(var scsocket=SCSocket,rng=function(){return crypto.randomBytes(16)},byteToHex=[],i=0;i<256;++i)byteToHex[i]=(i+256).toString(16).substr(1);var _nodeId,_clockseq,bytesToUuid_1=function(buf,offset){var i=offset||0,bth=byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]},_lastMSecs=0,_lastNSecs=0;var v1_1=function(options,buf,offset){var i=buf&&offset||0,b=buf||[],node=(options=options||{}).node||_nodeId,clockseq=void 0!==options.clockseq?options.clockseq:_clockseq;if(null==node||null==clockseq){var seedBytes=rng();null==node&&(node=_nodeId=[1|seedBytes[0],seedBytes[1],seedBytes[2],seedBytes[3],seedBytes[4],seedBytes[5]]),null==clockseq&&(clockseq=_clockseq=16383&(seedBytes[6]<<8|seedBytes[7]))}var msecs=void 0!==options.msecs?options.msecs:(new Date).getTime(),nsecs=void 0!==options.nsecs?options.nsecs:_lastNSecs+1,dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&void 0===options.clockseq&&(clockseq=clockseq+1&16383),(dt<0||_lastMSecs<msecs)&&void 0===options.nsecs&&(nsecs=0),1e4<=nsecs)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=msecs,_clockseq=clockseq;var tl=(1e4*(268435455&(msecs+=122192928e5))+(_lastNSecs=nsecs))%4294967296;b[i++]=tl>>>24&255,b[i++]=tl>>>16&255,b[i++]=tl>>>8&255,b[i++]=255&tl;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255,b[i++]=255&tmh,b[i++]=tmh>>>24&15|16,b[i++]=tmh>>>16&255,b[i++]=clockseq>>>8|128,b[i++]=255&clockseq;for(var n=0;n<6;++n)b[i+n]=node[n];return buf||bytesToUuid_1(b)};var v4_1=function(options,buf,offset){var i=buf&&offset||0;"string"==typeof options&&(buf="binary"===options?new Array(16):null,options=null);var rnds=(options=options||{}).random||(options.rng||rng)();if(rnds[6]=15&rnds[6]|64,rnds[8]=63&rnds[8]|128,buf)for(var ii=0;ii<16;++ii)buf[i+ii]=rnds[ii];return buf||bytesToUuid_1(rnds)},uuid=v4_1;uuid.v1=v1_1,uuid.v4=v4_1;var uuid_1=uuid,InvalidArgumentsError$2=scErrors.InvalidArgumentsError,_clients={};var scsocketcreator={create:function(options){if((options=options||{}).host&&!options.host.match(/[^:]+:\d{2,5}/))throw new InvalidArgumentsError$2('The host option should include both the hostname and the port number in the format "hostname:port"');if(options.host&&options.hostname)throw new InvalidArgumentsError$2('The host option should already include the hostname and the port number in the format "hostname:port" - Because of this, you should never use host and hostname options together');if(options.host&&options.port)throw new InvalidArgumentsError$2('The host option should already include the hostname and the port number in the format "hostname:port" - Because of this, you should never use host and port options together');var isSecureDefault=commonjsGlobal.location&&"https:"==location.protocol,opts={port:function(options,isSecureDefault){var isSecure=null==options.secure?isSecureDefault:options.secure;return options.port||(commonjsGlobal.location&&location.port?location.port:isSecure?443:80)}(options,isSecureDefault),hostname:commonjsGlobal.location&&location.hostname||"localhost",path:"/socketcluster/",secure:isSecureDefault,autoConnect:!0,autoReconnect:!0,autoSubscribeOnConnect:!0,connectTimeout:2e4,ackTimeout:1e4,timestampRequests:!1,timestampParam:"t",authEngine:null,authTokenName:"socketCluster.authToken",binaryType:"arraybuffer",multiplex:!0,pubSubBatchDuration:null,cloneData:!1};for(var i in options)options.hasOwnProperty(i)&&(opts[i]=options[i]);if(opts.clientMap=_clients,!1===opts.multiplex){opts.clientId=uuid_1.v4();var socket=new scsocket(opts);return _clients[opts.clientId]=socket}return opts.clientId=function(options){var protocolPrefix=options.secure?"https://":"http://",queryString="";if(options.query)if("string"==typeof options.query)queryString=options.query;else{var queryArray=[],queryMap=options.query;for(var key in queryMap)queryMap.hasOwnProperty(key)&&queryArray.push(key+"="+queryMap[key]);queryArray.length&&(queryString="?"+queryArray.join("&"))}return protocolPrefix+(options.host?options.host:options.hostname+":"+options.port)+options.path+queryString}(opts),_clients[opts.clientId]?_clients[opts.clientId].connect():_clients[opts.clientId]=new scsocket(opts),_clients[opts.clientId]},destroy:function(socket){socket.destroy()},clients:_clients},socketclusterClient=createCommonjsModule(function(module){module.exports.SCSocketCreator=scsocketcreator,module.exports.SCSocket=scsocket,module.exports.Emitter=componentEmitter,module.exports.create=function(options){return scsocketcreator.create(options)},module.exports.connect=module.exports.create,module.exports.destroy=function(options){return scsocketcreator.destroy(options)},module.exports.clients=scsocketcreator.clients,module.exports.version="11.0.0"}),socketclusterClient_5=(socketclusterClient.SCSocketCreator,socketclusterClient.SCSocket,socketclusterClient.Emitter,socketclusterClient.create,socketclusterClient.connect),SocketFactory=(socketclusterClient.destroy,socketclusterClient.clients,socketclusterClient.version,function(opts){this.socket=this.debug=opts.debug||!1});return SocketFactory.prototype._log=function(){for(var args=[],len=arguments.length;len--;)args[len]=arguments[len];this.debug&&console.log.apply(console,args)},SocketFactory.prototype.prop=function(field){return this.socket[field]},SocketFactory.prototype.emit=function(channel,data,respond){var self=this;return new Promise(function(resolve,reject){self.socket.emit(channel,data,function(err,res){return respond&&respond(err,res),err?(self._log(err),reject(err)):resolve(res)})})},SocketFactory.prototype.publish=function(channel,data,respond){var self=this;return new Promise(function(resolve,reject){self.socket.publish(channel,data,function(err,res){return respond&&respond(err,res),err?(self._log(err),reject(err)):resolve(res)})})},SocketFactory.prototype.subscribe=function(){for(var ref,args=[],len=arguments.length;len--;)args[len]=arguments[len];return(ref=this.socket).subscribe.apply(ref,args)},SocketFactory.prototype.unsubscribe=function(){for(var ref,args=[],len=arguments.length;len--;)args[len]=arguments[len];return(ref=this.socket).unsubscribe.apply(ref,args)},SocketFactory.prototype.channel=function(){for(var ref,args=[],len=arguments.length;len--;)args[len]=arguments[len];return(ref=this.socket).channel.apply(ref,args)},SocketFactory.prototype.watch=function(){for(var ref,args=[],len=arguments.length;len--;)args[len]=arguments[len];return(ref=this.socket).watch.apply(ref,args)},SocketFactory.prototype.unwatch=function(){for(var ref,args=[],len=arguments.length;len--;)args[len]=arguments[len];return(ref=this.socket).unwatch.apply(ref,args)},SocketFactory.prototype.on=function(){for(var ref,args=[],len=arguments.length;len--;)args[len]=arguments[len];(ref=this.socket).on.apply(ref,args)},SocketFactory.prototype.off=function(){for(var ref,args=[],len=arguments.length;len--;)args[len]=arguments[len];(ref=this.socket).on.apply(ref,args)},SocketFactory.prototype.getState=function(){return this.socket.getState()},SocketFactory.prototype.getAuthToken=function(){return this.socket.getAuthToken()},SocketFactory.prototype.getSignedAuthToken=function(){return this.socket.getSignedAuthToken()},SocketFactory.prototype.disconnect=function(){for(var ref,args=[],len=arguments.length;len--;)args[len]=arguments[len];return(ref=this.socket).disconnect.apply(ref,args)},SocketFactory.prototype.send=function(){for(var ref,args=[],len=arguments.length;len--;)args[len]=arguments[len];return(ref=this.socket).send.apply(ref,args)},SocketFactory.prototype.authenticate=function(){for(var ref,args=[],len=arguments.length;len--;)args[len]=arguments[len];return(ref=this.socket).authenticate.apply(ref,args)},SocketFactory.prototype.deauthenticate=function(){for(var ref,args=[],len=arguments.length;len--;)args[len]=arguments[len];return(ref=this.socket).deauthenticate.apply(ref,args)},SocketFactory.prototype.watchers=function(){for(var ref,args=[],len=arguments.length;len--;)args[len]=arguments[len];return(ref=this.socket).watchers.apply(ref,args)},SocketFactory.prototype.destroyChannel=function(){for(var ref,args=[],len=arguments.length;len--;)args[len]=arguments[len];return(ref=this.socket).destroyChannel.apply(ref,args)},SocketFactory.prototype.subscriptions=function(){for(var ref,args=[],len=arguments.length;len--;)args[len]=arguments[len];return(ref=this.socket).subscriptions.apply(ref,args)},SocketFactory.prototype.isSubscribed=function(){for(var ref,args=[],len=arguments.length;len--;)args[len]=arguments[len];return(ref=this.socket).isSubscribed.apply(ref,args)},SocketFactory.prototype.destroy=function(){for(var ref,args=[],len=arguments.length;len--;)args[len]=arguments[len];return(ref=this.socket).destroy.apply(ref,args)},{install:function(_Vue,options){function vue2SocketclusterInit(){var opts=this.$options;if(opts.socket)this.$socket=opts.socket;else if(opts.parent&&opts.parent.$socket)this.$socket=opts.parent.$socket;else{var soc=socketclusterClient_5(options);this.$socket=soc}}var usesInit=-1<_Vue.config._lifecycleHooks.indexOf("init");_Vue.mixin(usesInit?{init:vue2SocketclusterInit}:{beforeCreate:vue2SocketclusterInit})},SocketFactory:SocketFactory}});